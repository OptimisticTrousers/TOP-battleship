(()=>{var e={653:(e,t,r)=>{const o=r(585);e.exports=()=>{const e={hasBeenHit:!1,isShip:!1,offLimits:!1},t=Array(10).fill(structuredClone(e)).map((()=>Array(10).fill(structuredClone(e)))),r=[o(5,"Carrier"),o(4,"Battleship"),o(3,"Destroyer"),o(3,"Submarine"),o(2,"Patrol Boat")],n=(e,r)=>t?.[e]?.[r],i=(r,o,n=(()=>Object.assign(e,{offLimits:!0}))())=>(void 0===t?.[r]?.[o]||(t[r][o]=n),!0),a=(e,t)=>{i(e-1,t-1),i(e,t-1)},l=(e,r)=>e>=0&&e+r-1<t.length,s=(e,r)=>e>=0&&e+r-1<t.length,c=e=>!0===e.isShip||!0===e.offLimits,h=e=>{const t=0===Math.floor(2*Math.random())?"vertical":"horizontal",r=Math.floor(10*Math.random()),o=Math.floor(10*Math.random());return l(r,e)&&s(o,e)?{randomColumn:r,randomRow:o,randomDirection:t}:h(e)};return{checkIfOffLimitZoneWasCorrectlyImplemented:e=>t.flat().filter((e=>!0===e.offLimits)).length===e+2,getLocation:n,receiveAttack:(e,r)=>{t[e][r].hasBeenHit=!0},checkIfAllShipsHaveSunk:()=>t.flat().every((e=>!1===e.isShip||!0===e.isShip&&!0===e.hasBeenHit&&e.getStatus().every((e=>"hit"===e)))),placeShip:(e,t,r,o)=>{const h=o.getLength();if("vertical"===r){if(s(t,h)){for(let r=0;r<h;r+=1){if(!1!==c(n(e,t+r)))return!1;i(e,t+r,o),i(e+1,t+r),i(e-1,t+r)}return((e,t,r)=>{a(e,t),i(e,t+r),i(e+1,t+r),i(e-1,t+r),i(e+1,t-1)})(e,t,h),!0}}else if("horizontal"===r&&l(e,h)){for(let r=0;r<h;r+=1){if(c(e+r))return!1;i(e+r,t,o),i(e+r,t+1),i(e+r,t-1)}return((e,t,r)=>{a(e,t),i(e+r,t),i(e-1,t+1),i(e+r,t+1),i(e+r,t-1)})(e,t,h),!0}return!1},randomlyPlaceShips:()=>{const e=[];for(let t=0;t<r.length;t+=1){const o=r[t],{randomColumn:n,randomRow:i,randomDirection:a}=h(o.getLength());e.push({randomColumn:n,randomRow:i,randomDirection:a})}return e},makeRandomCoordinates:h}}},61:e=>{e.exports=(e="player")=>({getName:()=>e,attack:(e,t,{getLocation:r,receiveAttack:o})=>{const n=r(e,t);return!1===n.hasBeenHit||n.isShip&&n.getStatus().includes("unhit")?(o(e,t),"It's a hit!"):"You have already hit this spot!"}})},585:e=>{e.exports=(e,t="ship")=>{const r=Array(e).fill("unhit");return{name:t,getLength:()=>r.length,isSunk:()=>r.every((e=>"hit"===e)),hit:t=>{t<e&&(r[t]="hit")},getStatus:()=>r,hasBeenHit:!1,isShip:!0}}}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=(e,t,r)=>{const o=document.querySelector(`.${e}-board > .cell[column='${t}'][row='${r}']`);o.classList.contains("ship")?o.classList.add("hit"):o.classList.add("miss")},t=(e,t,r,o)=>o.attack(e,t,r);var o=r(653),n=r.n(o),i=r(585),a=r.n(i),l=r(61),s=r.n(l);const c=n()(),h=n()(),u=s()(),p=s()();c.placeShip(0,0,"horizontal",a()(5)),c.placeShip(3,4,"horizontal",a()(3)),c.placeShip(6,7,"horizontal",a()(2)),c.placeShip(9,1,"vertical",a()(3)),c.placeShip(5,9,"horizontal",a()(4)),h.placeShip(0,0,"horizontal",a()(5)),h.placeShip(3,4,"horizontal",a()(3)),h.placeShip(6,7,"horizontal",a()(2)),h.placeShip(9,1,"vertical",a()(3)),h.placeShip(5,9,"horizontal",a()(4));const d=(()=>{const e={};return{publish:function(t,r){Array.isArray(e[t])&&e[t].forEach((e=>{e(r)}))},subscribe:function t(r,o){Array.isArray(t[r])||(e[r]=[]),e[r].push(o);const n=e[r].length-1;return{unsubscribe(){e[r].splice(n,1)}}}}})();((e,t,r,o,n)=>{const i=document.querySelector("div.enemy-board");for(let a=0;a<10;a+=1)for(let l=0;l<10;l+=1){const s=i.querySelector(`.cell:nth-child(${10*l+a+1})`);s.setAttribute("column",a),s.setAttribute("row",l),s.addEventListener("click",(()=>{n.publish("click",{cell:s,column:a,row:l,playerBoard:e,enemyBoard:t,player:r,enemy:o})}),{once:!0})}})(c,h,u,p,d),d.subscribe("click",(({cell:r,column:o,row:n,playerBoard:i,enemyBoard:a,player:l,enemy:s})=>{((r,o,n,i)=>{t(r,o,n,i),e("enemy",r,o)})(o,n,a,l),((r,o)=>{const{randomColumn:n,randomRow:i}=r.makeRandomCoordinates();t(n,n,r,o),e("player",n,i)})(i,s)})),(({getLocation:e})=>{const t=document.querySelector("div.player-board");for(let r=0;r<10;r+=1)for(let o=0;o<10;o+=1){const n=t.querySelector(`.cell:nth-child(${10*o+r+1})`);n.setAttribute("column",r),n.setAttribute("row",o),e(o,r).isShip&&n.classList.add("ship")}})(c)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTLEdBQUlBLEdBQVUsRUFDeEMsSUFBSyxJQUFJQyxFQUFNLEVBQUdBLEVBQU0sR0FBSUEsR0FBTyxFQUFHLENBQ2xDLE1BQU00QixFQUFPeUUsRUFBZ0I3QixjQUN6QixtQkFBeUIsR0FBTnhFLEVBQVdELEVBQVMsTUFFM0M2QixFQUFLbUUsYUFBYSxTQUFVaEcsR0FDNUI2QixFQUFLbUUsYUFBYSxNQUFPL0YsR0FDckJGLEVBQVlFLEVBQUtELEdBQVFULFFBQ3pCc0MsRUFBSzZDLFVBQVVFLElBQUksVUNwQ25DMkIsQ0FBa0J4QixJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvZ2FtZWJvYXJkL2dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9wbGF5ZXIvcGxheWVyLmpzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL3NoaXAvc2hpcC5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC93ZWJwYWNrL3J1bnRpbWUvY29tcGF0IGdldCBkZWZhdWx0IGV4cG9ydCIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9kb20uanMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLWV4cHJlc3Npb25zICovXG5jb25zdCBjcmVhdGVTaGlwID0gcmVxdWlyZSgnLi4vc2hpcC9zaGlwJylcblxuLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi9cbmNvbnN0IGNyZWF0ZUdhbWVCb2FyZCA9ICgpID0+IHtcbiAgICBjb25zdCBlbXB0eUNlbGwgPSB7IGhhc0JlZW5IaXQ6IGZhbHNlLCBpc1NoaXA6IGZhbHNlLCBvZmZMaW1pdHM6IGZhbHNlIH1cbiAgICBjb25zdCBnYW1lQm9hcmQgPSBBcnJheSgxMClcbiAgICAgICAgLmZpbGwoc3RydWN0dXJlZENsb25lKGVtcHR5Q2VsbCkpXG4gICAgICAgIC5tYXAoKCkgPT4gQXJyYXkoMTApLmZpbGwoc3RydWN0dXJlZENsb25lKGVtcHR5Q2VsbCkpKVxuXG4gICAgY29uc3Qgc2hpcHMgPSBbXG4gICAgICAgIGNyZWF0ZVNoaXAoNSwgJ0NhcnJpZXInKSxcbiAgICAgICAgY3JlYXRlU2hpcCg0LCAnQmF0dGxlc2hpcCcpLFxuICAgICAgICBjcmVhdGVTaGlwKDMsICdEZXN0cm95ZXInKSxcbiAgICAgICAgY3JlYXRlU2hpcCgzLCAnU3VibWFyaW5lJyksXG4gICAgICAgIGNyZWF0ZVNoaXAoMiwgJ1BhdHJvbCBCb2F0JyksXG4gICAgXVxuXG4gICAgY29uc3QgY2hlY2tJZkFsbFNoaXBzSGF2ZVN1bmsgPSAoKSA9PlxuICAgICAgICBnYW1lQm9hcmQuZmxhdCgpLmV2ZXJ5KFxuICAgICAgICAgICAgKGNlbGwpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY2VsbC5pc1NoaXAgPT09IGZhbHNlKSByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICAgIGlmIChjZWxsLmlzU2hpcCA9PT0gdHJ1ZSAmJiBjZWxsLmhhc0JlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbGwuZ2V0U3RhdHVzKCkuZXZlcnkoKHVuaXQpID0+IHVuaXQgPT09ICdoaXQnKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gKHBvc2l0aW9uLmlzU2hpcCA9PT0gZmFsc2UpIHx8XG4gICAgICAgICAgICAvLyAocG9zaXRpb24uaXNTaGlwID09PSB0cnVlICYmIHBvc2l0aW9uLmhhc0JlZW5IaXQgPT09IHRydWUpXG4gICAgICAgIClcblxuICAgIGNvbnN0IGNyZWF0ZU9mZkxpbWl0TG9jYXRpb24gPSAoKSA9PlxuICAgICAgICBPYmplY3QuYXNzaWduKGVtcHR5Q2VsbCwgeyBvZmZMaW1pdHM6IHRydWUgfSlcblxuICAgIGNvbnN0IGdldExvY2F0aW9uID0gKGNvbHVtbiwgcm93KSA9PiBnYW1lQm9hcmQ/Lltjb2x1bW5dPy5bcm93XVxuXG4gICAgY29uc3Qgc2V0TG9jYXRpb24gPSAoY29sdW1uLCByb3csIHNoaXAgPSBjcmVhdGVPZmZMaW1pdExvY2F0aW9uKCkpID0+IHtcbiAgICAgICAgaWYgKGdhbWVCb2FyZD8uW2NvbHVtbl0/Lltyb3ddID09PSB1bmRlZmluZWQpIHJldHVybiB0cnVlXG4gICAgICAgIGdhbWVCb2FyZFtjb2x1bW5dW3Jvd10gPSBzaGlwXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuXG4gICAgY29uc3QgYWRkT2ZmTGltaXRBcmVhRm9yU2hpcHMgPSAoY29sdW1uLCByb3cpID0+IHtcbiAgICAgICAgLy8gdG9wLWxlZnRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uIC0gMSwgcm93IC0gMSlcbiAgICAgICAgLy8gdG9wXG4gICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiwgcm93IC0gMSlcbiAgICB9XG5cbiAgICBjb25zdCBhZGRPZmZMaW1pdEFyZWFGb3JIb3Jpem9udGFsbHlQb3NpdGlvbmVkU2hpcCA9IChcbiAgICAgICAgY29sdW1uLFxuICAgICAgICByb3csXG4gICAgICAgIHNoaXBMZW5ndGhcbiAgICApID0+IHtcbiAgICAgICAgLy8gcG9zaXRpb25zIHJlbGF0aXZlIHRvIHRoZSBzaGlwIGl0c2VsZihpZS4gYSBob3Jpem9udGFsIHNoaXAncyBib3R0b20gaXMgdG8gdGhlIHJpZ2h0KVxuXG4gICAgICAgIGFkZE9mZkxpbWl0QXJlYUZvclNoaXBzKGNvbHVtbiwgcm93KVxuICAgICAgICAvLyBib3R0b21cbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgc2hpcExlbmd0aCwgcm93KVxuICAgICAgICAvLyBib3R0b20tbGVmdFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gLSAxLCByb3cgKyAxKVxuICAgICAgICAvLyBib3R0b20tcmlnaHRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgc2hpcExlbmd0aCwgcm93ICsgMSlcbiAgICAgICAgLy8gdG9wLXJpZ2h0XG4gICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiArIHNoaXBMZW5ndGgsIHJvdyAtIDEpXG4gICAgfVxuXG4gICAgY29uc3QgYWRkT2ZmTGltaXRBcmVhRm9yVmVydGljYWxseVBvc2l0aW9uZWRTaGlwID0gKFxuICAgICAgICBjb2x1bW4sXG4gICAgICAgIHJvdyxcbiAgICAgICAgc2hpcExlbmd0aFxuICAgICkgPT4ge1xuICAgICAgICAvLyBwb3NpdGlvbnMgcmVsYXRpdmUgdG8gaG93IHRoZSB1c2VyIHNlZXMgaXQoaWUuIGEgdmVydGljYWwgc2hpcCdzIGJvdHRvbSBpcyB0byB0aGUgYm90dG9tKVxuXG4gICAgICAgIGFkZE9mZkxpbWl0QXJlYUZvclNoaXBzKGNvbHVtbiwgcm93KVxuICAgICAgICAvLyBib3R0b21cbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uLCByb3cgKyBzaGlwTGVuZ3RoKVxuICAgICAgICAvLyBib3R0b20tcmlnaHRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgMSwgcm93ICsgc2hpcExlbmd0aClcbiAgICAgICAgLy8gYm90dG9tLWxlZnRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uIC0gMSwgcm93ICsgc2hpcExlbmd0aClcbiAgICAgICAgLy8gdG9wLXJpZ2h0XG4gICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiArIDEsIHJvdyAtIDEpXG4gICAgfVxuXG4gICAgY29uc3QgY2hlY2tJZkNvbHVtbkNvb3JkaW5hdGVJc1ZhbGlkID0gKGNvbHVtbiwgc2hpcExlbmd0aCkgPT5cbiAgICAgICAgY29sdW1uID49IDAgJiYgY29sdW1uICsgc2hpcExlbmd0aCAtIDEgPCBnYW1lQm9hcmQubGVuZ3RoXG5cbiAgICBjb25zdCBjaGVja0lmUm93Q29vcmRpbmF0ZUlzVmFsaWQgPSAocm93LCBzaGlwTGVuZ3RoKSA9PlxuICAgICAgICByb3cgPj0gMCAmJiByb3cgKyBzaGlwTGVuZ3RoIC0gMSA8IGdhbWVCb2FyZC5sZW5ndGhcblxuICAgIGNvbnN0IGNoZWNrSWZMb2NhdGlvbklzQVNoaXBPck9mZkxpbWl0cyA9IChsb2NhdGlvbikgPT4ge1xuICAgICAgICBpZiAobG9jYXRpb24uaXNTaGlwID09PSB0cnVlIHx8IGxvY2F0aW9uLm9mZkxpbWl0cyA9PT0gdHJ1ZSkgcmV0dXJuIHRydWVcblxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICBjb25zdCBwbGFjZVNoaXAgPSAoY29sdW1uLCByb3csIGRpcmVjdGlvbiwgc2hpcCkgPT4ge1xuICAgICAgICBjb25zdCBzaGlwTGVuZ3RoID0gc2hpcC5nZXRMZW5ndGgoKVxuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAndmVydGljYWwnKSB7XG4gICAgICAgICAgICBpZiAoY2hlY2tJZlJvd0Nvb3JkaW5hdGVJc1ZhbGlkKHJvdywgc2hpcExlbmd0aCkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja0lmTG9jYXRpb25Jc0FTaGlwT3JPZmZMaW1pdHMoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0TG9jYXRpb24oY29sdW1uLCByb3cgKyBpKVxuICAgICAgICAgICAgICAgICAgICAgICAgKSA9PT0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4sIHJvdyArIGksIHNoaXApXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyAxLCByb3cgKyBpKVxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uIC0gMSwgcm93ICsgaSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYWRkT2ZmTGltaXRBcmVhRm9yVmVydGljYWxseVBvc2l0aW9uZWRTaGlwKFxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4sXG4gICAgICAgICAgICAgICAgICAgIHJvdyxcbiAgICAgICAgICAgICAgICAgICAgc2hpcExlbmd0aFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ2hvcml6b250YWwnKSB7XG4gICAgICAgICAgICBpZiAoY2hlY2tJZkNvbHVtbkNvb3JkaW5hdGVJc1ZhbGlkKGNvbHVtbiwgc2hpcExlbmd0aCkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWNoZWNrSWZMb2NhdGlvbklzQVNoaXBPck9mZkxpbWl0cyhjb2x1bW4gKyBpLCByb3cpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBpLCByb3csIHNoaXApXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBpLCByb3cgKyAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgaSwgcm93IC0gMSlcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYWRkT2ZmTGltaXRBcmVhRm9ySG9yaXpvbnRhbGx5UG9zaXRpb25lZFNoaXAoXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbixcbiAgICAgICAgICAgICAgICAgICAgcm93LFxuICAgICAgICAgICAgICAgICAgICBzaGlwTGVuZ3RoXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgY29uc3QgbWFrZVJhbmRvbUNvb3JkaW5hdGVzID0gKHNoaXBMZW5ndGgpID0+IHtcbiAgICAgICAgY29uc3QgcmFuZG9tRGlyZWN0aW9uID1cbiAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpID09PSAwID8gJ3ZlcnRpY2FsJyA6ICdob3Jpem9udGFsJ1xuICAgICAgICBjb25zdCByYW5kb21Db2x1bW4gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMClcbiAgICAgICAgY29uc3QgcmFuZG9tUm93ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApXG4gICAgICAgIGlmICghY2hlY2tJZkNvbHVtbkNvb3JkaW5hdGVJc1ZhbGlkKHJhbmRvbUNvbHVtbiwgc2hpcExlbmd0aCkpXG4gICAgICAgICAgICByZXR1cm4gbWFrZVJhbmRvbUNvb3JkaW5hdGVzKHNoaXBMZW5ndGgpXG4gICAgICAgIGlmICghY2hlY2tJZlJvd0Nvb3JkaW5hdGVJc1ZhbGlkKHJhbmRvbVJvdywgc2hpcExlbmd0aCkpXG4gICAgICAgICAgICByZXR1cm4gbWFrZVJhbmRvbUNvb3JkaW5hdGVzKHNoaXBMZW5ndGgpXG4gICAgICAgIHJldHVybiB7IHJhbmRvbUNvbHVtbiwgcmFuZG9tUm93LCByYW5kb21EaXJlY3Rpb24gfVxuICAgIH1cblxuICAgIGNvbnN0IHJhbmRvbWx5UGxhY2VTaGlwcyA9ICgpID0+IHtcbiAgICAgICAgY29uc3Qgc2hpcERldGFpbHMgPSBbXVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBjb25zdCBzaGlwID0gc2hpcHNbaV1cbiAgICAgICAgICAgIGNvbnN0IHsgcmFuZG9tQ29sdW1uLCByYW5kb21Sb3csIHJhbmRvbURpcmVjdGlvbiB9ID1cbiAgICAgICAgICAgICAgICBtYWtlUmFuZG9tQ29vcmRpbmF0ZXMoc2hpcC5nZXRMZW5ndGgoKSlcbiAgICAgICAgICAgIHNoaXBEZXRhaWxzLnB1c2goeyByYW5kb21Db2x1bW4sIHJhbmRvbVJvdywgcmFuZG9tRGlyZWN0aW9uIH0pXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNoaXBEZXRhaWxzXG4gICAgfVxuXG4gICAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb2x1bW4sIHJvdykgPT4ge1xuICAgICAgICBnYW1lQm9hcmRbY29sdW1uXVtyb3ddLmhhc0JlZW5IaXQgPSB0cnVlXG4gICAgfVxuXG4gICAgY29uc3QgY2hlY2tJZk9mZkxpbWl0Wm9uZVdhc0NvcnJlY3RseUltcGxlbWVudGVkID0gKHNoaXBMZW5ndGgpID0+XG4gICAgICAgIGdhbWVCb2FyZC5mbGF0KCkuZmlsdGVyKChlbGVtZW50KSA9PiBlbGVtZW50Lm9mZkxpbWl0cyA9PT0gdHJ1ZSlcbiAgICAgICAgICAgIC5sZW5ndGggPT09XG4gICAgICAgIHNoaXBMZW5ndGggKyAyXG4gICAgLy8gYWRkaW5nIHNoaXBMZW5ndGggcGx1cyB0d28gYmVjYXVzZSBmb3IgZXZlcnkgaW5jcmVhc2UgaW4gdGhlIHNpemUgb2Ygc2hpcCwgdGhlIHpvbmVzIGNvdmVyZWQgaW5jcmVhc2UgYnkgMiB1bml0c1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgY2hlY2tJZk9mZkxpbWl0Wm9uZVdhc0NvcnJlY3RseUltcGxlbWVudGVkLFxuICAgICAgICBnZXRMb2NhdGlvbixcbiAgICAgICAgcmVjZWl2ZUF0dGFjayxcbiAgICAgICAgY2hlY2tJZkFsbFNoaXBzSGF2ZVN1bmssXG4gICAgICAgIHBsYWNlU2hpcCxcbiAgICAgICAgcmFuZG9tbHlQbGFjZVNoaXBzLFxuICAgICAgICBtYWtlUmFuZG9tQ29vcmRpbmF0ZXMsXG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZUdhbWVCb2FyZFxuIiwiY29uc3QgY3JlYXRlUGxheWVyID0gKG5hbWUgPSAncGxheWVyJykgPT4ge1xuICAgIGNvbnN0IGdldE5hbWUgPSAoKSA9PiBuYW1lXG5cbiAgICBjb25zdCBhdHRhY2sgPSAoY29sdW1uLCByb3csIHsgZ2V0TG9jYXRpb24sIHJlY2VpdmVBdHRhY2sgfSkgPT4ge1xuICAgICAgICBjb25zdCBsb2NhdGlvbiA9IGdldExvY2F0aW9uKGNvbHVtbiwgcm93KVxuICAgICAgICBpZiAobG9jYXRpb24uaGFzQmVlbkhpdCA9PT0gZmFsc2UgfHwgKGxvY2F0aW9uLmlzU2hpcCAmJiBsb2NhdGlvbi5nZXRTdGF0dXMoKS5pbmNsdWRlcygndW5oaXQnKSkpIHtcbiAgICAgICAgICAgIHJlY2VpdmVBdHRhY2soY29sdW1uLCByb3cpXG4gICAgICAgICAgICByZXR1cm4gXCJJdCdzIGEgaGl0IVwiXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJ1lvdSBoYXZlIGFscmVhZHkgaGl0IHRoaXMgc3BvdCEnXG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0TmFtZSxcbiAgICAgICAgYXR0YWNrLFxuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjcmVhdGVQbGF5ZXJcbiIsImNvbnN0IGNyZWF0ZVNoaXAgPSAobGVuZ3RoLCBuYW1lID0gJ3NoaXAnKSA9PiB7XG5cbiAgICBjb25zdCBzdGF0dXMgPSBBcnJheShsZW5ndGgpLmZpbGwoJ3VuaGl0JylcblxuICAgIGNvbnN0IGdldExlbmd0aCA9ICgpID0+IHN0YXR1cy5sZW5ndGhcblxuICAgIGNvbnN0IGdldFN0YXR1cyA9ICgpID0+IHN0YXR1c1xuXG4gICAgY29uc3QgaGl0ID0gKHBvc2l0aW9uKSA9PiB7XG4gICAgICAgIGlmIChwb3NpdGlvbiA8IGxlbmd0aCkge1xuICAgICAgICAgICAgc3RhdHVzW3Bvc2l0aW9uXSA9ICdoaXQnXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBpc1N1bmsgPSAoKSA9PiBzdGF0dXMuZXZlcnkoKHBvc2l0aW9uKSA9PiBwb3NpdGlvbiA9PT0gJ2hpdCcpXG5cbiAgICByZXR1cm4ge1xuICAgICAgICBuYW1lLFxuICAgICAgICBnZXRMZW5ndGgsXG4gICAgICAgIGlzU3VuayxcbiAgICAgICAgaGl0LFxuICAgICAgICBnZXRTdGF0dXMsXG4gICAgICAgIGhhc0JlZW5IaXQ6IGZhbHNlLFxuICAgICAgICBpc1NoaXA6IHRydWUsXG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZVNoaXBcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gKG1vZHVsZSkgPT4ge1xuXHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cblx0XHQoKSA9PiAobW9kdWxlWydkZWZhdWx0J10pIDpcblx0XHQoKSA9PiAobW9kdWxlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgeyBhOiBnZXR0ZXIgfSk7XG5cdHJldHVybiBnZXR0ZXI7XG59OyIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCJjb25zdCByZW5kZXJBdHRhY2tzID0gKHBsYXllciwgY29sdW1uLCByb3cpID0+IHtcbiAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgYC4ke3BsYXllcn0tYm9hcmQgPiAuY2VsbFtjb2x1bW49JyR7Y29sdW1ufSddW3Jvdz0nJHtyb3d9J11gXG4gICAgKVxuICAgIGlmIChjZWxsLmNsYXNzTGlzdC5jb250YWlucygnc2hpcCcpKSB7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnaGl0JylcbiAgICB9IGVsc2Uge1xuICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ21pc3MnKVxuICAgIH1cbn1cblxuY29uc3QgaGFuZGxlQXR0YWNrID0gKGNvbHVtbiwgcm93LCBlbmVteUJvYXJkLCBwbGF5ZXIpID0+XG4gICAgcGxheWVyLmF0dGFjayhjb2x1bW4sIHJvdywgZW5lbXlCb2FyZClcblxuY29uc3QgYXR0YWNrRW5lbXlDZWxsID0gKGNvbHVtbiwgcm93LCBlbmVteUJvYXJkLCBwbGF5ZXIpID0+IHtcbiAgICBoYW5kbGVBdHRhY2soY29sdW1uLCByb3csIGVuZW15Qm9hcmQsIHBsYXllcilcbiAgICByZW5kZXJBdHRhY2tzKCdlbmVteScsIGNvbHVtbiwgcm93KVxufVxuXG5jb25zdCBhdHRhY2tQbGF5ZXJDZWxsID0gKHBsYXllckJvYXJkLCBlbmVteSkgPT4ge1xuICAgIGNvbnN0IHsgcmFuZG9tQ29sdW1uLCByYW5kb21Sb3cgfSA9IHBsYXllckJvYXJkLm1ha2VSYW5kb21Db29yZGluYXRlcygpXG4gICAgaGFuZGxlQXR0YWNrKHJhbmRvbUNvbHVtbiwgcmFuZG9tQ29sdW1uLCBwbGF5ZXJCb2FyZCwgZW5lbXkpXG4gICAgcmVuZGVyQXR0YWNrcygncGxheWVyJywgcmFuZG9tQ29sdW1uLCByYW5kb21Sb3cpXG59XG4vLyBodHRwczovL2pzbWFuaWZlc3QuY29tL3RoZS1wdWJsaXNoLXN1YnNjcmliZS1wYXR0ZXJuLWluLWphdmFzY3JpcHQvXG5cbmV4cG9ydCBjb25zdCBwdWJTdWIgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3Vic2NyaWJlcnMgPSB7fVxuXG4gICAgZnVuY3Rpb24gcHVibGlzaChldmVudE5hbWUsIGRhdGEpIHtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHN1YnNjcmliZXJzW2V2ZW50TmFtZV0pKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICBzdWJzY3JpYmVyc1tldmVudE5hbWVdLmZvckVhY2goKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgICAgICBjYWxsYmFjayhkYXRhKVxuICAgICAgICB9KVxuICAgIH1cbiAgICBmdW5jdGlvbiBzdWJzY3JpYmUoZXZlbnROYW1lLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc3Vic2NyaWJlW2V2ZW50TmFtZV0pKSB7XG4gICAgICAgICAgICBzdWJzY3JpYmVyc1tldmVudE5hbWVdID0gW11cbiAgICAgICAgfVxuICAgICAgICBzdWJzY3JpYmVyc1tldmVudE5hbWVdLnB1c2goY2FsbGJhY2spXG4gICAgICAgIGNvbnN0IGluZGV4ID0gc3Vic2NyaWJlcnNbZXZlbnROYW1lXS5sZW5ndGggLSAxXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVuc3Vic2NyaWJlKCkge1xuICAgICAgICAgICAgICAgIHN1YnNjcmliZXJzW2V2ZW50TmFtZV0uc3BsaWNlKGluZGV4LCAxKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIHB1Ymxpc2gsXG4gICAgICAgIHN1YnNjcmliZSxcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCByZW5kZXJQbGF5ZXJTaGlwcyA9ICh7IGdldExvY2F0aW9uIH0pID0+IHtcbiAgICBjb25zdCBwbGF5ZXJCb2FyZEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXYucGxheWVyLWJvYXJkJylcblxuICAgIGZvciAobGV0IGNvbHVtbiA9IDA7IGNvbHVtbiA8IDEwOyBjb2x1bW4gKz0gMSkge1xuICAgICAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCAxMDsgcm93ICs9IDEpIHtcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBwbGF5ZXJCb2FyZEFyZWEucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgICBgLmNlbGw6bnRoLWNoaWxkKCR7cm93ICogMTAgKyBjb2x1bW4gKyAxfSlgXG4gICAgICAgICAgICApXG4gICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgnY29sdW1uJywgY29sdW1uKVxuICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ3JvdycsIHJvdylcbiAgICAgICAgICAgIGlmIChnZXRMb2NhdGlvbihyb3csIGNvbHVtbikuaXNTaGlwKSB7XG4gICAgICAgICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdzaGlwJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGFkZExpc3RlbmVyc1RvRW5lbXlCb2FyZCA9IChcbiAgICBwbGF5ZXJCb2FyZCxcbiAgICBlbmVteUJvYXJkLFxuICAgIHBsYXllcixcbiAgICBlbmVteSxcbiAgICBwc1xuKSA9PiB7XG4gICAgY29uc3QgZW5lbXlCb2FyZEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXYuZW5lbXktYm9hcmQnKVxuXG4gICAgZm9yIChsZXQgY29sdW1uID0gMDsgY29sdW1uIDwgMTA7IGNvbHVtbiArPSAxKSB7XG4gICAgICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IDEwOyByb3cgKz0gMSkge1xuICAgICAgICAgICAgLy8gQ3JlZGl0aW5nIGZvcm11bGEgdG8gY2FsY3VsYXRlIG50aC1jaGlsZCB1c2luZyBuZXN0ZWQgbG9vcDogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvODg3MjY2Mi9tYXRoLXRvLWRldGVybWluZS1pdGVtLWluZGV4LWJhc2VkLW9uLWNvbC1yb3ctc2VsZWN0aW9uLWluLWdyaWRcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBlbmVteUJvYXJkQXJlYS5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgICAgIGAuY2VsbDpudGgtY2hpbGQoJHtyb3cgKiAxMCArIGNvbHVtbiArIDF9KWBcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdjb2x1bW4nLCBjb2x1bW4pXG4gICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgncm93Jywgcm93KVxuXG4gICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgICAgICAgICAgJ2NsaWNrJyxcbiAgICAgICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHBzLnB1Ymxpc2goJ2NsaWNrJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllckJvYXJkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXlCb2FyZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15LFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgeyBvbmNlOiB0cnVlIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGF0dGFjayA9ICh7XG4gICAgY2VsbCxcbiAgICBjb2x1bW4sXG4gICAgcm93LFxuICAgIHBsYXllckJvYXJkLFxuICAgIGVuZW15Qm9hcmQsXG4gICAgcGxheWVyLFxuICAgIGVuZW15LFxufSkgPT4ge1xuICAgIC8vIGh1bWFuIHBsYXllciBhdHRhY2tpbmcgY29tcHV0ZXJcbiAgICBhdHRhY2tFbmVteUNlbGwoY29sdW1uLCByb3csIGVuZW15Qm9hcmQsIHBsYXllcilcbiAgICAvLyBjb21wdXRlciBhdHRhY2tpbmcgaHVtYW5cbiAgICBhdHRhY2tQbGF5ZXJDZWxsKHBsYXllckJvYXJkLCBlbmVteSlcbn1cbiIsImltcG9ydCB7IGFkZExpc3RlbmVyc1RvRW5lbXlCb2FyZCwgcmVuZGVyUGxheWVyU2hpcHMscHViU3ViLCBhdHRhY2t9IGZyb20gJy4vZG9tJ1xuXG5pbXBvcnQgY3JlYXRlR2FtZUJvYXJkIGZyb20gJy4vZ2FtZWJvYXJkL2dhbWVib2FyZCdcbmltcG9ydCBjcmVhdGVTaGlwIGZyb20gJy4vc2hpcC9zaGlwJ1xuaW1wb3J0IGNyZWF0ZVBsYXllciBmcm9tICcuL3BsYXllci9wbGF5ZXInXG5cbmNvbnN0IHBsYXllckJvYXJkID0gY3JlYXRlR2FtZUJvYXJkKClcbmNvbnN0IGVuZW15Qm9hcmQgPSBjcmVhdGVHYW1lQm9hcmQoKVxuXG5jb25zdCBwbGF5ZXIgPSBjcmVhdGVQbGF5ZXIoKVxuXG5jb25zdCBjb21wdXRlciA9IGNyZWF0ZVBsYXllcigpXG5cbnBsYXllckJvYXJkLnBsYWNlU2hpcCgwLCAwLCAnaG9yaXpvbnRhbCcsIGNyZWF0ZVNoaXAoNSkpXG5wbGF5ZXJCb2FyZC5wbGFjZVNoaXAoMywgNCwgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDMpKVxucGxheWVyQm9hcmQucGxhY2VTaGlwKDYsIDcsICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCgyKSlcbnBsYXllckJvYXJkLnBsYWNlU2hpcCg5LCAxLCAndmVydGljYWwnLCBjcmVhdGVTaGlwKDMpKVxucGxheWVyQm9hcmQucGxhY2VTaGlwKDUsIDksICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCg0KSlcblxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoMCwgMCwgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDUpKVxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoMywgNCwgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDMpKVxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoNiwgNywgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDIpKVxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoOSwgMSwgJ3ZlcnRpY2FsJywgY3JlYXRlU2hpcCgzKSlcbmVuZW15Qm9hcmQucGxhY2VTaGlwKDUsIDksICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCg0KSlcblxuY29uc3QgcHMgPSBwdWJTdWIoKVxuXG5hZGRMaXN0ZW5lcnNUb0VuZW15Qm9hcmQocGxheWVyQm9hcmQsIGVuZW15Qm9hcmQsIHBsYXllciwgY29tcHV0ZXIsIHBzKVxuXG5wcy5zdWJzY3JpYmUoJ2NsaWNrJywgYXR0YWNrKVxuXG5cbnJlbmRlclBsYXllclNoaXBzKHBsYXllckJvYXJkKSJdLCJuYW1lcyI6WyJjcmVhdGVTaGlwIiwibW9kdWxlIiwiZXhwb3J0cyIsImVtcHR5Q2VsbCIsImhhc0JlZW5IaXQiLCJpc1NoaXAiLCJvZmZMaW1pdHMiLCJnYW1lQm9hcmQiLCJBcnJheSIsImZpbGwiLCJzdHJ1Y3R1cmVkQ2xvbmUiLCJtYXAiLCJzaGlwcyIsImdldExvY2F0aW9uIiwiY29sdW1uIiwicm93Iiwic2V0TG9jYXRpb24iLCJzaGlwIiwiT2JqZWN0IiwiYXNzaWduIiwiY3JlYXRlT2ZmTGltaXRMb2NhdGlvbiIsInVuZGVmaW5lZCIsImFkZE9mZkxpbWl0QXJlYUZvclNoaXBzIiwiY2hlY2tJZkNvbHVtbkNvb3JkaW5hdGVJc1ZhbGlkIiwic2hpcExlbmd0aCIsImxlbmd0aCIsImNoZWNrSWZSb3dDb29yZGluYXRlSXNWYWxpZCIsImNoZWNrSWZMb2NhdGlvbklzQVNoaXBPck9mZkxpbWl0cyIsImxvY2F0aW9uIiwibWFrZVJhbmRvbUNvb3JkaW5hdGVzIiwicmFuZG9tRGlyZWN0aW9uIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicmFuZG9tQ29sdW1uIiwicmFuZG9tUm93IiwiY2hlY2tJZk9mZkxpbWl0Wm9uZVdhc0NvcnJlY3RseUltcGxlbWVudGVkIiwiZmxhdCIsImZpbHRlciIsImVsZW1lbnQiLCJyZWNlaXZlQXR0YWNrIiwiY2hlY2tJZkFsbFNoaXBzSGF2ZVN1bmsiLCJldmVyeSIsImNlbGwiLCJnZXRTdGF0dXMiLCJ1bml0IiwicGxhY2VTaGlwIiwiZGlyZWN0aW9uIiwiZ2V0TGVuZ3RoIiwiaSIsImFkZE9mZkxpbWl0QXJlYUZvclZlcnRpY2FsbHlQb3NpdGlvbmVkU2hpcCIsImFkZE9mZkxpbWl0QXJlYUZvckhvcml6b250YWxseVBvc2l0aW9uZWRTaGlwIiwicmFuZG9tbHlQbGFjZVNoaXBzIiwic2hpcERldGFpbHMiLCJwdXNoIiwibmFtZSIsImdldE5hbWUiLCJhdHRhY2siLCJpbmNsdWRlcyIsInN0YXR1cyIsImlzU3VuayIsInBvc2l0aW9uIiwiaGl0IiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsIm4iLCJnZXR0ZXIiLCJfX2VzTW9kdWxlIiwiZCIsImEiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyZW5kZXJBdHRhY2tzIiwicGxheWVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJhZGQiLCJoYW5kbGVBdHRhY2siLCJlbmVteUJvYXJkIiwicGxheWVyQm9hcmQiLCJjb21wdXRlciIsInBzIiwic3Vic2NyaWJlcnMiLCJwdWJsaXNoIiwiZXZlbnROYW1lIiwiZGF0YSIsImlzQXJyYXkiLCJmb3JFYWNoIiwiY2FsbGJhY2siLCJzdWJzY3JpYmUiLCJpbmRleCIsInVuc3Vic2NyaWJlIiwic3BsaWNlIiwicHViU3ViIiwiZW5lbXkiLCJlbmVteUJvYXJkQXJlYSIsInNldEF0dHJpYnV0ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJvbmNlIiwiYWRkTGlzdGVuZXJzVG9FbmVteUJvYXJkIiwiYXR0YWNrRW5lbXlDZWxsIiwiYXR0YWNrUGxheWVyQ2VsbCIsInBsYXllckJvYXJkQXJlYSIsInJlbmRlclBsYXllclNoaXBzIl0sInNvdXJjZVJvb3QiOiIifQ==