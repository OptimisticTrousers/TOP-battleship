(()=>{var e={653:(e,t,o)=>{const r=o(585);e.exports=()=>{const e={hasBeenHit:!1,isShip:!1,offLimits:!1},t=Array(10).fill(structuredClone(e)).map((()=>Array(10).fill(structuredClone(e)))),o=[r(5,"Carrier"),r(4,"Battleship"),r(3,"Destroyer"),r(3,"Submarine"),r(2,"Patrol Boat")],n=(e,o)=>t?.[e]?.[o],i=(o,r,n=(()=>Object.assign(e,{offLimits:!0}))())=>(void 0===t?.[o]?.[r]||(t[o][r]=n),!0),a=(e,t)=>{i(e-1,t-1),i(e,t-1)},l=(e,o,r,l)=>{if(!0===(c=n(e,o)).isShip||!0===c.offLimits)return!1;var c;const s=l.getLength();if("vertical"===r){if(((e,o)=>e>=0&&e+o-1<t.length)(o,s)){for(let r=0;r<s;r+=1)t[e][o+r]={...l,position:r},i(e+1,o+r),i(e-1,o+r);return((e,t,o)=>{a(e,t),i(e,t+o),i(e+1,t+o),i(e-1,t+o),i(e+1,t-1)})(e,o,s),!0}}else if("horizontal"===r&&((e,o)=>e>=0&&e+o-1<t.length)(e,s)){for(let r=0;r<s;r+=1)t[e+r][o]={...l,position:r},i(e+r,o+1),i(e+r,o-1);return((e,t,o)=>{a(e,t),i(e+o,t),i(e-1,t+1),i(e+o,t+1),i(e+o,t-1)})(e,o,s),!0}return!1},c=()=>{const e=0===Math.floor(2*Math.random())?"vertical":"horizontal";return{randomColumn:Math.floor(10*Math.random()),randomRow:Math.floor(10*Math.random()),randomDirection:e}};return{checkIfOffLimitZoneWasCorrectlyImplemented:e=>t.flat().filter((e=>!0===e.offLimits)).length===e+2,getLocation:n,receiveAttack:(e,o)=>{t[e][o].hasBeenHit=!0},checkIfAllShipsHaveSunk:()=>{let e=!0;for(let t=0;t<10;t++)for(let o=0;o<10;o++){const r=n(t,o);if(!1!==r.isShip&&r.isShip&&!1===r.isSunk()){e=!1;break}}return e},placeShip:l,randomlyPlaceShips:()=>{const e=[];for(let t=0;t<o.length;t+=1){const r=o[t],{randomColumn:n,randomRow:i,randomDirection:a}=c(r.getLength());l(n,i,a,r)?e.push({randomColumn:n,randomRow:i,randomDirection:a}):t-=1}return e},makeRandomCoordinates:c}}},61:e=>{e.exports=(e="player")=>({getName:()=>e,attack:(e,t,{getLocation:o,receiveAttack:r})=>{const n=o(e,t);return!1===n.hasBeenHit||n.isShip&&!1===n.getStatus().includes("unhit")?(r(e,t),n.hit(n.position),"It's a hit!"):"You have already hit this spot!"}})},585:e=>{e.exports=(e,t="ship")=>{const o=Array(e).fill("unhit");return{name:t,getLength:()=>o.length,isSunk:()=>o.every((e=>"hit"===e)),hit:t=>{t<e&&(o[t]="hit")},getStatus:()=>o,hasBeenHit:!1,isShip:!0}}}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,o),i.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=(e,t,o,r)=>{const n=document.querySelector(`.${e}-board > .cell[column='${t}'][row='${o}']`);r.getLocation(t,o).isShip?n.classList.add("hit"):n.classList.add("miss")},t=(e,t,o,r)=>r.attack(e,t,o);var r=o(653),n=o.n(r),i=o(585),a=o.n(i),l=o(61),c=o.n(l);const s=n()(),h=n()(),u=c()(),p=c()();s.placeShip(0,0,"horizontal",a()(5)),s.placeShip(3,4,"horizontal",a()(3)),s.placeShip(6,7,"horizontal",a()(2)),s.placeShip(9,1,"vertical",a()(3)),s.placeShip(5,9,"horizontal",a()(4)),h.placeShip(0,0,"horizontal",a()(5)),h.placeShip(3,4,"horizontal",a()(3)),h.placeShip(6,7,"horizontal",a()(2)),h.placeShip(9,1,"vertical",a()(3)),h.placeShip(5,9,"horizontal",a()(4));const d=(()=>{const e={};return{publish:function(t,o){Array.isArray(e[t])&&e[t].forEach((e=>{e(o)}))},subscribe:function t(o,r){Array.isArray(t[o])||(e[o]=[]),e[o].push(r);const n=e[o].length-1;return{unsubscribe(){e[o].splice(n,1)}}}}})();((e,t,o,r,n)=>{const i=document.querySelector("div.enemy-board");for(let a=0;a<10;a+=1)for(let l=0;l<10;l+=1){const c=i.querySelector(`.cell:nth-child(${10*l+a+1})`);c.setAttribute("column",a),c.setAttribute("row",l),c.addEventListener("click",(()=>{n.publish("click",{cell:c,column:a,row:l,playerBoard:e,enemyBoard:t,player:o,enemy:r})}),{once:!0})}})(s,h,u,p,d),d.subscribe("click",(({cell:o,column:r,row:n,playerBoard:i,enemyBoard:a,player:l,enemy:c})=>{((o,r,n,i)=>{t(o,r,n,i),e("enemy",o,r,n)})(r,n,a,l),((o,r)=>{const{randomColumn:n,randomRow:i}=o.makeRandomCoordinates();t(n,n,o,r),e("player",n,i,o)})(i,c),((e,t)=>{console.log(t.checkIfAllShipsHaveSunk()),e.checkIfAllShipsHaveSunk()&&console.log("PLAYER won"),t.checkIfAllShipsHaveSunk()&&console.log("ENEMY won")})(i,a)})),(({getLocation:e})=>{const t=document.querySelector("div.player-board");for(let o=0;o<10;o+=1)for(let r=0;r<10;r+=1){const n=t.querySelector(`.cell:nth-child(${10*r+o+1})`);n.setAttribute("column",o),n.setAttribute("row",r),e(r,o).isShip&&n.classList.add("ship")}})(s)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QixFQUFhZSxHQTVEVixFQUFDZixFQUFhUCxLQUNsQzhCLFFBQVFDLElBQUkvQixFQUFXdEMsMkJBQ3BCNkMsRUFBWTdDLDJCQUNYb0UsUUFBUUMsSUFBSSxjQUViL0IsRUFBV3RDLDJCQUNWb0UsUUFBUUMsSUFBSSxjQXdEaEJDLENBQWdCekIsRUFBYVAsTUEvRUEsR0FBR3hFLGtCQUNoQyxNQUFNeUcsRUFBa0IvQixTQUFTQyxjQUFjLG9CQUUvQyxJQUFLLElBQUkxRSxFQUFTLEVBQUdBLEVBQVMsR0FBSUEsR0FBVSxFQUN4QyxJQUFLLElBQUlDLEVBQU0sRUFBR0EsRUFBTSxHQUFJQSxHQUFPLEVBQUcsQ0FDbEMsTUFBTXVFLEVBQU9nQyxFQUFnQjlCLGNBQ3pCLG1CQUF5QixHQUFOekUsRUFBV0QsRUFBUyxNQUUzQ3dFLEVBQUt1QixhQUFhLFNBQVUvRixHQUM1QndFLEVBQUt1QixhQUFhLE1BQU85RixHQUNyQkYsRUFBWUUsRUFBS0QsR0FBUVQsUUFDekJpRixFQUFLRyxVQUFVQyxJQUFJLFVDbENuQzZCLENBQWtCM0IsSSIsInNvdXJjZXMiOlsid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL2dhbWVib2FyZC9nYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvcGxheWVyL3BsYXllci5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9zaGlwL3NoaXAuanMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2NvbXBhdCBnZXQgZGVmYXVsdCBleHBvcnQiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvZG9tLmpzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG5vLW11bHRpLWFzc2lnbiAqL1xuLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLWV4cHJlc3Npb25zICovXG5jb25zdCBjcmVhdGVTaGlwID0gcmVxdWlyZSgnLi4vc2hpcC9zaGlwJylcblxuLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi9cbmNvbnN0IGNyZWF0ZUdhbWVCb2FyZCA9ICgpID0+IHtcbiAgICBjb25zdCBlbXB0eUNlbGwgPSB7IGhhc0JlZW5IaXQ6IGZhbHNlLCBpc1NoaXA6IGZhbHNlLCBvZmZMaW1pdHM6IGZhbHNlIH1cbiAgICBjb25zdCBnYW1lQm9hcmQgPSBBcnJheSgxMClcbiAgICAgICAgLmZpbGwoc3RydWN0dXJlZENsb25lKGVtcHR5Q2VsbCkpXG4gICAgICAgIC5tYXAoKCkgPT4gQXJyYXkoMTApLmZpbGwoc3RydWN0dXJlZENsb25lKGVtcHR5Q2VsbCkpKVxuXG4gICAgY29uc3Qgc2hpcHMgPSBbXG4gICAgICAgIGNyZWF0ZVNoaXAoNSwgJ0NhcnJpZXInKSxcbiAgICAgICAgY3JlYXRlU2hpcCg0LCAnQmF0dGxlc2hpcCcpLFxuICAgICAgICBjcmVhdGVTaGlwKDMsICdEZXN0cm95ZXInKSxcbiAgICAgICAgY3JlYXRlU2hpcCgzLCAnU3VibWFyaW5lJyksXG4gICAgICAgIGNyZWF0ZVNoaXAoMiwgJ1BhdHJvbCBCb2F0JyksXG4gICAgXVxuXG5cbiAgICBjb25zdCBjcmVhdGVPZmZMaW1pdExvY2F0aW9uID0gKCkgPT5cbiAgICAgICAgT2JqZWN0LmFzc2lnbihlbXB0eUNlbGwsIHsgb2ZmTGltaXRzOiB0cnVlIH0pXG5cbiAgICBjb25zdCBnZXRMb2NhdGlvbiA9IChjb2x1bW4sIHJvdykgPT4gZ2FtZUJvYXJkPy5bY29sdW1uXT8uW3Jvd11cblxuICAgIGNvbnN0IHNldExvY2F0aW9uID0gKGNvbHVtbiwgcm93LCBzaGlwID0gY3JlYXRlT2ZmTGltaXRMb2NhdGlvbigpKSA9PiB7XG4gICAgICAgIGlmIChnYW1lQm9hcmQ/Lltjb2x1bW5dPy5bcm93XSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdHJ1ZVxuICAgICAgICBnYW1lQm9hcmRbY29sdW1uXVtyb3ddID0gc2hpcFxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBjb25zdCBjaGVja0lmQWxsU2hpcHNIYXZlU3VuayA9ICgpID0+IHtcblxuICAgICAgICBsZXQgaGF2ZUFsbFNoaXBzU3VuayA9dHJ1ZSAgXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgY29uc3QgbG9jYXRpb24gPSBnZXRMb2NhdGlvbihpLCBqKVxuICAgICAgICBpZihsb2NhdGlvbi5pc1NoaXAgPT09IGZhbHNlKSBjb250aW51ZVxuICAgICAgICBpZihsb2NhdGlvbi5pc1NoaXAgJiYgbG9jYXRpb24uaXNTdW5rKCkgPT09IGZhbHNlKXtcbiAgICAgICAgICAgaGF2ZUFsbFNoaXBzU3VuayA9IGZhbHNlIFxuICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaGF2ZUFsbFNoaXBzU3VuayBcbiAgICB9XG5cbiAgICBjb25zdCBhZGRPZmZMaW1pdEFyZWFGb3JTaGlwcyA9IChjb2x1bW4sIHJvdykgPT4ge1xuICAgICAgICAvLyB0b3AtbGVmdFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gLSAxLCByb3cgLSAxKVxuICAgICAgICAvLyB0b3BcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uLCByb3cgLSAxKVxuICAgIH1cblxuICAgIGNvbnN0IGFkZE9mZkxpbWl0QXJlYUZvckhvcml6b250YWxseVBvc2l0aW9uZWRTaGlwID0gKFxuICAgICAgICBjb2x1bW4sXG4gICAgICAgIHJvdyxcbiAgICAgICAgc2hpcExlbmd0aFxuICAgICkgPT4ge1xuICAgICAgICAvLyBwb3NpdGlvbnMgcmVsYXRpdmUgdG8gdGhlIHNoaXAgaXRzZWxmKGllLiBhIGhvcml6b250YWwgc2hpcCdzIGJvdHRvbSBpcyB0byB0aGUgcmlnaHQpXG5cbiAgICAgICAgYWRkT2ZmTGltaXRBcmVhRm9yU2hpcHMoY29sdW1uLCByb3cpXG4gICAgICAgIC8vIGJvdHRvbVxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBzaGlwTGVuZ3RoLCByb3cpXG4gICAgICAgIC8vIGJvdHRvbS1sZWZ0XG4gICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiAtIDEsIHJvdyArIDEpXG4gICAgICAgIC8vIGJvdHRvbS1yaWdodFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBzaGlwTGVuZ3RoLCByb3cgKyAxKVxuICAgICAgICAvLyB0b3AtcmlnaHRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgc2hpcExlbmd0aCwgcm93IC0gMSlcbiAgICB9XG5cbiAgICBjb25zdCBhZGRPZmZMaW1pdEFyZWFGb3JWZXJ0aWNhbGx5UG9zaXRpb25lZFNoaXAgPSAoXG4gICAgICAgIGNvbHVtbixcbiAgICAgICAgcm93LFxuICAgICAgICBzaGlwTGVuZ3RoXG4gICAgKSA9PiB7XG4gICAgICAgIC8vIHBvc2l0aW9ucyByZWxhdGl2ZSB0byBob3cgdGhlIHVzZXIgc2VlcyBpdChpZS4gYSB2ZXJ0aWNhbCBzaGlwJ3MgYm90dG9tIGlzIHRvIHRoZSBib3R0b20pXG5cbiAgICAgICAgYWRkT2ZmTGltaXRBcmVhRm9yU2hpcHMoY29sdW1uLCByb3cpXG4gICAgICAgIC8vIGJvdHRvbVxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4sIHJvdyArIHNoaXBMZW5ndGgpXG4gICAgICAgIC8vIGJvdHRvbS1yaWdodFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyAxLCByb3cgKyBzaGlwTGVuZ3RoKVxuICAgICAgICAvLyBib3R0b20tbGVmdFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gLSAxLCByb3cgKyBzaGlwTGVuZ3RoKVxuICAgICAgICAvLyB0b3AtcmlnaHRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgMSwgcm93IC0gMSlcbiAgICB9XG5cbiAgICBjb25zdCBjaGVja0lmQ29sdW1uQ29vcmRpbmF0ZUlzVmFsaWQgPSAoY29sdW1uLCBzaGlwTGVuZ3RoKSA9PlxuICAgICAgICBjb2x1bW4gPj0gMCAmJiBjb2x1bW4gKyBzaGlwTGVuZ3RoIC0gMSA8IGdhbWVCb2FyZC5sZW5ndGhcblxuICAgIGNvbnN0IGNoZWNrSWZSb3dDb29yZGluYXRlSXNWYWxpZCA9IChyb3csIHNoaXBMZW5ndGgpID0+XG4gICAgICAgIHJvdyA+PSAwICYmIHJvdyArIHNoaXBMZW5ndGggLSAxIDwgZ2FtZUJvYXJkLmxlbmd0aFxuXG4gICAgY29uc3QgY2hlY2tJZkxvY2F0aW9uSXNBU2hpcE9yT2ZmTGltaXRzID0gKGxvY2F0aW9uKSA9PiB7XG4gICAgICAgIGlmIChsb2NhdGlvbi5pc1NoaXAgPT09IHRydWUgfHwgbG9jYXRpb24ub2ZmTGltaXRzID09PSB0cnVlKSByZXR1cm4gdHJ1ZVxuXG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIGNvbnN0IHBsYWNlU2hpcCA9IChjb2x1bW4sIHJvdywgZGlyZWN0aW9uLCBzaGlwKSA9PiB7XG4gICAgICAgIGlmIChjaGVja0lmTG9jYXRpb25Jc0FTaGlwT3JPZmZMaW1pdHMoZ2V0TG9jYXRpb24oY29sdW1uLCByb3cpKSlcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICBjb25zdCBzaGlwTGVuZ3RoID0gc2hpcC5nZXRMZW5ndGgoKVxuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSAndmVydGljYWwnKSB7XG4gICAgICAgICAgICBpZiAoY2hlY2tJZlJvd0Nvb3JkaW5hdGVJc1ZhbGlkKHJvdywgc2hpcExlbmd0aCkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBnYW1lQm9hcmRbY29sdW1uXVsgcm93ICsgaV0gPSB7IC4uLnNoaXAsIHBvc2l0aW9uIDogaX1cbiAgICAgICAgICAgICAgICAgICAgLy9zZXRMb2NhdGlvbihjb2x1bW4sIHJvdyArIGksIHNoaXApXG4gICAgICAgICAgICAgICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiArIDEsIHJvdyArIGkpXG4gICAgICAgICAgICAgICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiAtIDEsIHJvdyArIGkpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFkZE9mZkxpbWl0QXJlYUZvclZlcnRpY2FsbHlQb3NpdGlvbmVkU2hpcChcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uLFxuICAgICAgICAgICAgICAgICAgICByb3csXG4gICAgICAgICAgICAgICAgICAgIHNoaXBMZW5ndGhcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdob3Jpem9udGFsJykge1xuICAgICAgICAgICAgaWYgKGNoZWNrSWZDb2x1bW5Db29yZGluYXRlSXNWYWxpZChjb2x1bW4sIHNoaXBMZW5ndGgpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZUJvYXJkW2NvbHVtbiArIGldWyByb3cgXSA9IHsgLi4uc2hpcCwgcG9zaXRpb246IGl9XG4gICAgICAgICAgICAgICAgICAgIC8vc2V0TG9jYXRpb24oY29sdW1uICsgaSwgcm93LCBzaGlwKVxuICAgICAgICAgICAgICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBpLCByb3cgKyAxKVxuICAgICAgICAgICAgICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBpLCByb3cgLSAxKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhZGRPZmZMaW1pdEFyZWFGb3JIb3Jpem9udGFsbHlQb3NpdGlvbmVkU2hpcChcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uLFxuICAgICAgICAgICAgICAgICAgICByb3csXG4gICAgICAgICAgICAgICAgICAgIHNoaXBMZW5ndGhcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gICAgY29uc3QgbWFrZVJhbmRvbUNvb3JkaW5hdGVzID0gKCkgPT4ge1xuICAgICAgICBjb25zdCByYW5kb21EaXJlY3Rpb24gPVxuICAgICAgICAgICAgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMikgPT09IDAgPyAndmVydGljYWwnIDogJ2hvcml6b250YWwnXG4gICAgICAgIGNvbnN0IHJhbmRvbUNvbHVtbiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKVxuICAgICAgICBjb25zdCByYW5kb21Sb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMClcbiAgICAgICAgcmV0dXJuIHsgcmFuZG9tQ29sdW1uLCByYW5kb21Sb3csIHJhbmRvbURpcmVjdGlvbiB9XG4gICAgfVxuXG4gICAgY29uc3QgcmFuZG9tbHlQbGFjZVNoaXBzID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBzaGlwRGV0YWlscyA9IFtdXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGNvbnN0IHNoaXAgPSBzaGlwc1tpXVxuICAgICAgICAgICAgY29uc3QgeyByYW5kb21Db2x1bW4sIHJhbmRvbVJvdywgcmFuZG9tRGlyZWN0aW9uIH0gPVxuICAgICAgICAgICAgICAgIG1ha2VSYW5kb21Db29yZGluYXRlcyhzaGlwLmdldExlbmd0aCgpKVxuICAgICAgICAgICAgaWYgKHBsYWNlU2hpcChyYW5kb21Db2x1bW4sIHJhbmRvbVJvdywgcmFuZG9tRGlyZWN0aW9uLCBzaGlwKSkge1xuICAgICAgICAgICAgICAgIHNoaXBEZXRhaWxzLnB1c2goeyByYW5kb21Db2x1bW4sIHJhbmRvbVJvdywgcmFuZG9tRGlyZWN0aW9uIH0pXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGkgLT0gMVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzaGlwRGV0YWlsc1xuICAgIH1cblxuICAgIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29sdW1uLCByb3cpID0+IHtcbiAgICAgICAgZ2FtZUJvYXJkW2NvbHVtbl1bcm93XS5oYXNCZWVuSGl0ID0gdHJ1ZVxuICAgIH1cblxuICAgIGNvbnN0IGNoZWNrSWZPZmZMaW1pdFpvbmVXYXNDb3JyZWN0bHlJbXBsZW1lbnRlZCA9IChzaGlwTGVuZ3RoKSA9PlxuICAgICAgICBnYW1lQm9hcmQuZmxhdCgpLmZpbHRlcigoZWxlbWVudCkgPT4gZWxlbWVudC5vZmZMaW1pdHMgPT09IHRydWUpXG4gICAgICAgICAgICAubGVuZ3RoID09PVxuICAgICAgICBzaGlwTGVuZ3RoICsgMlxuICAgIC8vIGFkZGluZyBzaGlwTGVuZ3RoIHBsdXMgdHdvIGJlY2F1c2UgZm9yIGV2ZXJ5IGluY3JlYXNlIGluIHRoZSBzaXplIG9mIHNoaXAsIHRoZSB6b25lcyBjb3ZlcmVkIGluY3JlYXNlIGJ5IDIgdW5pdHNcblxuICAgIHJldHVybiB7XG4gICAgICAgIGNoZWNrSWZPZmZMaW1pdFpvbmVXYXNDb3JyZWN0bHlJbXBsZW1lbnRlZCxcbiAgICAgICAgZ2V0TG9jYXRpb24sXG4gICAgICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgICAgIGNoZWNrSWZBbGxTaGlwc0hhdmVTdW5rLFxuICAgICAgICBwbGFjZVNoaXAsXG4gICAgICAgIHJhbmRvbWx5UGxhY2VTaGlwcyxcbiAgICAgICAgbWFrZVJhbmRvbUNvb3JkaW5hdGVzLFxuICAgIH1cbn1cbm1vZHVsZS5leHBvcnRzID0gY3JlYXRlR2FtZUJvYXJkXG4iLCJjb25zdCBjcmVhdGVQbGF5ZXIgPSAobmFtZSA9ICdwbGF5ZXInKSA9PiB7XG4gICAgY29uc3QgZ2V0TmFtZSA9ICgpID0+IG5hbWVcblxuICAgIGNvbnN0IGF0dGFjayA9IChjb2x1bW4sIHJvdywgeyBnZXRMb2NhdGlvbiwgcmVjZWl2ZUF0dGFjayB9KSA9PiB7XG4gICAgICAgIGNvbnN0IGxvY2F0aW9uID0gZ2V0TG9jYXRpb24oY29sdW1uLCByb3cpXG4gICAgICAgIGlmIChsb2NhdGlvbi5oYXNCZWVuSGl0ID09PSBmYWxzZSB8fCAobG9jYXRpb24uaXNTaGlwICYmIGxvY2F0aW9uLmdldFN0YXR1cygpLmluY2x1ZGVzKCd1bmhpdCcpID09PSBmYWxzZSkpIHtcbiAgICAgICAgICAgIHJlY2VpdmVBdHRhY2soY29sdW1uLCByb3cpXG4gICAgICAgICAgICBsb2NhdGlvbi5oaXQobG9jYXRpb24ucG9zaXRpb24pXG4gICAgICAgICAgICByZXR1cm4gXCJJdCdzIGEgaGl0IVwiXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gJ1lvdSBoYXZlIGFscmVhZHkgaGl0IHRoaXMgc3BvdCEnXG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgZ2V0TmFtZSxcbiAgICAgICAgYXR0YWNrLFxuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjcmVhdGVQbGF5ZXJcbiIsImNvbnN0IGNyZWF0ZVNoaXAgPSAobGVuZ3RoLCBuYW1lID0gJ3NoaXAnKSA9PiB7XG5cbiAgICBjb25zdCBzdGF0dXMgPSBBcnJheShsZW5ndGgpLmZpbGwoJ3VuaGl0JylcblxuICAgIGNvbnN0IGdldExlbmd0aCA9ICgpID0+IHN0YXR1cy5sZW5ndGhcblxuICAgIGNvbnN0IGdldFN0YXR1cyA9ICgpID0+IHN0YXR1c1xuXG4gICAgY29uc3QgaGl0ID0gKHBvc2l0aW9uKSA9PiB7XG4gICAgICAgIGlmIChwb3NpdGlvbiA8IGxlbmd0aCkge1xuICAgICAgICAgICAgc3RhdHVzW3Bvc2l0aW9uXSA9ICdoaXQnXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBpc1N1bmsgPSAoKSA9PiBzdGF0dXMuZXZlcnkoKHBvc2l0aW9uKSA9PiBwb3NpdGlvbiA9PT0gJ2hpdCcpXG5cbiAgICByZXR1cm4ge1xuICAgICAgICBuYW1lLFxuICAgICAgICBnZXRMZW5ndGgsXG4gICAgICAgIGlzU3VuayxcbiAgICAgICAgaGl0LFxuICAgICAgICBnZXRTdGF0dXMsXG4gICAgICAgIGhhc0JlZW5IaXQ6IGZhbHNlLFxuICAgICAgICBpc1NoaXA6IHRydWUsXG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZVNoaXBcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuX193ZWJwYWNrX3JlcXVpcmVfXy5uID0gKG1vZHVsZSkgPT4ge1xuXHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cblx0XHQoKSA9PiAobW9kdWxlWydkZWZhdWx0J10pIDpcblx0XHQoKSA9PiAobW9kdWxlKTtcblx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgeyBhOiBnZXR0ZXIgfSk7XG5cdHJldHVybiBnZXR0ZXI7XG59OyIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCJjb25zdCByZW5kZXJBdHRhY2tzID0gKHBsYXllciwgY29sdW1uLCByb3csIGVuZW15Qm9hcmQpID0+IHtcbiAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgYC4ke3BsYXllcn0tYm9hcmQgPiAuY2VsbFtjb2x1bW49JyR7Y29sdW1ufSddW3Jvdz0nJHtyb3d9J11gXG4gICAgKVxuXG4gICAgY29uc3QgbG9jYXRpb24gPSBlbmVteUJvYXJkLmdldExvY2F0aW9uKGNvbHVtbiwgcm93KVxuICAgIGlmIChsb2NhdGlvbi5pc1NoaXApIHtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdoaXQnKVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnbWlzcycpXG4gICAgfVxufVxuXG5jb25zdCBoYW5kbGVBdHRhY2sgPSAoY29sdW1uLCByb3csIGVuZW15Qm9hcmQsIHBsYXllcikgPT5cbiAgICBwbGF5ZXIuYXR0YWNrKGNvbHVtbiwgcm93LCBlbmVteUJvYXJkKVxuXG5jb25zdCBhdHRhY2tFbmVteUNlbGwgPSAoY29sdW1uLCByb3csIGVuZW15Qm9hcmQsIHBsYXllcikgPT4ge1xuICAgIGhhbmRsZUF0dGFjayhjb2x1bW4sIHJvdywgZW5lbXlCb2FyZCwgcGxheWVyKVxuICAgIHJlbmRlckF0dGFja3MoJ2VuZW15JywgY29sdW1uLCByb3csIGVuZW15Qm9hcmQpXG59XG5cbmNvbnN0IGF0dGFja1BsYXllckNlbGwgPSAocGxheWVyQm9hcmQsIGVuZW15KSA9PiB7XG4gICAgY29uc3QgeyByYW5kb21Db2x1bW4sIHJhbmRvbVJvdyB9ID0gcGxheWVyQm9hcmQubWFrZVJhbmRvbUNvb3JkaW5hdGVzKClcbiAgICBoYW5kbGVBdHRhY2socmFuZG9tQ29sdW1uLCByYW5kb21Db2x1bW4sIHBsYXllckJvYXJkLCBlbmVteSlcbiAgICByZW5kZXJBdHRhY2tzKCdwbGF5ZXInLCByYW5kb21Db2x1bW4sIHJhbmRvbVJvdywgcGxheWVyQm9hcmQpXG59XG4vLyBodHRwczovL2pzbWFuaWZlc3QuY29tL3RoZS1wdWJsaXNoLXN1YnNjcmliZS1wYXR0ZXJuLWluLWphdmFzY3JpcHQvXG5cbmV4cG9ydCBjb25zdCBwdWJTdWIgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3Vic2NyaWJlcnMgPSB7fVxuXG4gICAgZnVuY3Rpb24gcHVibGlzaChldmVudE5hbWUsIGRhdGEpIHtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHN1YnNjcmliZXJzW2V2ZW50TmFtZV0pKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICBzdWJzY3JpYmVyc1tldmVudE5hbWVdLmZvckVhY2goKGNhbGxiYWNrKSA9PiB7XG4gICAgICAgICAgICBjYWxsYmFjayhkYXRhKVxuICAgICAgICB9KVxuICAgIH1cbiAgICBmdW5jdGlvbiBzdWJzY3JpYmUoZXZlbnROYW1lLCBjYWxsYmFjaykge1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc3Vic2NyaWJlW2V2ZW50TmFtZV0pKSB7XG4gICAgICAgICAgICBzdWJzY3JpYmVyc1tldmVudE5hbWVdID0gW11cbiAgICAgICAgfVxuICAgICAgICBzdWJzY3JpYmVyc1tldmVudE5hbWVdLnB1c2goY2FsbGJhY2spXG4gICAgICAgIGNvbnN0IGluZGV4ID0gc3Vic2NyaWJlcnNbZXZlbnROYW1lXS5sZW5ndGggLSAxXG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHVuc3Vic2NyaWJlKCkge1xuICAgICAgICAgICAgICAgIHN1YnNjcmliZXJzW2V2ZW50TmFtZV0uc3BsaWNlKGluZGV4LCAxKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIHB1Ymxpc2gsXG4gICAgICAgIHN1YnNjcmliZSxcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCByZW5kZXJQbGF5ZXJTaGlwcyA9ICh7IGdldExvY2F0aW9uIH0pID0+IHtcbiAgICBjb25zdCBwbGF5ZXJCb2FyZEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXYucGxheWVyLWJvYXJkJylcblxuICAgIGZvciAobGV0IGNvbHVtbiA9IDA7IGNvbHVtbiA8IDEwOyBjb2x1bW4gKz0gMSkge1xuICAgICAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCAxMDsgcm93ICs9IDEpIHtcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBwbGF5ZXJCb2FyZEFyZWEucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgICBgLmNlbGw6bnRoLWNoaWxkKCR7cm93ICogMTAgKyBjb2x1bW4gKyAxfSlgXG4gICAgICAgICAgICApXG4gICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgnY29sdW1uJywgY29sdW1uKVxuICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ3JvdycsIHJvdylcbiAgICAgICAgICAgIGlmIChnZXRMb2NhdGlvbihyb3csIGNvbHVtbikuaXNTaGlwKSB7XG4gICAgICAgICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdzaGlwJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuY29uc3QgY2hlY2tJZkdhbWVPdmVyID0gKHBsYXllckJvYXJkLCBlbmVteUJvYXJkKSA9PiB7XG4gICAgY29uc29sZS5sb2coZW5lbXlCb2FyZC5jaGVja0lmQWxsU2hpcHNIYXZlU3VuaygpKVxuICAgIGlmKHBsYXllckJvYXJkLmNoZWNrSWZBbGxTaGlwc0hhdmVTdW5rKCkpe1xuICAgICAgICBjb25zb2xlLmxvZygnUExBWUVSIHdvbicpXG4gICAgfVxuICAgIGlmKGVuZW15Qm9hcmQuY2hlY2tJZkFsbFNoaXBzSGF2ZVN1bmsoKSl7XG4gICAgICAgIGNvbnNvbGUubG9nKCdFTkVNWSB3b24nKVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGFkZExpc3RlbmVyc1RvRW5lbXlCb2FyZCA9IChcbiAgICBwbGF5ZXJCb2FyZCxcbiAgICBlbmVteUJvYXJkLFxuICAgIHBsYXllcixcbiAgICBlbmVteSxcbiAgICBwc1xuKSA9PiB7XG4gICAgY29uc3QgZW5lbXlCb2FyZEFyZWEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdkaXYuZW5lbXktYm9hcmQnKVxuXG4gICAgZm9yIChsZXQgY29sdW1uID0gMDsgY29sdW1uIDwgMTA7IGNvbHVtbiArPSAxKSB7XG4gICAgICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IDEwOyByb3cgKz0gMSkge1xuICAgICAgICAgICAgLy8gQ3JlZGl0aW5nIGZvcm11bGEgdG8gY2FsY3VsYXRlIG50aC1jaGlsZCB1c2luZyBuZXN0ZWQgbG9vcDogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvODg3MjY2Mi9tYXRoLXRvLWRldGVybWluZS1pdGVtLWluZGV4LWJhc2VkLW9uLWNvbC1yb3ctc2VsZWN0aW9uLWluLWdyaWRcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBlbmVteUJvYXJkQXJlYS5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgICAgIGAuY2VsbDpudGgtY2hpbGQoJHtyb3cgKiAxMCArIGNvbHVtbiArIDF9KWBcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdjb2x1bW4nLCBjb2x1bW4pXG4gICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgncm93Jywgcm93KVxuXG4gICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgICAgICAgICAgJ2NsaWNrJyxcbiAgICAgICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHBzLnB1Ymxpc2goJ2NsaWNrJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2VsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbixcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllckJvYXJkLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXlCb2FyZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsYXllcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15LFxuICAgICAgICAgICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7IG9uY2U6IHRydWUgfVxuICAgICAgICAgICAgKVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgYXR0YWNrID0gKHtcbiAgICBjZWxsLFxuICAgIGNvbHVtbixcbiAgICByb3csXG4gICAgcGxheWVyQm9hcmQsXG4gICAgZW5lbXlCb2FyZCxcbiAgICBwbGF5ZXIsXG4gICAgZW5lbXksXG59KSA9PiB7XG4gICAgLy8gaHVtYW4gcGxheWVyIGF0dGFja2luZyBjb21wdXRlclxuICAgIGF0dGFja0VuZW15Q2VsbChjb2x1bW4sIHJvdywgZW5lbXlCb2FyZCwgcGxheWVyKVxuICAgIC8vIGNvbXB1dGVyIGF0dGFja2luZyBodW1hblxuICAgIGF0dGFja1BsYXllckNlbGwocGxheWVyQm9hcmQsIGVuZW15KVxuXG4gICAgY2hlY2tJZkdhbWVPdmVyKHBsYXllckJvYXJkLCBlbmVteUJvYXJkKVxuXG59XG4iLCJpbXBvcnQgeyBhZGRMaXN0ZW5lcnNUb0VuZW15Qm9hcmQsIHJlbmRlclBsYXllclNoaXBzLHB1YlN1YiwgYXR0YWNrfSBmcm9tICcuL2RvbSdcblxuaW1wb3J0IGNyZWF0ZUdhbWVCb2FyZCBmcm9tICcuL2dhbWVib2FyZC9nYW1lYm9hcmQnXG5pbXBvcnQgY3JlYXRlU2hpcCBmcm9tICcuL3NoaXAvc2hpcCdcbmltcG9ydCBjcmVhdGVQbGF5ZXIgZnJvbSAnLi9wbGF5ZXIvcGxheWVyJ1xuXG5jb25zdCBwbGF5ZXJCb2FyZCA9IGNyZWF0ZUdhbWVCb2FyZCgpXG5jb25zdCBlbmVteUJvYXJkID0gY3JlYXRlR2FtZUJvYXJkKClcblxuY29uc3QgcGxheWVyID0gY3JlYXRlUGxheWVyKClcblxuY29uc3QgY29tcHV0ZXIgPSBjcmVhdGVQbGF5ZXIoKVxuXG4vL3BsYXllckJvYXJkLnJhbmRvbWx5UGxhY2VTaGlwcygpXG4vL2VuZW15Qm9hcmQucmFuZG9tbHlQbGFjZVNoaXBzKClcbnBsYXllckJvYXJkLnBsYWNlU2hpcCgwLCAwLCAnaG9yaXpvbnRhbCcsIGNyZWF0ZVNoaXAoNSkpXG5wbGF5ZXJCb2FyZC5wbGFjZVNoaXAoMywgNCwgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDMpKVxucGxheWVyQm9hcmQucGxhY2VTaGlwKDYsIDcsICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCgyKSlcbnBsYXllckJvYXJkLnBsYWNlU2hpcCg5LCAxLCAndmVydGljYWwnLCBjcmVhdGVTaGlwKDMpKVxucGxheWVyQm9hcmQucGxhY2VTaGlwKDUsIDksICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCg0KSlcblxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoMCwgMCwgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDUpKVxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoMywgNCwgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDMpKVxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoNiwgNywgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDIpKVxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoOSwgMSwgJ3ZlcnRpY2FsJywgY3JlYXRlU2hpcCgzKSlcbmVuZW15Qm9hcmQucGxhY2VTaGlwKDUsIDksICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCg0KSlcblxuY29uc3QgcHMgPSBwdWJTdWIoKVxuXG5hZGRMaXN0ZW5lcnNUb0VuZW15Qm9hcmQocGxheWVyQm9hcmQsIGVuZW15Qm9hcmQsIHBsYXllciwgY29tcHV0ZXIsIHBzKVxuXG5wcy5zdWJzY3JpYmUoJ2NsaWNrJywgYXR0YWNrKVxuXG5cblxuXG5yZW5kZXJQbGF5ZXJTaGlwcyhwbGF5ZXJCb2FyZCkiXSwibmFtZXMiOlsiY3JlYXRlU2hpcCIsIm1vZHVsZSIsImV4cG9ydHMiLCJlbXB0eUNlbGwiLCJoYXNCZWVuSGl0IiwiaXNTaGlwIiwib2ZmTGltaXRzIiwiZ2FtZUJvYXJkIiwiQXJyYXkiLCJmaWxsIiwic3RydWN0dXJlZENsb25lIiwibWFwIiwic2hpcHMiLCJnZXRMb2NhdGlvbiIsImNvbHVtbiIsInJvdyIsInNldExvY2F0aW9uIiwic2hpcCIsIk9iamVjdCIsImFzc2lnbiIsImNyZWF0ZU9mZkxpbWl0TG9jYXRpb24iLCJ1bmRlZmluZWQiLCJhZGRPZmZMaW1pdEFyZWFGb3JTaGlwcyIsInBsYWNlU2hpcCIsImRpcmVjdGlvbiIsImxvY2F0aW9uIiwic2hpcExlbmd0aCIsImdldExlbmd0aCIsImxlbmd0aCIsImNoZWNrSWZSb3dDb29yZGluYXRlSXNWYWxpZCIsImkiLCJwb3NpdGlvbiIsImFkZE9mZkxpbWl0QXJlYUZvclZlcnRpY2FsbHlQb3NpdGlvbmVkU2hpcCIsImNoZWNrSWZDb2x1bW5Db29yZGluYXRlSXNWYWxpZCIsImFkZE9mZkxpbWl0QXJlYUZvckhvcml6b250YWxseVBvc2l0aW9uZWRTaGlwIiwibWFrZVJhbmRvbUNvb3JkaW5hdGVzIiwicmFuZG9tRGlyZWN0aW9uIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicmFuZG9tQ29sdW1uIiwicmFuZG9tUm93IiwiY2hlY2tJZk9mZkxpbWl0Wm9uZVdhc0NvcnJlY3RseUltcGxlbWVudGVkIiwiZmxhdCIsImZpbHRlciIsImVsZW1lbnQiLCJyZWNlaXZlQXR0YWNrIiwiY2hlY2tJZkFsbFNoaXBzSGF2ZVN1bmsiLCJoYXZlQWxsU2hpcHNTdW5rIiwiaiIsImlzU3VuayIsInJhbmRvbWx5UGxhY2VTaGlwcyIsInNoaXBEZXRhaWxzIiwicHVzaCIsIm5hbWUiLCJnZXROYW1lIiwiYXR0YWNrIiwiZ2V0U3RhdHVzIiwiaW5jbHVkZXMiLCJoaXQiLCJzdGF0dXMiLCJldmVyeSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJuIiwiZ2V0dGVyIiwiX19lc01vZHVsZSIsImQiLCJhIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwicmVuZGVyQXR0YWNrcyIsInBsYXllciIsImVuZW15Qm9hcmQiLCJjZWxsIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY2xhc3NMaXN0IiwiYWRkIiwiaGFuZGxlQXR0YWNrIiwicGxheWVyQm9hcmQiLCJjb21wdXRlciIsInBzIiwic3Vic2NyaWJlcnMiLCJwdWJsaXNoIiwiZXZlbnROYW1lIiwiZGF0YSIsImlzQXJyYXkiLCJmb3JFYWNoIiwiY2FsbGJhY2siLCJzdWJzY3JpYmUiLCJpbmRleCIsInVuc3Vic2NyaWJlIiwic3BsaWNlIiwicHViU3ViIiwiZW5lbXkiLCJlbmVteUJvYXJkQXJlYSIsInNldEF0dHJpYnV0ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJvbmNlIiwiYWRkTGlzdGVuZXJzVG9FbmVteUJvYXJkIiwiYXR0YWNrRW5lbXlDZWxsIiwiYXR0YWNrUGxheWVyQ2VsbCIsImNvbnNvbGUiLCJsb2ciLCJjaGVja0lmR2FtZU92ZXIiLCJwbGF5ZXJCb2FyZEFyZWEiLCJyZW5kZXJQbGF5ZXJTaGlwcyJdLCJzb3VyY2VSb290IjoiIn0=