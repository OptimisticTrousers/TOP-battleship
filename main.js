(()=>{var t={653:(t,e,o)=>{const r=o(585);t.exports=()=>{const t={hasBeenHit:!1,isShip:!1,offLimits:!1},e=Array(10).fill(structuredClone(t)).map((()=>Array(10).fill(structuredClone(t)))),o=[r(5,"Carrier"),r(4,"Battleship"),r(3,"Destroyer"),r(3,"Submarine"),r(2,"Patrol Boat")],i=(t,o)=>e?.[t]?.[o],a=(o,r,i=(()=>Object.assign(t,{offLimits:!0}))())=>(void 0===e?.[o]?.[r]||(e[o][r]=i),!0),n=(t,e)=>{a(t-1,e-1),a(t,e-1)},s=(t,o,r,i)=>{const s=i.getLength();if("vertical"===r){if(o>=0&&o+s-1<e.length){for(let e=0;e<s;e+=1)a(t,o+e,i),a(t+1,o+e),a(t-1,o+e);return((t,e,o)=>{n(t,e),a(t,e+o),a(t+1,e+o),a(t-1,e+o),a(t+1,e-1)})(t,o,s),!0}}else if("horizontal"===r&&t>=0&&t+s-1<e.length){for(let e=0;e<s;e+=1)a(t+e,o,i),a(t+e,o+1),a(t+e,o-1);return((t,e,o)=>{n(t,e),a(t+o,e),a(t-1,e+1),a(t+o,e+1),a(t+o,e-1)})(t,o,s),!0}return!1},l=()=>{const t=0===Math.floor(2*Math.random())?"vertical":"horizontal";return{randomColumn:Math.floor(10*Math.random()),randomRow:Math.floor(10*Math.random()),randomDirection:t}};return{checkIfOffLimitZoneWasCorrectlyImplemented:t=>e.flat().filter((t=>!0===t.offLimits)).length===t+2,getLocation:i,receiveAttack:(t,o)=>{e[t][o].hasBeenHit=!0},checkIfAllShipsHaveSunk:()=>e.flat().every((t=>!1===t.isShip||!0===t.isShip&&!0===t.hasBeenHit&&t.getStatus().every((t=>"hit"===t)))),placeShip:s,randomlyPlaceShips:()=>{const t=[];for(let e=0;e<o.length;e+=1){const{randomColumn:r,randomRow:a,randomDirection:n}=l(),c=o[e],h=i(r,a);!0===h.isShip||!0===h.offLimits||!1===s(r,a,n,c)?e-=1:t.push({randomColumn:r,randomRow:a,randomDirection:n})}return t},makeRandomCoordinates:l}}},61:t=>{t.exports=(t="player")=>({getName:()=>t,attack:(t,e,{getLocation:o,receiveAttack:r})=>void 0===o(t,e).hasBeenHit?(r(t,e),"It's a hit!"):"You have already hit this spot!"})},585:t=>{t.exports=(t,e="ship")=>{const o=Array(t).fill("unhit");return{name:e,getLength:()=>o.length,isSunk:()=>o.every((t=>"hit"===t)),hit:e=>{e<t&&(o[e]="hit")},getStatus:()=>o,isShip:!0}}}},e={};function o(r){var i=e[r];if(void 0!==i)return i.exports;var a=e[r]={exports:{}};return t[r](a,a.exports,o),a.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=(t,e,o,r,i)=>{r.getLocation(e,o).isShip?t.classList.add("hit"):t.classList.add("miss")},e=(t,e,o)=>{const{randomColumn:r,randomRow:i}=e.makeRandomCoordinates();return((t,e,o,r,i)=>{r.getLocation(e,o).isShip?t.classList.add("hit"):t.classList.add("miss")})(t,r,i,e),{randomColumn:r,randomRow:i}},r=(t,e,o)=>{const r=document.querySelector(`.cell[column='${e}'][row='${o}']`);r.classList.contains("ship")?r.classList.add("hit"):r.classList.add("miss")};var i=o(653),a=o.n(i),n=o(585),s=o.n(n),l=o(61),c=o.n(l);const h=a()(),d=a()();c()(),c()(),h.randomlyPlaceShips(),d.placeShip(0,0,"horizontal",s()(5)),d.placeShip(3,4,"horizontal",s()(3)),d.placeShip(6,7,"horizontal",s()(2)),d.placeShip(9,1,"vertical",s()(3)),d.placeShip(5,9,"horizontal",s()(4)),((o,i,a,n)=>{const s=document.querySelector("div.enemy-board");for(let a=0;a<10;a+=1)for(let n=0;n<10;n+=1){const l=s.querySelector(`.cell:nth-child(${10*n+a+1})`);l.setAttribute("column",a),l.setAttribute("row",n),l.addEventListener("click",(()=>{t(l,a,n,i);const{randomColumn:s,randomRow:c}=e(l,o);r(0,s,c)}),{once:!0})}})(h,d),(({getLocation:t})=>{const e=document.querySelector("div.player-board");for(let o=0;o<10;o+=1)for(let r=0;r<10;r+=1){const i=e.querySelector(`.cell:nth-child(${10*r+o+1})`);i.setAttribute("column",o),i.setAttribute("row",r),t(r,o).isShip&&i.classList.add("ship")}})(h)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Y0FBYyxvQkFFL0MsSUFBSyxJQUFJN0UsRUFBUyxFQUFHQSxFQUFTLEdBQUlBLEdBQVUsRUFDeEMsSUFBSyxJQUFJQyxFQUFNLEVBQUdBLEVBQU0sR0FBSUEsR0FBTyxFQUFHLENBQ2xDLE1BQU04QixFQUFPcUQsRUFBZ0JQLGNBQ3pCLG1CQUF5QixHQUFONUUsRUFBV0QsRUFBUyxNQUUzQytCLEVBQUtpRCxhQUFhLFNBQVVoRixHQUM1QitCLEVBQUtpRCxhQUFhLE1BQU8vRSxHQUNyQkYsRUFBWUUsRUFBS0QsR0FBUVQsUUFDekJ3QyxFQUFLc0MsVUFBVUMsSUFBSSxVQ2xCbkNlLENBQWtCYixJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvZ2FtZWJvYXJkL2dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9wbGF5ZXIvcGxheWVyLmpzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL3NoaXAvc2hpcC5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC93ZWJwYWNrL3J1bnRpbWUvY29tcGF0IGdldCBkZWZhdWx0IGV4cG9ydCIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9kb20uanMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLWV4cHJlc3Npb25zICovXG5jb25zdCBjcmVhdGVTaGlwID0gcmVxdWlyZSgnLi4vc2hpcC9zaGlwJylcblxuLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi9cbmNvbnN0IGNyZWF0ZUdhbWVCb2FyZCA9ICgpID0+IHtcbiAgICBjb25zdCBlbXB0eUNlbGwgPSB7IGhhc0JlZW5IaXQ6IGZhbHNlLCBpc1NoaXA6IGZhbHNlLCBvZmZMaW1pdHM6IGZhbHNlIH1cbiAgICBjb25zdCBnYW1lQm9hcmQgPSBBcnJheSgxMClcbiAgICAgICAgLmZpbGwoc3RydWN0dXJlZENsb25lKGVtcHR5Q2VsbCkpXG4gICAgICAgIC5tYXAoKCkgPT4gQXJyYXkoMTApLmZpbGwoc3RydWN0dXJlZENsb25lKGVtcHR5Q2VsbCkpKVxuXG4gICAgY29uc3Qgc2hpcHMgPSBbXG4gICAgICAgIGNyZWF0ZVNoaXAoNSwgJ0NhcnJpZXInKSxcbiAgICAgICAgY3JlYXRlU2hpcCg0LCAnQmF0dGxlc2hpcCcpLFxuICAgICAgICBjcmVhdGVTaGlwKDMsICdEZXN0cm95ZXInKSxcbiAgICAgICAgY3JlYXRlU2hpcCgzLCAnU3VibWFyaW5lJyksXG4gICAgICAgIGNyZWF0ZVNoaXAoMiwgJ1BhdHJvbCBCb2F0JyksXG4gICAgXVxuXG4gICAgY29uc3QgY2hlY2tJZkFsbFNoaXBzSGF2ZVN1bmsgPSAoKSA9PlxuICAgICAgICBnYW1lQm9hcmQuZmxhdCgpLmV2ZXJ5KFxuICAgICAgICAgICAgKGNlbGwpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY2VsbC5pc1NoaXAgPT09IGZhbHNlKSByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICAgIGlmIChjZWxsLmlzU2hpcCA9PT0gdHJ1ZSAmJiBjZWxsLmhhc0JlZW5IaXQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbGwuZ2V0U3RhdHVzKCkuZXZlcnkoKHVuaXQpID0+IHVuaXQgPT09ICdoaXQnKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gKHBvc2l0aW9uLmlzU2hpcCA9PT0gZmFsc2UpIHx8XG4gICAgICAgICAgICAvLyAocG9zaXRpb24uaXNTaGlwID09PSB0cnVlICYmIHBvc2l0aW9uLmhhc0JlZW5IaXQgPT09IHRydWUpXG4gICAgICAgIClcblxuICAgIGNvbnN0IGNyZWF0ZU9mZkxpbWl0TG9jYXRpb24gPSAoKSA9PlxuICAgICAgICBPYmplY3QuYXNzaWduKGVtcHR5Q2VsbCwgeyBvZmZMaW1pdHM6IHRydWUgfSlcblxuICAgIGNvbnN0IGdldExvY2F0aW9uID0gKGNvbHVtbiwgcm93KSA9PiBnYW1lQm9hcmQ/Lltjb2x1bW5dPy5bcm93XVxuXG4gICAgY29uc3Qgc2V0TG9jYXRpb24gPSAoY29sdW1uLCByb3csIHNoaXAgPSBjcmVhdGVPZmZMaW1pdExvY2F0aW9uKCkpID0+IHtcbiAgICAgICAgaWYgKGdhbWVCb2FyZD8uW2NvbHVtbl0/Lltyb3ddID09PSB1bmRlZmluZWQpIHJldHVybiB0cnVlXG4gICAgICAgIGdhbWVCb2FyZFtjb2x1bW5dW3Jvd10gPSBzaGlwXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuXG4gICAgY29uc3QgYWRkT2ZmTGltaXRBcmVhRm9yU2hpcHMgPSAoY29sdW1uLCByb3cpID0+IHtcbiAgICAgICAgLy8gdG9wLWxlZnRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uIC0gMSwgcm93IC0gMSlcbiAgICAgICAgLy8gdG9wXG4gICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiwgcm93IC0gMSlcbiAgICB9XG5cbiAgICBjb25zdCBhZGRPZmZMaW1pdEFyZWFGb3JIb3Jpem9udGFsbHlQb3NpdGlvbmVkU2hpcCA9IChcbiAgICAgICAgY29sdW1uLFxuICAgICAgICByb3csXG4gICAgICAgIHNoaXBMZW5ndGhcbiAgICApID0+IHtcbiAgICAgICAgLy8gcG9zaXRpb25zIHJlbGF0aXZlIHRvIHRoZSBzaGlwIGl0c2VsZihpZS4gYSBob3Jpem9udGFsIHNoaXAncyBib3R0b20gaXMgdG8gdGhlIHJpZ2h0KVxuXG4gICAgICAgIGFkZE9mZkxpbWl0QXJlYUZvclNoaXBzKGNvbHVtbiwgcm93KVxuICAgICAgICAvLyBib3R0b21cbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgc2hpcExlbmd0aCwgcm93KVxuICAgICAgICAvLyBib3R0b20tbGVmdFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gLSAxLCByb3cgKyAxKVxuICAgICAgICAvLyBib3R0b20tcmlnaHRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgc2hpcExlbmd0aCwgcm93ICsgMSlcbiAgICAgICAgLy8gdG9wLXJpZ2h0XG4gICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiArIHNoaXBMZW5ndGgsIHJvdyAtIDEpXG4gICAgfVxuXG4gICAgY29uc3QgYWRkT2ZmTGltaXRBcmVhRm9yVmVydGljYWxseVBvc2l0aW9uZWRTaGlwID0gKFxuICAgICAgICBjb2x1bW4sXG4gICAgICAgIHJvdyxcbiAgICAgICAgc2hpcExlbmd0aFxuICAgICkgPT4ge1xuICAgICAgICAvLyBwb3NpdGlvbnMgcmVsYXRpdmUgdG8gaG93IHRoZSB1c2VyIHNlZXMgaXQoaWUuIGEgdmVydGljYWwgc2hpcCdzIGJvdHRvbSBpcyB0byB0aGUgYm90dG9tKVxuXG4gICAgICAgIGFkZE9mZkxpbWl0QXJlYUZvclNoaXBzKGNvbHVtbiwgcm93KVxuICAgICAgICAvLyBib3R0b21cbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uLCByb3cgKyBzaGlwTGVuZ3RoKVxuICAgICAgICAvLyBib3R0b20tcmlnaHRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgMSwgcm93ICsgc2hpcExlbmd0aClcbiAgICAgICAgLy8gYm90dG9tLWxlZnRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uIC0gMSwgcm93ICsgc2hpcExlbmd0aClcbiAgICAgICAgLy8gdG9wLXJpZ2h0XG4gICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiArIDEsIHJvdyAtIDEpXG4gICAgfVxuXG4gICAgY29uc3QgcGxhY2VTaGlwID0gKGNvbHVtbiwgcm93LCBkaXJlY3Rpb24sIHNoaXApID0+IHtcbiAgICAgICAgY29uc3Qgc2hpcExlbmd0aCA9IHNoaXAuZ2V0TGVuZ3RoKClcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ3ZlcnRpY2FsJykge1xuICAgICAgICAgICAgaWYgKHJvdyA+PSAwICYmIHJvdyArIHNoaXBMZW5ndGggLSAxIDwgZ2FtZUJvYXJkLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiwgcm93ICsgaSwgc2hpcClcbiAgICAgICAgICAgICAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgMSwgcm93ICsgaSlcbiAgICAgICAgICAgICAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uIC0gMSwgcm93ICsgaSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYWRkT2ZmTGltaXRBcmVhRm9yVmVydGljYWxseVBvc2l0aW9uZWRTaGlwKFxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4sXG4gICAgICAgICAgICAgICAgICAgIHJvdyxcbiAgICAgICAgICAgICAgICAgICAgc2hpcExlbmd0aFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ2hvcml6b250YWwnKSB7XG4gICAgICAgICAgICBpZiAoY29sdW1uID49IDAgJiYgY29sdW1uICsgc2hpcExlbmd0aCAtIDEgPCBnYW1lQm9hcmQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgaSwgcm93LCBzaGlwKVxuICAgICAgICAgICAgICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBpLCByb3cgKyAxKVxuICAgICAgICAgICAgICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBpLCByb3cgLSAxKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhZGRPZmZMaW1pdEFyZWFGb3JIb3Jpem9udGFsbHlQb3NpdGlvbmVkU2hpcChcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uLFxuICAgICAgICAgICAgICAgICAgICByb3csXG4gICAgICAgICAgICAgICAgICAgIHNoaXBMZW5ndGhcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICBjb25zdCBtYWtlUmFuZG9tQ29vcmRpbmF0ZXMgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJhbmRvbURpcmVjdGlvbiA9XG4gICAgICAgICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKSA9PT0gMCA/ICd2ZXJ0aWNhbCcgOiAnaG9yaXpvbnRhbCdcbiAgICAgICAgY29uc3QgcmFuZG9tQ29sdW1uID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApXG4gICAgICAgIGNvbnN0IHJhbmRvbVJvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKVxuICAgICAgICByZXR1cm4geyByYW5kb21Db2x1bW4sIHJhbmRvbVJvdywgcmFuZG9tRGlyZWN0aW9uIH1cbiAgICB9XG5cbiAgICBjb25zdCByYW5kb21seVBsYWNlU2hpcHMgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNoaXBEZXRhaWxzID0gW11cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgY29uc3QgeyByYW5kb21Db2x1bW4sIHJhbmRvbVJvdywgcmFuZG9tRGlyZWN0aW9uIH0gPVxuICAgICAgICAgICAgICAgIG1ha2VSYW5kb21Db29yZGluYXRlcygpXG4gICAgICAgICAgICBjb25zdCBzaGlwID0gc2hpcHNbaV1cbiAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uID0gZ2V0TG9jYXRpb24ocmFuZG9tQ29sdW1uLCByYW5kb21Sb3cpXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgbG9jYXRpb24uaXNTaGlwID09PSB0cnVlIHx8XG4gICAgICAgICAgICAgICAgbG9jYXRpb24ub2ZmTGltaXRzID09PSB0cnVlIHx8XG4gICAgICAgICAgICAgICAgcGxhY2VTaGlwKHJhbmRvbUNvbHVtbiwgcmFuZG9tUm93LCByYW5kb21EaXJlY3Rpb24sIHNoaXApID09PVxuICAgICAgICAgICAgICAgICAgICBmYWxzZVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgaSAtPSAxXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNoaXBEZXRhaWxzLnB1c2goeyByYW5kb21Db2x1bW4sIHJhbmRvbVJvdywgcmFuZG9tRGlyZWN0aW9uIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNoaXBEZXRhaWxzXG4gICAgfVxuXG4gICAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb2x1bW4sIHJvdykgPT4ge1xuICAgICAgICBnYW1lQm9hcmRbY29sdW1uXVtyb3ddLmhhc0JlZW5IaXQgPSB0cnVlXG4gICAgfVxuXG4gICAgY29uc3QgY2hlY2tJZk9mZkxpbWl0Wm9uZVdhc0NvcnJlY3RseUltcGxlbWVudGVkID0gKHNoaXBMZW5ndGgpID0+XG4gICAgICAgIGdhbWVCb2FyZC5mbGF0KCkuZmlsdGVyKChlbGVtZW50KSA9PiBlbGVtZW50Lm9mZkxpbWl0cyA9PT0gdHJ1ZSlcbiAgICAgICAgICAgIC5sZW5ndGggPT09XG4gICAgICAgIHNoaXBMZW5ndGggKyAyXG4gICAgLy8gYWRkaW5nIHNoaXBMZW5ndGggcGx1cyB0d28gYmVjYXVzZSBmb3IgZXZlcnkgaW5jcmVhc2UgaW4gdGhlIHNpemUgb2Ygc2hpcCwgdGhlIHpvbmVzIGNvdmVyZWQgaW5jcmVhc2UgYnkgMiB1bml0c1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgY2hlY2tJZk9mZkxpbWl0Wm9uZVdhc0NvcnJlY3RseUltcGxlbWVudGVkLFxuICAgICAgICBnZXRMb2NhdGlvbixcbiAgICAgICAgcmVjZWl2ZUF0dGFjayxcbiAgICAgICAgY2hlY2tJZkFsbFNoaXBzSGF2ZVN1bmssXG4gICAgICAgIHBsYWNlU2hpcCxcbiAgICAgICAgcmFuZG9tbHlQbGFjZVNoaXBzLFxuICAgICAgICBtYWtlUmFuZG9tQ29vcmRpbmF0ZXMsXG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZUdhbWVCb2FyZFxuIiwiY29uc3QgY3JlYXRlUGxheWVyID0gKG5hbWUgPSAncGxheWVyJykgPT4ge1xuICAgIGNvbnN0IGdldE5hbWUgPSAoKSA9PiBuYW1lXG5cbiAgICBjb25zdCBhdHRhY2sgPSAoY29sdW1uLCByb3csIHsgZ2V0TG9jYXRpb24sIHJlY2VpdmVBdHRhY2sgfSkgPT4ge1xuICAgICAgICBpZiAoZ2V0TG9jYXRpb24oY29sdW1uLCByb3cpLmhhc0JlZW5IaXQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVjZWl2ZUF0dGFjayhjb2x1bW4sIHJvdylcbiAgICAgICAgICAgIHJldHVybiBcIkl0J3MgYSBoaXQhXCJcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAnWW91IGhhdmUgYWxyZWFkeSBoaXQgdGhpcyBzcG90ISdcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBnZXROYW1lLFxuICAgICAgICBhdHRhY2ssXG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZVBsYXllclxuIiwiY29uc3QgY3JlYXRlU2hpcCA9IChsZW5ndGgsIG5hbWUgPSAnc2hpcCcpID0+IHtcblxuICAgIGNvbnN0IHN0YXR1cyA9IEFycmF5KGxlbmd0aCkuZmlsbCgndW5oaXQnKVxuXG4gICAgY29uc3QgZ2V0TGVuZ3RoID0gKCkgPT4gc3RhdHVzLmxlbmd0aFxuXG4gICAgY29uc3QgZ2V0U3RhdHVzID0gKCkgPT4gc3RhdHVzXG5cbiAgICBjb25zdCBoaXQgPSAocG9zaXRpb24pID0+IHtcbiAgICAgICAgaWYgKHBvc2l0aW9uIDwgbGVuZ3RoKSB7XG4gICAgICAgICAgICBzdGF0dXNbcG9zaXRpb25dID0gJ2hpdCdcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGlzU3VuayA9ICgpID0+IHN0YXR1cy5ldmVyeSgocG9zaXRpb24pID0+IHBvc2l0aW9uID09PSAnaGl0JylcblxuICAgIHJldHVybiB7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGdldExlbmd0aCxcbiAgICAgICAgaXNTdW5rLFxuICAgICAgICBoaXQsXG4gICAgICAgIGdldFN0YXR1cyxcbiAgICAgICAgaXNTaGlwOiB0cnVlLFxuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjcmVhdGVTaGlwXG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbl9fd2VicGFja19yZXF1aXJlX18ubiA9IChtb2R1bGUpID0+IHtcblx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG5cdFx0KCkgPT4gKG1vZHVsZVsnZGVmYXVsdCddKSA6XG5cdFx0KCkgPT4gKG1vZHVsZSk7XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsIHsgYTogZ2V0dGVyIH0pO1xuXHRyZXR1cm4gZ2V0dGVyO1xufTsiLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiY29uc3QgaGFuZGxlQXR0YWNrID0gKGNvbHVtbiwgcm93LCBlbmVteUJvYXJkLCBwbGF5ZXIpID0+IHtcbiAgICBwbGF5ZXIuYXR0YWNrKGNvbHVtbiwgcm93LCBlbmVteUJvYXJkKVxufVxuXG5jb25zdCBhdHRhY2tFbmVteUNlbGwgPSAoY2VsbCwgY29sdW1uLCByb3csIGVuZW15Qm9hcmQsIHBsYXllcikgPT4ge1xuICAgIGNvbnN0IGNlbGxMb2NhdGlvbiA9IGVuZW15Qm9hcmQuZ2V0TG9jYXRpb24oY29sdW1uLCByb3cpXG4gICAgaWYgKGNlbGxMb2NhdGlvbi5pc1NoaXApIHtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdoaXQnKVxuICAgICAgICAvLyBoYW5kbGVBdHRhY2soY29sdW1uLCByb3csIGVuZW15Qm9hcmQsIHBsYXllcilcbiAgICB9IGVsc2Uge1xuICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ21pc3MnKVxuICAgIH1cbn1cblxuY29uc3QgYXR0YWNrUGxheWVyQ2VsbCA9IChjZWxsLCBjb2x1bW4sIHJvdywgcGxheWVyQm9hcmQsIGVuZW15KSA9PiB7XG4gICAgY29uc3QgY2VsbExvY2F0aW9uID0gcGxheWVyQm9hcmQuZ2V0TG9jYXRpb24oY29sdW1uLCByb3cpXG4gICAgaWYgKGNlbGxMb2NhdGlvbi5pc1NoaXApIHtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdoaXQnKVxuICAgICAgICAvLyBoYW5kbGVBdHRhY2soY29sdW1uLCByb3csIHBsYXllckJvYXJkLCBlbmVteSlcbiAgICB9IGVsc2Uge1xuICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ21pc3MnKVxuICAgIH1cbn1cblxuY29uc3QgYXR0YWNrSHVtYW4gPSAoY2VsbCwgcGxheWVyQm9hcmQsIGVuZW15KSA9PiB7XG4gICAgY29uc3QgeyByYW5kb21Db2x1bW4sIHJhbmRvbVJvdyB9ID0gcGxheWVyQm9hcmQubWFrZVJhbmRvbUNvb3JkaW5hdGVzKClcbiAgICBhdHRhY2tQbGF5ZXJDZWxsKGNlbGwsIHJhbmRvbUNvbHVtbiwgcmFuZG9tUm93LCBwbGF5ZXJCb2FyZCwgZW5lbXkpXG4gICAgcmV0dXJuIHsgcmFuZG9tQ29sdW1uLCByYW5kb21Sb3cgfVxufVxuXG5leHBvcnQgY29uc3QgcmVuZGVyUGxheWVyU2hpcHMgPSAoeyBnZXRMb2NhdGlvbiB9KSA9PiB7XG4gICAgY29uc3QgcGxheWVyQm9hcmRBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2LnBsYXllci1ib2FyZCcpXG5cbiAgICBmb3IgKGxldCBjb2x1bW4gPSAwOyBjb2x1bW4gPCAxMDsgY29sdW1uICs9IDEpIHtcbiAgICAgICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgMTA7IHJvdyArPSAxKSB7XG4gICAgICAgICAgICBjb25zdCBjZWxsID0gcGxheWVyQm9hcmRBcmVhLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICAgICAgYC5jZWxsOm50aC1jaGlsZCgke3JvdyAqIDEwICsgY29sdW1uICsgMX0pYFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2NvbHVtbicsIGNvbHVtbilcbiAgICAgICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdyb3cnLCByb3cpXG4gICAgICAgICAgICBpZiAoZ2V0TG9jYXRpb24ocm93LCBjb2x1bW4pLmlzU2hpcCkge1xuICAgICAgICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnc2hpcCcpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCByZW5kZXJFbmVteUF0YWNrcyA9IChwbGF5ZXJCb2FyZCwgY29sdW1uLCByb3cpID0+IHtcbiAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgYC5jZWxsW2NvbHVtbj0nJHtjb2x1bW59J11bcm93PScke3Jvd30nXWBcbiAgICApXG4gICAgaWYgKGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaGlwJykpIHtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdoaXQnKVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnbWlzcycpXG4gICAgfVxufVxuXG4vL2h0dHBzOi8vanNtYW5pZmVzdC5jb20vdGhlLXB1Ymxpc2gtc3Vic2NyaWJlLXBhdHRlcm4taW4tamF2YXNjcmlwdC9cblxuZnVuY3Rpb24gcHViU3ViKCkge1xuICAgIGNvbnN0IHN1YnNjcmliZXJzID0ge31cblxuICAgIGZ1bmN0aW9uIHB1Ymxpc2goZXZlbnROYW1lLCBkYXRhKSB7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzdWJzY3JpYmVyc1tldmVudE5hbWVdKSkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgc3Vic2NyaWJlcnNbZXZlbnROYW1lXS5mb3JFYWNoKChjYWxsYmFjaykgPT4ge1xuICAgICAgICAgICAgY2FsbGJhY2soZGF0YSlcbiAgICAgICAgfSlcbiAgICB9XG4gICAgZnVuY3Rpb24gc3Vic2NyaWJlKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHN1YnNjcmliZVtldmVudE5hbWVdKSkge1xuICAgICAgICAgICAgc3Vic2NyaWJlcnNbZXZlbnROYW1lXSA9IFtdXG4gICAgICAgIH1cbiAgICAgICAgc3Vic2NyaWJlcnNbZXZlbnROYW1lXS5wdXNoKGNhbGxiYWNrKVxuICAgICAgICBjb25zdCBpbmRleCA9IHN1YnNjcmliZXJzW2V2ZW50TmFtZV0ubGVuZ3RoIC0gMVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB1bnN1YnNjcmliZSgpIHtcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyc1tldmVudE5hbWVdLnNwbGljZShpbmRleCwgMSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIHB1Ymxpc2gsXG4gICAgICAgIHN1YnNjcmliZSxcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBhZGRMaXN0ZW5lcnNUb0VuZW15Qm9hcmQgPSAoXG4gICAgcGxheWVyQm9hcmQsXG4gICAgZW5lbXlCb2FyZCxcbiAgICBwbGF5ZXIsXG4gICAgZW5lbXlcbikgPT4ge1xuICAgIGNvbnN0IGVuZW15Qm9hcmRBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2LmVuZW15LWJvYXJkJylcblxuICAgIGZvciAobGV0IGNvbHVtbiA9IDA7IGNvbHVtbiA8IDEwOyBjb2x1bW4gKz0gMSkge1xuICAgICAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCAxMDsgcm93ICs9IDEpIHtcbiAgICAgICAgICAgIC8vIENyZWRpdGluZyBmb3JtdWxhIHRvIGNhbGN1bGF0ZSBudGgtY2hpbGQgdXNpbmcgbmVzdGVkIGxvb3A6IGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzg4NzI2NjIvbWF0aC10by1kZXRlcm1pbmUtaXRlbS1pbmRleC1iYXNlZC1vbi1jb2wtcm93LXNlbGVjdGlvbi1pbi1ncmlkXG4gICAgICAgICAgICBjb25zdCBjZWxsID0gZW5lbXlCb2FyZEFyZWEucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgICBgLmNlbGw6bnRoLWNoaWxkKCR7cm93ICogMTAgKyBjb2x1bW4gKyAxfSlgXG4gICAgICAgICAgICApXG4gICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgnY29sdW1uJywgY29sdW1uKVxuICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ3JvdycsIHJvdylcblxuICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICAgICAgICAgICdjbGljaycsXG4gICAgICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAvLyBodW1hbiBwbGF5ZXIgYXR0YWNraW5nIGNvbXB1dGVyXG4gICAgICAgICAgICAgICAgICAgIGF0dGFja0VuZW15Q2VsbChjZWxsLCBjb2x1bW4sIHJvdywgZW5lbXlCb2FyZCwgcGxheWVyKVxuICAgICAgICAgICAgICAgICAgICAvLyBjb21wdXRlciBhdHRhY2tpbmcgaHVtYW5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeyByYW5kb21Db2x1bW4sIHJhbmRvbVJvdyB9ID0gYXR0YWNrSHVtYW4oXG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyQm9hcmQsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmVteVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIHJlbmRlckVuZW15QXRhY2tzKHBsYXllckJvYXJkLCByYW5kb21Db2x1bW4sIHJhbmRvbVJvdylcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHsgb25jZTogdHJ1ZSB9XG4gICAgICAgICAgICApXG4gICAgICAgIH1cbiAgICB9XG59XG4iLCJpbXBvcnQgeyBhZGRMaXN0ZW5lcnNUb0VuZW15Qm9hcmQsIHJlbmRlckVuZW15QXRhY2tzLCByZW5kZXJQbGF5ZXJTaGlwc30gZnJvbSAnLi9kb20nXG5cbmltcG9ydCBjcmVhdGVHYW1lQm9hcmQgZnJvbSAnLi9nYW1lYm9hcmQvZ2FtZWJvYXJkJ1xuaW1wb3J0IGNyZWF0ZVNoaXAgZnJvbSAnLi9zaGlwL3NoaXAnXG5pbXBvcnQgY3JlYXRlUGxheWVyIGZyb20gJy4vcGxheWVyL3BsYXllcidcblxuY29uc3QgcGxheWVyQm9hcmQgPSBjcmVhdGVHYW1lQm9hcmQoKVxuY29uc3QgZW5lbXlCb2FyZCA9IGNyZWF0ZUdhbWVCb2FyZCgpXG5cbmNvbnN0IHBsYXllciA9IGNyZWF0ZVBsYXllcigpXG5cbmNvbnN0IGNvbXB1dGVyID0gY3JlYXRlUGxheWVyKClcblxucGxheWVyQm9hcmQucmFuZG9tbHlQbGFjZVNoaXBzKClcbmVuZW15Qm9hcmQucGxhY2VTaGlwKDAsIDAsICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCg1KSlcbmVuZW15Qm9hcmQucGxhY2VTaGlwKDMsIDQsICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCgzKSlcbmVuZW15Qm9hcmQucGxhY2VTaGlwKDYsIDcsICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCgyKSlcbmVuZW15Qm9hcmQucGxhY2VTaGlwKDksIDEsICd2ZXJ0aWNhbCcsIGNyZWF0ZVNoaXAoMykpXG5lbmVteUJvYXJkLnBsYWNlU2hpcCg1LCA5LCAnaG9yaXpvbnRhbCcsIGNyZWF0ZVNoaXAoNCkpXG5cbmFkZExpc3RlbmVyc1RvRW5lbXlCb2FyZChwbGF5ZXJCb2FyZCwgZW5lbXlCb2FyZCwgcGxheWVyLCBjb21wdXRlcilcblxuXG5yZW5kZXJQbGF5ZXJTaGlwcyhwbGF5ZXJCb2FyZCkiXSwibmFtZXMiOlsiY3JlYXRlU2hpcCIsIm1vZHVsZSIsImV4cG9ydHMiLCJlbXB0eUNlbGwiLCJoYXNCZWVuSGl0IiwiaXNTaGlwIiwib2ZmTGltaXRzIiwiZ2FtZUJvYXJkIiwiQXJyYXkiLCJmaWxsIiwic3RydWN0dXJlZENsb25lIiwibWFwIiwic2hpcHMiLCJnZXRMb2NhdGlvbiIsImNvbHVtbiIsInJvdyIsInNldExvY2F0aW9uIiwic2hpcCIsIk9iamVjdCIsImFzc2lnbiIsImNyZWF0ZU9mZkxpbWl0TG9jYXRpb24iLCJ1bmRlZmluZWQiLCJhZGRPZmZMaW1pdEFyZWFGb3JTaGlwcyIsInBsYWNlU2hpcCIsImRpcmVjdGlvbiIsInNoaXBMZW5ndGgiLCJnZXRMZW5ndGgiLCJsZW5ndGgiLCJpIiwiYWRkT2ZmTGltaXRBcmVhRm9yVmVydGljYWxseVBvc2l0aW9uZWRTaGlwIiwiYWRkT2ZmTGltaXRBcmVhRm9ySG9yaXpvbnRhbGx5UG9zaXRpb25lZFNoaXAiLCJtYWtlUmFuZG9tQ29vcmRpbmF0ZXMiLCJyYW5kb21EaXJlY3Rpb24iLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJyYW5kb21Db2x1bW4iLCJyYW5kb21Sb3ciLCJjaGVja0lmT2ZmTGltaXRab25lV2FzQ29ycmVjdGx5SW1wbGVtZW50ZWQiLCJmbGF0IiwiZmlsdGVyIiwiZWxlbWVudCIsInJlY2VpdmVBdHRhY2siLCJjaGVja0lmQWxsU2hpcHNIYXZlU3VuayIsImV2ZXJ5IiwiY2VsbCIsImdldFN0YXR1cyIsInVuaXQiLCJyYW5kb21seVBsYWNlU2hpcHMiLCJzaGlwRGV0YWlscyIsImxvY2F0aW9uIiwicHVzaCIsIm5hbWUiLCJnZXROYW1lIiwiYXR0YWNrIiwic3RhdHVzIiwiaXNTdW5rIiwicG9zaXRpb24iLCJoaXQiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwibiIsImdldHRlciIsIl9fZXNNb2R1bGUiLCJkIiwiYSIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImF0dGFja0VuZW15Q2VsbCIsImVuZW15Qm9hcmQiLCJwbGF5ZXIiLCJjbGFzc0xpc3QiLCJhZGQiLCJhdHRhY2tIdW1hbiIsInBsYXllckJvYXJkIiwiZW5lbXkiLCJhdHRhY2tQbGF5ZXJDZWxsIiwicmVuZGVyRW5lbXlBdGFja3MiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjb250YWlucyIsImVuZW15Qm9hcmRBcmVhIiwic2V0QXR0cmlidXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uY2UiLCJhZGRMaXN0ZW5lcnNUb0VuZW15Qm9hcmQiLCJwbGF5ZXJCb2FyZEFyZWEiLCJyZW5kZXJQbGF5ZXJTaGlwcyJdLCJzb3VyY2VSb290IjoiIn0=