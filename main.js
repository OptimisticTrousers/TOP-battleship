(()=>{var e={653:(e,t,o)=>{const r=o(585);e.exports=()=>{const e={hasBeenHit:!1,isShip:!1,offLimits:!1},t=(()=>{const t=Array(10).fill().map((()=>Array(10).fill()));for(let o=0;o<10;o++)for(let r=0;r<10;r++)t[o][r]={...e,column:o,row:r};return t})(),o=[r(5,"Carrier"),r(4,"Battleship"),r(3,"Destroyer"),r(3,"Submarine"),r(2,"Patrol Boat")],n=(e,o)=>t?.[e]?.[o],i=(o,r,n=(()=>Object.assign(e,{offLimits:!0}))())=>{void 0!==t?.[o]?.[r]&&(t[o][r]=n)},l=(e,t)=>{i(e-1,t-1),i(e,t-1)},a=()=>{const e=0===Math.floor(2*Math.random())?"vertical":"horizontal";return{randomLocation:Math.floor(Math.random()*(t.flat().filter((e=>!1===e.isShip&&!1===e.offLimits)).length-1)),randomDirection:e}};return{checkIfOffLimitZoneWasCorrectlyImplemented:e=>t.flat().filter((e=>!0===e.offLimits)).length===e+2,getLocation:n,receiveAttack:(e,o)=>{t[e][o].hasBeenHit=!0},checkIfAllShipsHaveSunk:()=>{let e=!0;for(let t=0;t<10;t++)for(let o=0;o<10;o++){const r=n(t,o);if(!1!==r.isShip&&r.isShip&&!1===r.isSunk()){e=!1;break}}return e},placeShip:(e,o,r,a)=>{const c=a.getLength();if(((e,t,o,r)=>{if("vertical"===o)for(let o=0;o<r;o++){const r=n(e,t+o);if(r&&!0===r.isShip&&!0===r.offLimits)return!0}else if("horizontal"===o)for(let o=0;o<r;o++){const r=n(e+o,t);if(r&&!0===r.isShip&&!0===r.offLimits)return!0}return!1})(e,o,r,c))return!1;if("vertical"===r){if(((e,o)=>e>=0&&e+o-1<t.length)(o,c)){for(let t=0;t<c;t+=1)i(e,o+t,{...a,position:t,hasBeenHit:!1,direction:r}),i(e+1,o+t),i(e-1,o+t);return((e,t,o)=>{l(e,t),i(e,t+o),i(e+1,t+o),i(e-1,t+o),i(e+1,t-1)})(e,o,c),!0}}else if("horizontal"===r&&((e,o)=>e>=0&&e+o-1<t.length)(e,c)){for(let t=0;t<c;t+=1)i(e+t,o,{...a,position:t,hasBeenHit:!1,direction:r}),i(e+t,o+1),i(e+t,o-1);return((e,t,o)=>{l(e,t),i(e+o,t),i(e-1,t+1),i(e+o,t+1),i(e+o,t-1)})(e,o,c),!0}return!1},randomlyPlaceShips:()=>{const e=[];for(let r=0;r<o.length;r++){const{randomLocation:o,randomDirection:r}=a(),n=t.flat(),i=n.findIndex(((e,t)=>t===o)),l=n[i],c=l.column,s=l.row;e.push({elementColumn:c,elementRow:s,randomDirection:r})}return e},makeRandomCoordinates:a}}},61:e=>{e.exports=(e="player")=>({getName:()=>e,attack:(e,t,{getLocation:o,receiveAttack:r})=>{const n=o(e,t);return!1===n.hasBeenHit||n.isShip&&!1===n.getStatus().includes("unhit")?(r(e,t),n.hit&&n.hit(n.position),"It's a hit!"):"You have already hit this spot!"}})},585:e=>{e.exports=(e,t="ship")=>{const o=Array(e).fill("unhit");return{name:t,getLength:()=>o.length,isSunk:()=>o.every((e=>"hit"===e)),hit:t=>{t<e&&(o[t]="hit")},getStatus:()=>o,hasBeenHit:!1,isShip:!0}}}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,o),i.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=(e,t,o,r)=>{const n=document.querySelector(`.${e}-board > .cell[column='${t}'][row='${o}']`);r.getLocation(t,o).isShip?n.classList.add("hit"):n.classList.add("miss")},t=(e,t,o,r)=>r.attack(e,t,o);var r=o(653),n=o.n(r),i=o(585),l=o.n(i),a=o(61),c=o.n(a);const s=n()(),h=n()(),u=c()(),p=c()();s.randomlyPlaceShips(),h.randomlyPlaceShips(),s.placeShip(0,0,"horizontal",l()(5)),s.placeShip(3,4,"horizontal",l()(3)),s.placeShip(6,7,"horizontal",l()(2)),s.placeShip(9,1,"vertical",l()(3)),s.placeShip(5,9,"horizontal",l()(4)),h.placeShip(0,0,"horizontal",l()(5)),h.placeShip(3,4,"horizontal",l()(3)),h.placeShip(6,7,"horizontal",l()(2)),h.placeShip(9,1,"vertical",l()(3)),h.placeShip(5,9,"horizontal",l()(4));const d=(()=>{const e={};return{publish:function(t,o){Array.isArray(e[t])&&e[t].forEach((e=>{e(o)}))},subscribe:function t(o,r){Array.isArray(t[o])||(e[o]=[]),e[o].push(r);const n=e[o].length-1;return{unsubscribe(){e[o].splice(n,1)}}}}})();((e,t,o,r,n)=>{const i=document.querySelector("div.enemy-board");for(let l=0;l<10;l+=1)for(let a=0;a<10;a+=1){const c=i.querySelector(`.cell:nth-child(${10*a+l+1})`);c.setAttribute("column",l),c.setAttribute("row",a),c.addEventListener("click",(()=>{n.publish("click",{cell:c,column:l,row:a,playerBoard:e,enemyBoard:t,player:o,enemy:r})}),{once:!0})}})(s,h,u,p,d),d.subscribe("click",(({cell:o,column:r,row:n,playerBoard:i,enemyBoard:l,player:a,enemy:c})=>{((o,r,n,i)=>{t(o,r,n,i),e("enemy",o,r,n)})(r,n,l,a),((o,r)=>{const{randomColumn:n,randomRow:i}=o.makeRandomCoordinates();t(n,n,o,r),e("player",n,i,o)})(i,c),((e,t)=>{if(e.checkIfAllShipsHaveSunk()){const e=document.querySelector(".modal"),t=document.querySelector(".modal-content > p"),o=document.querySelector(".modal-content > button");e.style.display="block",o.addEventListener("click",(()=>{location.reload()})),t.textContent="You win!"}if(t.checkIfAllShipsHaveSunk()){const e=document.querySelector(".modal"),t=document.querySelector(".modal-content > p"),o=document.querySelector(".modal-content > button");e.style.display="block",t.textContent="You lose!",o.addEventListener("click",(()=>{location.reload()}))}})(i,l)})),(({getLocation:e})=>{const t=document.querySelector("div.player-board");for(let o=0;o<10;o+=1)for(let r=0;r<10;r+=1){const n=t.querySelector(`.cell:nth-child(${10*r+o+1})`);n.setAttribute("column",o),n.setAttribute("row",r),e(r,o).isShip&&n.classList.add("ship")}})(s)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBWUssWUFBYyxXQUk5QixHQUFHcEMsRUFBV3JELDBCQUEwQixDQUNwQyxNQUFNbUYsRUFBUTdCLFNBQVNDLGNBQWMsVUFDL0I2QixFQUFjOUIsU0FBU0MsY0FBYyxzQkFDckM4QixFQUFrQi9CLFNBQVNDLGNBQWMsMkJBRS9DNEIsRUFBTUcsTUFBTUMsUUFBVSxRQUN0QkgsRUFBWUssWUFBYyxZQUMxQkosRUFBZ0JULGlCQUFpQixTQUFTLEtBQ3RDMUUsU0FBU3NGLGNBeURqQkUsQ0FBZ0IvQixFQUFhTixNQWpHQSxHQUFHM0Usa0JBQ2hDLE1BQU1pSCxFQUFrQnJDLFNBQVNDLGNBQWMsb0JBRS9DLElBQUssSUFBSWpGLEVBQVMsRUFBR0EsRUFBUyxHQUFJQSxHQUFVLEVBQ3hDLElBQUssSUFBSUMsRUFBTSxFQUFHQSxFQUFNLEdBQUlBLEdBQU8sRUFBRyxDQUNsQyxNQUFNbUIsRUFBT2lHLEVBQWdCcEMsY0FDekIsbUJBQXlCLEdBQU5oRixFQUFXRCxFQUFTLE1BRTNDb0IsRUFBS2lGLGFBQWEsU0FBVXJHLEdBQzVCb0IsRUFBS2lGLGFBQWEsTUFBT3BHLEdBQ3JCRyxFQUFZSCxFQUFLRCxHQUFRUixRQUN6QjRCLEVBQUs4RCxVQUFVQyxJQUFJLFVDbENuQ21DLENBQWtCakMsSSIsInNvdXJjZXMiOlsid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL2dhbWVib2FyZC9nYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvcGxheWVyL3BsYXllci5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9zaGlwL3NoaXAuanMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2NvbXBhdCBnZXQgZGVmYXVsdCBleHBvcnQiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvZG9tLmpzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG5vLW11bHRpLWFzc2lnbiAqL1xuLyogZXNsaW50LWRpc2FibGUgbm8tdW51c2VkLWV4cHJlc3Npb25zICovXG5jb25zdCBjcmVhdGVTaGlwID0gcmVxdWlyZSgnLi4vc2hpcC9zaGlwJylcblxuLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi9cbmNvbnN0IGNyZWF0ZUdhbWVCb2FyZCA9ICgpID0+IHtcbiAgICBjb25zdCBlbXB0eUNlbGwgPSB7IGhhc0JlZW5IaXQ6IGZhbHNlLCBpc1NoaXA6IGZhbHNlLCBvZmZMaW1pdHM6IGZhbHNlIH1cblxuXG4gICAgY29uc3QgaW5pdGlhbGl6ZUJvYXJkID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBnYW1lQm9hcmQgPSBBcnJheSgxMCkuZmlsbCgpLm1hcCgoKSA9PiBBcnJheSgxMCkuZmlsbCgpKVxuICAgICAgICBmb3IobGV0IGk9IDA7IGkgPCAxMDsgaSsrKXtcbiAgICAgICAgICAgIGZvcihsZXQgaiA9MDsgaiA8IDEwOyBqKyspe1xuICAgICAgICAgICAgICAgIGdhbWVCb2FyZFtpXVtqXSA9IHsuLi5lbXB0eUNlbGwsIGNvbHVtbjogaSwgcm93OiBqfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBnYW1lQm9hcmRcbiAgICB9XG5cbiAgICBjb25zdCBnYW1lQm9hcmQgPSBpbml0aWFsaXplQm9hcmQoKVxuXG5cbiAgICBjb25zdCBzaGlwcyA9IFtcbiAgICAgICAgY3JlYXRlU2hpcCg1LCAnQ2FycmllcicpLFxuICAgICAgICBjcmVhdGVTaGlwKDQsICdCYXR0bGVzaGlwJyksXG4gICAgICAgIGNyZWF0ZVNoaXAoMywgJ0Rlc3Ryb3llcicpLFxuICAgICAgICBjcmVhdGVTaGlwKDMsICdTdWJtYXJpbmUnKSxcbiAgICAgICAgY3JlYXRlU2hpcCgyLCAnUGF0cm9sIEJvYXQnKSxcbiAgICBdXG5cbiAgICBjb25zdCBjcmVhdGVPZmZMaW1pdExvY2F0aW9uID0gKCkgPT5cbiAgICAgICAgT2JqZWN0LmFzc2lnbihlbXB0eUNlbGwsIHsgb2ZmTGltaXRzOiB0cnVlIH0pXG5cbiAgICBjb25zdCBnZXRMb2NhdGlvbiA9IChjb2x1bW4sIHJvdykgPT4gZ2FtZUJvYXJkPy5bY29sdW1uXT8uW3Jvd11cblxuICAgIGNvbnN0IHNldExvY2F0aW9uID0gKGNvbHVtbiwgcm93LCBzaGlwID0gY3JlYXRlT2ZmTGltaXRMb2NhdGlvbigpKSA9PiB7XG4gICAgICAgIGlmIChnYW1lQm9hcmQ/Lltjb2x1bW5dPy5bcm93XSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgZ2FtZUJvYXJkW2NvbHVtbl1bcm93XSA9IHNoaXBcbiAgICB9XG4gICAgY29uc3QgY2hlY2tJZkFsbFNoaXBzSGF2ZVN1bmsgPSAoKSA9PiB7XG4gICAgICAgIGxldCBoYXZlQWxsU2hpcHNTdW5rID0gdHJ1ZVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTA7IGorKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxvY2F0aW9uID0gZ2V0TG9jYXRpb24oaSwgailcbiAgICAgICAgICAgICAgICBpZiAobG9jYXRpb24uaXNTaGlwID09PSBmYWxzZSkgY29udGludWVcbiAgICAgICAgICAgICAgICBpZiAobG9jYXRpb24uaXNTaGlwICYmIGxvY2F0aW9uLmlzU3VuaygpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICBoYXZlQWxsU2hpcHNTdW5rID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGhhdmVBbGxTaGlwc1N1bmtcbiAgICB9XG5cbiAgICBjb25zdCBhZGRPZmZMaW1pdEFyZWFGb3JTaGlwcyA9IChjb2x1bW4sIHJvdykgPT4ge1xuICAgICAgICAvLyB0b3AtbGVmdFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gLSAxLCByb3cgLSAxKVxuICAgICAgICAvLyB0b3BcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uLCByb3cgLSAxKVxuICAgIH1cblxuICAgIGNvbnN0IGFkZE9mZkxpbWl0QXJlYUZvckhvcml6b250YWxseVBvc2l0aW9uZWRTaGlwID0gKFxuICAgICAgICBjb2x1bW4sXG4gICAgICAgIHJvdyxcbiAgICAgICAgc2hpcExlbmd0aFxuICAgICkgPT4ge1xuICAgICAgICAvLyBwb3NpdGlvbnMgcmVsYXRpdmUgdG8gdGhlIHNoaXAgaXRzZWxmKGllLiBhIGhvcml6b250YWwgc2hpcCdzIGJvdHRvbSBpcyB0byB0aGUgcmlnaHQpXG5cbiAgICAgICAgYWRkT2ZmTGltaXRBcmVhRm9yU2hpcHMoY29sdW1uLCByb3cpXG4gICAgICAgIC8vIGJvdHRvbVxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBzaGlwTGVuZ3RoLCByb3cpXG4gICAgICAgIC8vIGJvdHRvbS1sZWZ0XG4gICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiAtIDEsIHJvdyArIDEpXG4gICAgICAgIC8vIGJvdHRvbS1yaWdodFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBzaGlwTGVuZ3RoLCByb3cgKyAxKVxuICAgICAgICAvLyB0b3AtcmlnaHRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgc2hpcExlbmd0aCwgcm93IC0gMSlcbiAgICB9XG5cbiAgICBjb25zdCBhZGRPZmZMaW1pdEFyZWFGb3JWZXJ0aWNhbGx5UG9zaXRpb25lZFNoaXAgPSAoXG4gICAgICAgIGNvbHVtbixcbiAgICAgICAgcm93LFxuICAgICAgICBzaGlwTGVuZ3RoXG4gICAgKSA9PiB7XG4gICAgICAgIC8vIHBvc2l0aW9ucyByZWxhdGl2ZSB0byBob3cgdGhlIHVzZXIgc2VlcyBpdChpZS4gYSB2ZXJ0aWNhbCBzaGlwJ3MgYm90dG9tIGlzIHRvIHRoZSBib3R0b20pXG5cbiAgICAgICAgYWRkT2ZmTGltaXRBcmVhRm9yU2hpcHMoY29sdW1uLCByb3cpXG4gICAgICAgIC8vIGJvdHRvbVxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4sIHJvdyArIHNoaXBMZW5ndGgpXG4gICAgICAgIC8vIGJvdHRvbS1yaWdodFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyAxLCByb3cgKyBzaGlwTGVuZ3RoKVxuICAgICAgICAvLyBib3R0b20tbGVmdFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gLSAxLCByb3cgKyBzaGlwTGVuZ3RoKVxuICAgICAgICAvLyB0b3AtcmlnaHRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgMSwgcm93IC0gMSlcbiAgICB9XG5cbiAgICBjb25zdCBjaGVja0lmQ29sdW1uQ29vcmRpbmF0ZUlzVmFsaWQgPSAoY29sdW1uLCBzaGlwTGVuZ3RoKSA9PlxuICAgICAgICBjb2x1bW4gPj0gMCAmJiBjb2x1bW4gKyBzaGlwTGVuZ3RoIC0gMSA8IGdhbWVCb2FyZC5sZW5ndGhcblxuICAgIGNvbnN0IGNoZWNrSWZSb3dDb29yZGluYXRlSXNWYWxpZCA9IChyb3csIHNoaXBMZW5ndGgpID0+XG4gICAgICAgIHJvdyA+PSAwICYmIHJvdyArIHNoaXBMZW5ndGggLSAxIDwgZ2FtZUJvYXJkLmxlbmd0aFxuXG4gICAgY29uc3QgY2hlY2tJZkxvY2F0aW9uSXNBU2hpcE9yT2ZmTGltaXRzID0gKFxuICAgICAgICBjb2x1bW4sXG4gICAgICAgIHJvdyxcbiAgICAgICAgZGlyZWN0aW9uLFxuICAgICAgICBzaGlwTGVuZ3RoXG4gICAgKSA9PiB7XG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICd2ZXJ0aWNhbCcpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSBnZXRMb2NhdGlvbihjb2x1bW4sIHJvdyArIGkpXG4gICAgICAgICAgICAgICAgaWYgKGxvY2F0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLmlzU2hpcCA9PT0gdHJ1ZSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24ub2ZmTGltaXRzID09PSB0cnVlXG4gICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdob3Jpem9udGFsJykge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IGdldExvY2F0aW9uKGNvbHVtbiArIGksIHJvdylcbiAgICAgICAgICAgICAgICBpZiAobG9jYXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24uaXNTaGlwID09PSB0cnVlICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbi5vZmZMaW1pdHMgPT09IHRydWVcbiAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfVxuXG4gICAgY29uc3QgaXNPZmZMaW1pdEFyZWFDbGVhciA9IChjb2x1bW4sIHJvdywgZGlyZWN0aW9uLCBzaGlwTGVuZ3RoKSA9PiB7XG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICd2ZXJ0aWNhbCcpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcExlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGVmdCA9IGdldExvY2F0aW9uKGNvbHVtbiAtIDEsIHJvdyArIGkpXG4gICAgICAgICAgICAgICAgY29uc3QgcmlnaHQgPSBnZXRMb2NhdGlvbihjb2x1bW4gKyAxLCByb3cgKyBpKVxuICAgICAgICAgICAgICAgIGlmIChsZWZ0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChsZWZ0LmlzU2hpcCAmJiBsZWZ0Lm9mZkxpbWl0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyaWdodC5pc1NoaXAgJiYgcmlnaHQub2ZmTGltaXRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09ICdob3Jpem9udGFsJykge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0b3AgPSBnZXRMb2NhdGlvbihjb2x1bW4gKyBpLCByb3cgLSAxKVxuICAgICAgICAgICAgICAgIGNvbnN0IGJvdHRvbSA9IGdldExvY2F0aW9uKGNvbHVtbiArIGksIHJvdyArIDEpXG4gICAgICAgICAgICAgICAgaWYgKHRvcCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodG9wLmlzU2hpcCAmJiB0b3Aub2ZmTGltaXRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYm90dG9tKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChib3R0b20uaXNTaGlwICYmIGJvdHRvbS5vZmZMaW1pdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG5cbiAgICBjb25zdCBwbGFjZVNoaXAgPSAoY29sdW1uLCByb3csIGRpcmVjdGlvbiwgc2hpcCkgPT4ge1xuICAgICAgICBjb25zdCBzaGlwTGVuZ3RoID0gc2hpcC5nZXRMZW5ndGgoKVxuICAgICAgICBpZiAoXG4gICAgICAgICAgICBjaGVja0lmTG9jYXRpb25Jc0FTaGlwT3JPZmZMaW1pdHMoXG4gICAgICAgICAgICAgICAgY29sdW1uLFxuICAgICAgICAgICAgICAgIHJvdyxcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb24sXG4gICAgICAgICAgICAgICAgc2hpcExlbmd0aFxuICAgICAgICAgICAgKVxuICAgICAgICApXG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gJ3ZlcnRpY2FsJykge1xuICAgICAgICAgICAgaWYgKGNoZWNrSWZSb3dDb29yZGluYXRlSXNWYWxpZChyb3csIHNoaXBMZW5ndGgpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uLCByb3cgKyBpLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5zaGlwLFxuICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGksXG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNCZWVuSGl0OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgMSwgcm93ICsgaSlcbiAgICAgICAgICAgICAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uIC0gMSwgcm93ICsgaSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYWRkT2ZmTGltaXRBcmVhRm9yVmVydGljYWxseVBvc2l0aW9uZWRTaGlwKFxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4sXG4gICAgICAgICAgICAgICAgICAgIHJvdyxcbiAgICAgICAgICAgICAgICAgICAgc2hpcExlbmd0aFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gJ2hvcml6b250YWwnKSB7XG4gICAgICAgICAgICBpZiAoY2hlY2tJZkNvbHVtbkNvb3JkaW5hdGVJc1ZhbGlkKGNvbHVtbiwgc2hpcExlbmd0aCkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBpLCByb3csIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC4uLnNoaXAsXG4gICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogaSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhhc0JlZW5IaXQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAvLyBzZXRMb2NhdGlvbihjb2x1bW4gKyBpLCByb3csIHNoaXApXG4gICAgICAgICAgICAgICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiArIGksIHJvdyArIDEpXG4gICAgICAgICAgICAgICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiArIGksIHJvdyAtIDEpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFkZE9mZkxpbWl0QXJlYUZvckhvcml6b250YWxseVBvc2l0aW9uZWRTaGlwKFxuICAgICAgICAgICAgICAgICAgICBjb2x1bW4sXG4gICAgICAgICAgICAgICAgICAgIHJvdyxcbiAgICAgICAgICAgICAgICAgICAgc2hpcExlbmd0aFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIGNvbnN0IGF2YWlsYWJsZVNwYWNlcyA9ICgpID0+XG4gICAgICAgIGdhbWVCb2FyZFxuICAgICAgICAgICAgLmZsYXQoKVxuICAgICAgICAgICAgLmZpbHRlcigoY2VsbCkgPT4gY2VsbC5pc1NoaXAgPT09IGZhbHNlICYmIGNlbGwub2ZmTGltaXRzID09PSBmYWxzZSlcbiAgICAgICAgICAgIC5sZW5ndGggLSAxXG5cbiAgICBjb25zdCBtYWtlUmFuZG9tQ29vcmRpbmF0ZXMgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJhbmRvbURpcmVjdGlvbiA9XG4gICAgICAgICAgICBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKSA9PT0gMCA/ICd2ZXJ0aWNhbCcgOiAnaG9yaXpvbnRhbCdcbiAgICAgICAgY29uc3QgcmFuZG9tTG9jYXRpb24gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhdmFpbGFibGVTcGFjZXMoKSlcblxuICAgICAgICByZXR1cm4geyByYW5kb21Mb2NhdGlvbiwgcmFuZG9tRGlyZWN0aW9uIH1cbiAgICB9XG5cbiAgICBjb25zdCByYW5kb21seVBsYWNlU2hpcHMgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNoaXBzRGV0YWlscyA9IFtdXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcmFuZG9tTG9jYXRpb24sIHJhbmRvbURpcmVjdGlvbiB9ID0gbWFrZVJhbmRvbUNvb3JkaW5hdGVzKClcbiAgICAgICAgICAgIGNvbnN0IGZsYXR0ZW5lZEdhbWVCb2FyZCA9IGdhbWVCb2FyZC5mbGF0KClcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRJbmRleCA9IGZsYXR0ZW5lZEdhbWVCb2FyZC5maW5kSW5kZXgoXG4gICAgICAgICAgICAgICAgKGVsZW1lbnQsIGluZGV4KSA9PiBpbmRleCA9PT0gcmFuZG9tTG9jYXRpb25cbiAgICAgICAgICAgIClcblxuICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGZsYXR0ZW5lZEdhbWVCb2FyZFtlbGVtZW50SW5kZXhdXG4gICAgICAgICAgICBjb25zdCBlbGVtZW50Q29sdW1uID0gZWxlbWVudC5jb2x1bW5cbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRSb3cgPSBlbGVtZW50LnJvd1xuICAgICAgICAgICAgc2hpcHNEZXRhaWxzLnB1c2goe2VsZW1lbnRDb2x1bW4sIGVsZW1lbnRSb3csIHJhbmRvbURpcmVjdGlvbn0pXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNoaXBzRGV0YWlsc1xuICAgIH1cblxuICAgIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29sdW1uLCByb3cpID0+IHtcbiAgICAgICAgZ2FtZUJvYXJkW2NvbHVtbl1bcm93XS5oYXNCZWVuSGl0ID0gdHJ1ZVxuICAgIH1cblxuICAgIGNvbnN0IGNoZWNrSWZPZmZMaW1pdFpvbmVXYXNDb3JyZWN0bHlJbXBsZW1lbnRlZCA9IChzaGlwTGVuZ3RoKSA9PlxuICAgICAgICBnYW1lQm9hcmQuZmxhdCgpLmZpbHRlcigoZWxlbWVudCkgPT4gZWxlbWVudC5vZmZMaW1pdHMgPT09IHRydWUpXG4gICAgICAgICAgICAubGVuZ3RoID09PVxuICAgICAgICBzaGlwTGVuZ3RoICsgMlxuICAgIC8vIGFkZGluZyBzaGlwTGVuZ3RoIHBsdXMgdHdvIGJlY2F1c2UgZm9yIGV2ZXJ5IGluY3JlYXNlIGluIHRoZSBzaXplIG9mIHNoaXAsIHRoZSB6b25lcyBjb3ZlcmVkIGluY3JlYXNlIGJ5IDIgdW5pdHNcblxuICAgIHJldHVybiB7XG4gICAgICAgIGNoZWNrSWZPZmZMaW1pdFpvbmVXYXNDb3JyZWN0bHlJbXBsZW1lbnRlZCxcbiAgICAgICAgZ2V0TG9jYXRpb24sXG4gICAgICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgICAgIGNoZWNrSWZBbGxTaGlwc0hhdmVTdW5rLFxuICAgICAgICBwbGFjZVNoaXAsXG4gICAgICAgIHJhbmRvbWx5UGxhY2VTaGlwcyxcbiAgICAgICAgbWFrZVJhbmRvbUNvb3JkaW5hdGVzLFxuICAgIH1cbn1cbm1vZHVsZS5leHBvcnRzID0gY3JlYXRlR2FtZUJvYXJkXG4iLCJjb25zdCBjcmVhdGVQbGF5ZXIgPSAobmFtZSA9ICdwbGF5ZXInKSA9PiB7XG4gICAgY29uc3QgZ2V0TmFtZSA9ICgpID0+IG5hbWVcblxuICAgIGNvbnN0IGF0dGFjayA9IChjb2x1bW4sIHJvdywgeyBnZXRMb2NhdGlvbiwgcmVjZWl2ZUF0dGFjayB9KSA9PiB7XG4gICAgICAgIGNvbnN0IGxvY2F0aW9uID0gZ2V0TG9jYXRpb24oY29sdW1uLCByb3cpXG4gICAgICAgIGlmIChsb2NhdGlvbi5oYXNCZWVuSGl0ID09PSBmYWxzZSB8fCAobG9jYXRpb24uaXNTaGlwICYmIGxvY2F0aW9uLmdldFN0YXR1cygpLmluY2x1ZGVzKCd1bmhpdCcpID09PSBmYWxzZSkpIHtcbiAgICAgICAgICAgIHJlY2VpdmVBdHRhY2soY29sdW1uLCByb3cpXG4gICAgICAgICAgICBpZihsb2NhdGlvbi5oaXQpe1xuXG4gICAgICAgICAgICAgICAgbG9jYXRpb24uaGl0KGxvY2F0aW9uLnBvc2l0aW9uKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFwiSXQncyBhIGhpdCFcIlxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICdZb3UgaGF2ZSBhbHJlYWR5IGhpdCB0aGlzIHNwb3QhJ1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGdldE5hbWUsXG4gICAgICAgIGF0dGFjayxcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gY3JlYXRlUGxheWVyXG4iLCJjb25zdCBjcmVhdGVTaGlwID0gKGxlbmd0aCwgbmFtZSA9ICdzaGlwJykgPT4ge1xuXG4gICAgY29uc3Qgc3RhdHVzID0gQXJyYXkobGVuZ3RoKS5maWxsKCd1bmhpdCcpXG5cbiAgICBjb25zdCBnZXRMZW5ndGggPSAoKSA9PiBzdGF0dXMubGVuZ3RoXG5cbiAgICBjb25zdCBnZXRTdGF0dXMgPSAoKSA9PiBzdGF0dXNcblxuICAgIGNvbnN0IGhpdCA9IChwb3NpdGlvbikgPT4ge1xuICAgICAgICBpZiAocG9zaXRpb24gPCBsZW5ndGgpIHtcbiAgICAgICAgICAgIHN0YXR1c1twb3NpdGlvbl0gPSAnaGl0J1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgaXNTdW5rID0gKCkgPT4gc3RhdHVzLmV2ZXJ5KChwb3NpdGlvbikgPT4gcG9zaXRpb24gPT09ICdoaXQnKVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgZ2V0TGVuZ3RoLFxuICAgICAgICBpc1N1bmssXG4gICAgICAgIGhpdCxcbiAgICAgICAgZ2V0U3RhdHVzLFxuICAgICAgICBoYXNCZWVuSGl0OiBmYWxzZSxcbiAgICAgICAgaXNTaGlwOiB0cnVlLFxuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBjcmVhdGVTaGlwXG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbl9fd2VicGFja19yZXF1aXJlX18ubiA9IChtb2R1bGUpID0+IHtcblx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG5cdFx0KCkgPT4gKG1vZHVsZVsnZGVmYXVsdCddKSA6XG5cdFx0KCkgPT4gKG1vZHVsZSk7XG5cdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsIHsgYTogZ2V0dGVyIH0pO1xuXHRyZXR1cm4gZ2V0dGVyO1xufTsiLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiY29uc3QgcmVuZGVyQXR0YWNrcyA9IChwbGF5ZXIsIGNvbHVtbiwgcm93LCBlbmVteUJvYXJkKSA9PiB7XG4gICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIGAuJHtwbGF5ZXJ9LWJvYXJkID4gLmNlbGxbY29sdW1uPScke2NvbHVtbn0nXVtyb3c9JyR7cm93fSddYFxuICAgIClcblxuICAgIGNvbnN0IGxvY2F0aW9uID0gZW5lbXlCb2FyZC5nZXRMb2NhdGlvbihjb2x1bW4sIHJvdylcbiAgICBpZiAobG9jYXRpb24uaXNTaGlwKSB7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnaGl0JylcbiAgICB9IGVsc2Uge1xuICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ21pc3MnKVxuICAgIH1cbn1cblxuY29uc3QgaGFuZGxlQXR0YWNrID0gKGNvbHVtbiwgcm93LCBlbmVteUJvYXJkLCBwbGF5ZXIpID0+XG4gICAgcGxheWVyLmF0dGFjayhjb2x1bW4sIHJvdywgZW5lbXlCb2FyZClcblxuY29uc3QgYXR0YWNrRW5lbXlDZWxsID0gKGNvbHVtbiwgcm93LCBlbmVteUJvYXJkLCBwbGF5ZXIpID0+IHtcbiAgICBoYW5kbGVBdHRhY2soY29sdW1uLCByb3csIGVuZW15Qm9hcmQsIHBsYXllcilcbiAgICByZW5kZXJBdHRhY2tzKCdlbmVteScsIGNvbHVtbiwgcm93LCBlbmVteUJvYXJkKVxufVxuXG5jb25zdCBhdHRhY2tQbGF5ZXJDZWxsID0gKHBsYXllckJvYXJkLCBlbmVteSkgPT4ge1xuICAgIGNvbnN0IHsgcmFuZG9tQ29sdW1uLCByYW5kb21Sb3cgfSA9IHBsYXllckJvYXJkLm1ha2VSYW5kb21Db29yZGluYXRlcygpXG4gICAgaGFuZGxlQXR0YWNrKHJhbmRvbUNvbHVtbiwgcmFuZG9tQ29sdW1uLCBwbGF5ZXJCb2FyZCwgZW5lbXkpXG4gICAgcmVuZGVyQXR0YWNrcygncGxheWVyJywgcmFuZG9tQ29sdW1uLCByYW5kb21Sb3csIHBsYXllckJvYXJkKVxufVxuLy8gaHR0cHM6Ly9qc21hbmlmZXN0LmNvbS90aGUtcHVibGlzaC1zdWJzY3JpYmUtcGF0dGVybi1pbi1qYXZhc2NyaXB0L1xuXG5leHBvcnQgY29uc3QgcHViU3ViID0gKCkgPT4ge1xuICAgIGNvbnN0IHN1YnNjcmliZXJzID0ge31cblxuICAgIGZ1bmN0aW9uIHB1Ymxpc2goZXZlbnROYW1lLCBkYXRhKSB7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzdWJzY3JpYmVyc1tldmVudE5hbWVdKSkge1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgICAgc3Vic2NyaWJlcnNbZXZlbnROYW1lXS5mb3JFYWNoKChjYWxsYmFjaykgPT4ge1xuICAgICAgICAgICAgY2FsbGJhY2soZGF0YSlcbiAgICAgICAgfSlcbiAgICB9XG4gICAgZnVuY3Rpb24gc3Vic2NyaWJlKGV2ZW50TmFtZSwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHN1YnNjcmliZVtldmVudE5hbWVdKSkge1xuICAgICAgICAgICAgc3Vic2NyaWJlcnNbZXZlbnROYW1lXSA9IFtdXG4gICAgICAgIH1cbiAgICAgICAgc3Vic2NyaWJlcnNbZXZlbnROYW1lXS5wdXNoKGNhbGxiYWNrKVxuICAgICAgICBjb25zdCBpbmRleCA9IHN1YnNjcmliZXJzW2V2ZW50TmFtZV0ubGVuZ3RoIC0gMVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB1bnN1YnNjcmliZSgpIHtcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyc1tldmVudE5hbWVdLnNwbGljZShpbmRleCwgMSlcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBwdWJsaXNoLFxuICAgICAgICBzdWJzY3JpYmUsXG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgcmVuZGVyUGxheWVyU2hpcHMgPSAoeyBnZXRMb2NhdGlvbiB9KSA9PiB7XG4gICAgY29uc3QgcGxheWVyQm9hcmRBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2LnBsYXllci1ib2FyZCcpXG5cbiAgICBmb3IgKGxldCBjb2x1bW4gPSAwOyBjb2x1bW4gPCAxMDsgY29sdW1uICs9IDEpIHtcbiAgICAgICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgMTA7IHJvdyArPSAxKSB7XG4gICAgICAgICAgICBjb25zdCBjZWxsID0gcGxheWVyQm9hcmRBcmVhLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICAgICAgYC5jZWxsOm50aC1jaGlsZCgke3JvdyAqIDEwICsgY29sdW1uICsgMX0pYFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2NvbHVtbicsIGNvbHVtbilcbiAgICAgICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdyb3cnLCByb3cpXG4gICAgICAgICAgICBpZiAoZ2V0TG9jYXRpb24ocm93LCBjb2x1bW4pLmlzU2hpcCkge1xuICAgICAgICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnc2hpcCcpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmNvbnN0IGNoZWNrSWZHYW1lT3ZlciA9IChwbGF5ZXJCb2FyZCwgZW5lbXlCb2FyZCkgPT4ge1xuICAgIGlmKHBsYXllckJvYXJkLmNoZWNrSWZBbGxTaGlwc0hhdmVTdW5rKCkpe1xuICAgICAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbCcpO1xuICAgICAgICBjb25zdCBtb2RhbFdpbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1jb250ZW50ID4gcCcpXG4gICAgICAgIGNvbnN0IHBsYXlBZ2FpbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1jb250ZW50ID4gYnV0dG9uJylcblxuICAgICAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiXG4gICAgICAgIHBsYXlBZ2FpbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpXG4gICAgICAgIH0pXG5cbiAgICAgICAgbW9kYWxXaW5uZXIudGV4dENvbnRlbnQgPSAnWW91IHdpbiEnXG5cblxuICAgIH1cbiAgICBpZihlbmVteUJvYXJkLmNoZWNrSWZBbGxTaGlwc0hhdmVTdW5rKCkpe1xuICAgICAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbCcpO1xuICAgICAgICBjb25zdCBtb2RhbFdpbm5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1jb250ZW50ID4gcCcpXG4gICAgICAgIGNvbnN0IHBsYXlBZ2FpbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1jb250ZW50ID4gYnV0dG9uJylcblxuICAgICAgICBtb2RhbC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiXG4gICAgICAgIG1vZGFsV2lubmVyLnRleHRDb250ZW50ID0gJ1lvdSBsb3NlISdcbiAgICAgICAgcGxheUFnYWluQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgbG9jYXRpb24ucmVsb2FkKClcbiAgICAgICAgfSlcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBhZGRMaXN0ZW5lcnNUb0VuZW15Qm9hcmQgPSAoXG4gICAgcGxheWVyQm9hcmQsXG4gICAgZW5lbXlCb2FyZCxcbiAgICBwbGF5ZXIsXG4gICAgZW5lbXksXG4gICAgcHNcbikgPT4ge1xuICAgIGNvbnN0IGVuZW15Qm9hcmRBcmVhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignZGl2LmVuZW15LWJvYXJkJylcblxuICAgIGZvciAobGV0IGNvbHVtbiA9IDA7IGNvbHVtbiA8IDEwOyBjb2x1bW4gKz0gMSkge1xuICAgICAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCAxMDsgcm93ICs9IDEpIHtcbiAgICAgICAgICAgIC8vIENyZWRpdGluZyBmb3JtdWxhIHRvIGNhbGN1bGF0ZSBudGgtY2hpbGQgdXNpbmcgbmVzdGVkIGxvb3A6IGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzg4NzI2NjIvbWF0aC10by1kZXRlcm1pbmUtaXRlbS1pbmRleC1iYXNlZC1vbi1jb2wtcm93LXNlbGVjdGlvbi1pbi1ncmlkXG4gICAgICAgICAgICBjb25zdCBjZWxsID0gZW5lbXlCb2FyZEFyZWEucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICAgICBgLmNlbGw6bnRoLWNoaWxkKCR7cm93ICogMTAgKyBjb2x1bW4gKyAxfSlgXG4gICAgICAgICAgICApXG4gICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgnY29sdW1uJywgY29sdW1uKVxuICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ3JvdycsIHJvdylcblxuICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFxuICAgICAgICAgICAgICAgICdjbGljaycsXG4gICAgICAgICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBwcy5wdWJsaXNoKCdjbGljaycsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW4sXG4gICAgICAgICAgICAgICAgICAgICAgICByb3csXG4gICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJCb2FyZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZW15Qm9hcmQsXG4gICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmVteSxcbiAgICAgICAgICAgICAgICAgICAgfSlcblxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgeyBvbmNlOiB0cnVlIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGF0dGFjayA9ICh7XG4gICAgY2VsbCxcbiAgICBjb2x1bW4sXG4gICAgcm93LFxuICAgIHBsYXllckJvYXJkLFxuICAgIGVuZW15Qm9hcmQsXG4gICAgcGxheWVyLFxuICAgIGVuZW15LFxufSkgPT4ge1xuICAgIC8vIGh1bWFuIHBsYXllciBhdHRhY2tpbmcgY29tcHV0ZXJcbiAgICBhdHRhY2tFbmVteUNlbGwoY29sdW1uLCByb3csIGVuZW15Qm9hcmQsIHBsYXllcilcbiAgICAvLyBjb21wdXRlciBhdHRhY2tpbmcgaHVtYW5cbiAgICBhdHRhY2tQbGF5ZXJDZWxsKHBsYXllckJvYXJkLCBlbmVteSlcblxuICAgIGNoZWNrSWZHYW1lT3ZlcihwbGF5ZXJCb2FyZCwgZW5lbXlCb2FyZClcblxufVxuIiwiaW1wb3J0IHsgYWRkTGlzdGVuZXJzVG9FbmVteUJvYXJkLCByZW5kZXJQbGF5ZXJTaGlwcyxwdWJTdWIsIGF0dGFja30gZnJvbSAnLi9kb20nXG5cbmltcG9ydCBjcmVhdGVHYW1lQm9hcmQgZnJvbSAnLi9nYW1lYm9hcmQvZ2FtZWJvYXJkJ1xuaW1wb3J0IGNyZWF0ZVNoaXAgZnJvbSAnLi9zaGlwL3NoaXAnXG5pbXBvcnQgY3JlYXRlUGxheWVyIGZyb20gJy4vcGxheWVyL3BsYXllcidcblxuY29uc3QgcGxheWVyQm9hcmQgPSBjcmVhdGVHYW1lQm9hcmQoKVxuY29uc3QgZW5lbXlCb2FyZCA9IGNyZWF0ZUdhbWVCb2FyZCgpXG5cbmNvbnN0IHBsYXllciA9IGNyZWF0ZVBsYXllcigpXG5cbmNvbnN0IGNvbXB1dGVyID0gY3JlYXRlUGxheWVyKClcblxucGxheWVyQm9hcmQucmFuZG9tbHlQbGFjZVNoaXBzKClcbmVuZW15Qm9hcmQucmFuZG9tbHlQbGFjZVNoaXBzKClcbnBsYXllckJvYXJkLnBsYWNlU2hpcCgwLCAwLCAnaG9yaXpvbnRhbCcsIGNyZWF0ZVNoaXAoNSkpXG5wbGF5ZXJCb2FyZC5wbGFjZVNoaXAoMywgNCwgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDMpKVxucGxheWVyQm9hcmQucGxhY2VTaGlwKDYsIDcsICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCgyKSlcbnBsYXllckJvYXJkLnBsYWNlU2hpcCg5LCAxLCAndmVydGljYWwnLCBjcmVhdGVTaGlwKDMpKVxucGxheWVyQm9hcmQucGxhY2VTaGlwKDUsIDksICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCg0KSlcblxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoMCwgMCwgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDUpKVxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoMywgNCwgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDMpKVxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoNiwgNywgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDIpKVxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoOSwgMSwgJ3ZlcnRpY2FsJywgY3JlYXRlU2hpcCgzKSlcbmVuZW15Qm9hcmQucGxhY2VTaGlwKDUsIDksICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCg0KSlcblxuY29uc3QgcHMgPSBwdWJTdWIoKVxuXG5hZGRMaXN0ZW5lcnNUb0VuZW15Qm9hcmQocGxheWVyQm9hcmQsIGVuZW15Qm9hcmQsIHBsYXllciwgY29tcHV0ZXIsIHBzKVxuXG5wcy5zdWJzY3JpYmUoJ2NsaWNrJywgYXR0YWNrKVxuXG5cblxuXG5yZW5kZXJQbGF5ZXJTaGlwcyhwbGF5ZXJCb2FyZCkiXSwibmFtZXMiOlsiY3JlYXRlU2hpcCIsIm1vZHVsZSIsImV4cG9ydHMiLCJlbXB0eUNlbGwiLCJoYXNCZWVuSGl0IiwiaXNTaGlwIiwib2ZmTGltaXRzIiwiZ2FtZUJvYXJkIiwiQXJyYXkiLCJmaWxsIiwibWFwIiwiaSIsImoiLCJjb2x1bW4iLCJyb3ciLCJpbml0aWFsaXplQm9hcmQiLCJzaGlwcyIsImdldExvY2F0aW9uIiwic2V0TG9jYXRpb24iLCJzaGlwIiwiT2JqZWN0IiwiYXNzaWduIiwiY3JlYXRlT2ZmTGltaXRMb2NhdGlvbiIsInVuZGVmaW5lZCIsImFkZE9mZkxpbWl0QXJlYUZvclNoaXBzIiwibWFrZVJhbmRvbUNvb3JkaW5hdGVzIiwicmFuZG9tRGlyZWN0aW9uIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicmFuZG9tTG9jYXRpb24iLCJmbGF0IiwiZmlsdGVyIiwiY2VsbCIsImxlbmd0aCIsImNoZWNrSWZPZmZMaW1pdFpvbmVXYXNDb3JyZWN0bHlJbXBsZW1lbnRlZCIsInNoaXBMZW5ndGgiLCJlbGVtZW50IiwicmVjZWl2ZUF0dGFjayIsImNoZWNrSWZBbGxTaGlwc0hhdmVTdW5rIiwiaGF2ZUFsbFNoaXBzU3VuayIsImxvY2F0aW9uIiwiaXNTdW5rIiwicGxhY2VTaGlwIiwiZGlyZWN0aW9uIiwiZ2V0TGVuZ3RoIiwiY2hlY2tJZkxvY2F0aW9uSXNBU2hpcE9yT2ZmTGltaXRzIiwiY2hlY2tJZlJvd0Nvb3JkaW5hdGVJc1ZhbGlkIiwicG9zaXRpb24iLCJhZGRPZmZMaW1pdEFyZWFGb3JWZXJ0aWNhbGx5UG9zaXRpb25lZFNoaXAiLCJjaGVja0lmQ29sdW1uQ29vcmRpbmF0ZUlzVmFsaWQiLCJhZGRPZmZMaW1pdEFyZWFGb3JIb3Jpem9udGFsbHlQb3NpdGlvbmVkU2hpcCIsInJhbmRvbWx5UGxhY2VTaGlwcyIsInNoaXBzRGV0YWlscyIsImZsYXR0ZW5lZEdhbWVCb2FyZCIsImVsZW1lbnRJbmRleCIsImZpbmRJbmRleCIsImluZGV4IiwiZWxlbWVudENvbHVtbiIsImVsZW1lbnRSb3ciLCJwdXNoIiwibmFtZSIsImdldE5hbWUiLCJhdHRhY2siLCJnZXRTdGF0dXMiLCJpbmNsdWRlcyIsImhpdCIsInN0YXR1cyIsImV2ZXJ5IiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsIm4iLCJnZXR0ZXIiLCJfX2VzTW9kdWxlIiwiZCIsImEiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJyZW5kZXJBdHRhY2tzIiwicGxheWVyIiwiZW5lbXlCb2FyZCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNsYXNzTGlzdCIsImFkZCIsImhhbmRsZUF0dGFjayIsInBsYXllckJvYXJkIiwiY29tcHV0ZXIiLCJwcyIsInN1YnNjcmliZXJzIiwicHVibGlzaCIsImV2ZW50TmFtZSIsImRhdGEiLCJpc0FycmF5IiwiZm9yRWFjaCIsImNhbGxiYWNrIiwic3Vic2NyaWJlIiwidW5zdWJzY3JpYmUiLCJzcGxpY2UiLCJwdWJTdWIiLCJlbmVteSIsImVuZW15Qm9hcmRBcmVhIiwic2V0QXR0cmlidXRlIiwiYWRkRXZlbnRMaXN0ZW5lciIsIm9uY2UiLCJhZGRMaXN0ZW5lcnNUb0VuZW15Qm9hcmQiLCJhdHRhY2tFbmVteUNlbGwiLCJyYW5kb21Db2x1bW4iLCJyYW5kb21Sb3ciLCJhdHRhY2tQbGF5ZXJDZWxsIiwibW9kYWwiLCJtb2RhbFdpbm5lciIsInBsYXlBZ2FpbkJ1dHRvbiIsInN0eWxlIiwiZGlzcGxheSIsInJlbG9hZCIsInRleHRDb250ZW50IiwiY2hlY2tJZkdhbWVPdmVyIiwicGxheWVyQm9hcmRBcmVhIiwicmVuZGVyUGxheWVyU2hpcHMiXSwic291cmNlUm9vdCI6IiJ9