(()=>{var e={653:(e,t,r)=>{const o=r(585);e.exports=()=>{const e={hasBeenHit:!1,isShip:!1,offLimits:!1},t=Array(10).fill(structuredClone(e)).map((()=>Array(10).fill(structuredClone(e)))),r=[o(5,"Carrier"),o(4,"Battleship"),o(3,"Destroyer"),o(3,"Submarine"),o(2,"Patrol Boat")],n=(r,o,n=(()=>Object.assign(e,{offLimits:!0}))())=>(void 0===t?.[r]?.[o]||(t[r][o]=n),!0),i=e=>{const t=0===Math.floor(2*Math.random())?"vertical":"horizontal";return{randomColumn:Math.floor(10*Math.random()),randomRow:Math.floor(10*Math.random()),randomDirection:t}};return{checkIfOffLimitZoneWasCorrectlyImplemented:e=>t.flat().filter((e=>!0===e.offLimits)).length===e+2,getLocation:(e,r)=>t?.[e]?.[r],receiveAttack:(e,r)=>{t[e][r].hasBeenHit=!0},checkIfAllShipsHaveSunk:()=>t.flat().every((e=>!1===e.isShip||!0===e.isShip&&!0===e.hasBeenHit&&e.getStatus().every((e=>"hit"===e)))),placeShip:(e,r,o,i)=>{if(((e,r,o,n)=>{if(r<0||r>9||o<0||o>9)return!1;const i=e.getLength(0);if("vertical"===n){if(r+i>10)return!1}else if(o+i>10)return!1;if("vertical"===n){for(let n=0;n<e.length;n++)if(t[r+n][o])return!1}else for(let n=0;n<e.length;n++)if(t[r][o+n])return!1;if("vertical"===n){for(let n=0;n<e.length;n++)for(let e=-1;e<=1;e++)for(let i=-1;i<=1;i++)if(!(r+e+n<0||r+e+n>=10||o+i<0||o+i>=10)&&t[r+e+n][o+i])return!1}else for(let n=0;n<e.length;n++)for(let e=-1;e<=1;e++)for(let i=-1;i<=1;i++)if(!(r+e<0||r+e>=10||o+i+n<0||o+i+n>=10)&&t[r+e][o+i+n])return!1;return!0})(i,r,e,o))return!1;const a=i.getLength();if("vertical"===o)for(let t=0;t<a;t+=1)n(e,r+t,i);else if("horizontal"===o){for(let t=0;t<a;t+=1)n(e+t,r,i);return!0}return!1},randomlyPlaceShips:()=>{const e=[];for(let t=0;t<r.length;t+=1){const o=r[t],{randomColumn:n,randomRow:a,randomDirection:l}=i(o.getLength());e.push({randomColumn:n,randomRow:a,randomDirection:l})}return e},makeRandomCoordinates:i}}},61:e=>{e.exports=(e="player")=>({getName:()=>e,attack:(e,t,{getLocation:r,receiveAttack:o})=>{const n=r(e,t);return!1===n.hasBeenHit||n.isShip&&n.getStatus().includes("unhit")?(o(e,t),"It's a hit!"):"You have already hit this spot!"}})},585:e=>{e.exports=(e,t="ship")=>{const r=Array(e).fill("unhit");return{name:t,getLength:()=>r.length,isSunk:()=>r.every((e=>"hit"===e)),hit:t=>{t<e&&(r[t]="hit")},getStatus:()=>r,hasBeenHit:!1,isShip:!0}}}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=(e,t,r)=>{const o=document.querySelector(`.${e}-board > .cell[column='${t}'][row='${r}']`);o.classList.contains("ship")?o.classList.add("hit"):o.classList.add("miss")},t=(e,t,r,o)=>o.attack(e,t,r);var o=r(653),n=r.n(o),i=r(585),a=r.n(i),l=r(61),c=r.n(l);const s=n()(),h=n()(),u=c()(),p=c()();s.placeShip(0,0,"horizontal",a()(5)),s.placeShip(3,4,"horizontal",a()(3)),s.placeShip(6,7,"horizontal",a()(2)),s.placeShip(9,1,"vertical",a()(3)),s.placeShip(5,9,"horizontal",a()(4)),h.placeShip(0,0,"horizontal",a()(5)),h.placeShip(3,4,"horizontal",a()(3)),h.placeShip(6,7,"horizontal",a()(2)),h.placeShip(9,1,"vertical",a()(3)),h.placeShip(5,9,"horizontal",a()(4));const f=(()=>{const e={};return{publish:function(t,r){Array.isArray(e[t])&&e[t].forEach((e=>{e(r)}))},subscribe:function t(r,o){Array.isArray(t[r])||(e[r]=[]),e[r].push(o);const n=e[r].length-1;return{unsubscribe(){e[r].splice(n,1)}}}}})();((e,t,r,o,n)=>{const i=document.querySelector("div.enemy-board");for(let a=0;a<10;a+=1)for(let l=0;l<10;l+=1){const c=i.querySelector(`.cell:nth-child(${10*l+a+1})`);c.setAttribute("column",a),c.setAttribute("row",l),c.addEventListener("click",(()=>{n.publish("click",{cell:c,column:a,row:l,playerBoard:e,enemyBoard:t,player:r,enemy:o})}),{once:!0})}})(s,h,u,p,f),f.subscribe("click",(({cell:r,column:o,row:n,playerBoard:i,enemyBoard:a,player:l,enemy:c})=>{((r,o,n,i)=>{t(r,o,n,i),e("enemy",r,o)})(o,n,a,l),((r,o)=>{const{randomColumn:n,randomRow:i}=r.makeRandomCoordinates();t(n,n,r,o),e("player",n,i)})(i,c)})),(({getLocation:e})=>{const t=document.querySelector("div.player-board");for(let r=0;r<10;r+=1)for(let o=0;o<10;o+=1){const n=t.querySelector(`.cell:nth-child(${10*o+r+1})`);n.setAttribute("column",r),n.setAttribute("row",o),e(o,r).isShip&&n.classList.add("ship")}})(s)})()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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L0MsSUFBSyxJQUFJdEUsRUFBUyxFQUFHQSxFQUFTLEdBQUlBLEdBQVUsRUFDeEMsSUFBSyxJQUFJQyxFQUFNLEVBQUdBLEVBQU0sR0FBSUEsR0FBTyxFQUFHLENBQ2xDLE1BQU11QixFQUFPMkUsRUFBZ0I3QixjQUN6QixtQkFBeUIsR0FBTnJFLEVBQVdELEVBQVMsTUFFM0N3QixFQUFLcUUsYUFBYSxTQUFVN0YsR0FDNUJ3QixFQUFLcUUsYUFBYSxNQUFPNUYsR0FDckJtQixFQUFZbkIsRUFBS0QsR0FBUVQsUUFDekJpQyxFQUFLK0MsVUFBVUUsSUFBSSxVQ3BDbkMyQixDQUFrQnhCLEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9nYW1lYm9hcmQvZ2FtZWJvYXJkLmpzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL3BsYXllci9wbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vdG9wLWJhdHRsZXNoaXAvLi9zcmMvc2hpcC9zaGlwLmpzIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9jb21wYXQgZ2V0IGRlZmF1bHQgZXhwb3J0Iiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3RvcC1iYXR0bGVzaGlwLy4vc3JjL2RvbS5qcyIsIndlYnBhY2s6Ly90b3AtYmF0dGxlc2hpcC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZGlzYWJsZSBuby11bnVzZWQtZXhwcmVzc2lvbnMgKi9cbmNvbnN0IGNyZWF0ZVNoaXAgPSByZXF1aXJlKCcuLi9zaGlwL3NoaXAnKVxuXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1wYXJhbS1yZWFzc2lnbiAqL1xuY29uc3QgY3JlYXRlR2FtZUJvYXJkID0gKCkgPT4ge1xuICAgIGNvbnN0IGVtcHR5Q2VsbCA9IHsgaGFzQmVlbkhpdDogZmFsc2UsIGlzU2hpcDogZmFsc2UsIG9mZkxpbWl0czogZmFsc2UgfVxuICAgIGNvbnN0IGdhbWVCb2FyZCA9IEFycmF5KDEwKVxuICAgICAgICAuZmlsbChzdHJ1Y3R1cmVkQ2xvbmUoZW1wdHlDZWxsKSlcbiAgICAgICAgLm1hcCgoKSA9PiBBcnJheSgxMCkuZmlsbChzdHJ1Y3R1cmVkQ2xvbmUoZW1wdHlDZWxsKSkpXG5cbiAgICBjb25zdCBzaGlwcyA9IFtcbiAgICAgICAgY3JlYXRlU2hpcCg1LCAnQ2FycmllcicpLFxuICAgICAgICBjcmVhdGVTaGlwKDQsICdCYXR0bGVzaGlwJyksXG4gICAgICAgIGNyZWF0ZVNoaXAoMywgJ0Rlc3Ryb3llcicpLFxuICAgICAgICBjcmVhdGVTaGlwKDMsICdTdWJtYXJpbmUnKSxcbiAgICAgICAgY3JlYXRlU2hpcCgyLCAnUGF0cm9sIEJvYXQnKSxcbiAgICBdXG5cbiAgICBjb25zdCBjaGVja0lmQWxsU2hpcHNIYXZlU3VuayA9ICgpID0+XG4gICAgICAgIGdhbWVCb2FyZC5mbGF0KCkuZXZlcnkoXG4gICAgICAgICAgICAoY2VsbCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChjZWxsLmlzU2hpcCA9PT0gZmFsc2UpIHJldHVybiB0cnVlXG4gICAgICAgICAgICAgICAgaWYgKGNlbGwuaXNTaGlwID09PSB0cnVlICYmIGNlbGwuaGFzQmVlbkhpdCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2VsbC5nZXRTdGF0dXMoKS5ldmVyeSgodW5pdCkgPT4gdW5pdCA9PT0gJ2hpdCcpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyAocG9zaXRpb24uaXNTaGlwID09PSBmYWxzZSkgfHxcbiAgICAgICAgICAgIC8vIChwb3NpdGlvbi5pc1NoaXAgPT09IHRydWUgJiYgcG9zaXRpb24uaGFzQmVlbkhpdCA9PT0gdHJ1ZSlcbiAgICAgICAgKVxuXG4gICAgY29uc3QgY3JlYXRlT2ZmTGltaXRMb2NhdGlvbiA9ICgpID0+XG4gICAgICAgIE9iamVjdC5hc3NpZ24oZW1wdHlDZWxsLCB7IG9mZkxpbWl0czogdHJ1ZSB9KVxuXG4gICAgY29uc3QgZ2V0TG9jYXRpb24gPSAoY29sdW1uLCByb3cpID0+IGdhbWVCb2FyZD8uW2NvbHVtbl0/Lltyb3ddXG5cbiAgICBjb25zdCBzZXRMb2NhdGlvbiA9IChjb2x1bW4sIHJvdywgc2hpcCA9IGNyZWF0ZU9mZkxpbWl0TG9jYXRpb24oKSkgPT4ge1xuICAgICAgICBpZiAoZ2FtZUJvYXJkPy5bY29sdW1uXT8uW3Jvd10gPT09IHVuZGVmaW5lZCkgcmV0dXJuIHRydWVcbiAgICAgICAgZ2FtZUJvYXJkW2NvbHVtbl1bcm93XSA9IHNoaXBcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG5cbiAgICBjb25zdCBhZGRPZmZMaW1pdEFyZWFGb3JTaGlwcyA9IChjb2x1bW4sIHJvdykgPT4ge1xuICAgICAgICAvLyB0b3AtbGVmdFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gLSAxLCByb3cgLSAxKVxuICAgICAgICAvLyB0b3BcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uLCByb3cgLSAxKVxuICAgIH1cblxuICAgIGNvbnN0IGFkZE9mZkxpbWl0QXJlYUZvckhvcml6b250YWxseVBvc2l0aW9uZWRTaGlwID0gKFxuICAgICAgICBjb2x1bW4sXG4gICAgICAgIHJvdyxcbiAgICAgICAgc2hpcExlbmd0aFxuICAgICkgPT4ge1xuICAgICAgICAvLyBwb3NpdGlvbnMgcmVsYXRpdmUgdG8gdGhlIHNoaXAgaXRzZWxmKGllLiBhIGhvcml6b250YWwgc2hpcCdzIGJvdHRvbSBpcyB0byB0aGUgcmlnaHQpXG5cbiAgICAgICAgYWRkT2ZmTGltaXRBcmVhRm9yU2hpcHMoY29sdW1uLCByb3cpXG4gICAgICAgIC8vIGJvdHRvbVxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBzaGlwTGVuZ3RoLCByb3cpXG4gICAgICAgIC8vIGJvdHRvbS1sZWZ0XG4gICAgICAgIHNldExvY2F0aW9uKGNvbHVtbiAtIDEsIHJvdyArIDEpXG4gICAgICAgIC8vIGJvdHRvbS1yaWdodFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyBzaGlwTGVuZ3RoLCByb3cgKyAxKVxuICAgICAgICAvLyB0b3AtcmlnaHRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgc2hpcExlbmd0aCwgcm93IC0gMSlcbiAgICB9XG5cbiAgICBjb25zdCBhZGRPZmZMaW1pdEFyZWFGb3JWZXJ0aWNhbGx5UG9zaXRpb25lZFNoaXAgPSAoXG4gICAgICAgIGNvbHVtbixcbiAgICAgICAgcm93LFxuICAgICAgICBzaGlwTGVuZ3RoXG4gICAgKSA9PiB7XG4gICAgICAgIC8vIHBvc2l0aW9ucyByZWxhdGl2ZSB0byBob3cgdGhlIHVzZXIgc2VlcyBpdChpZS4gYSB2ZXJ0aWNhbCBzaGlwJ3MgYm90dG9tIGlzIHRvIHRoZSBib3R0b20pXG5cbiAgICAgICAgYWRkT2ZmTGltaXRBcmVhRm9yU2hpcHMoY29sdW1uLCByb3cpXG4gICAgICAgIC8vIGJvdHRvbVxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4sIHJvdyArIHNoaXBMZW5ndGgpXG4gICAgICAgIC8vIGJvdHRvbS1yaWdodFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gKyAxLCByb3cgKyBzaGlwTGVuZ3RoKVxuICAgICAgICAvLyBib3R0b20tbGVmdFxuICAgICAgICBzZXRMb2NhdGlvbihjb2x1bW4gLSAxLCByb3cgKyBzaGlwTGVuZ3RoKVxuICAgICAgICAvLyB0b3AtcmlnaHRcbiAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgMSwgcm93IC0gMSlcbiAgICB9XG5cbiAgICBjb25zdCBjaGVja0lmQ29sdW1uQ29vcmRpbmF0ZUlzVmFsaWQgPSAoY29sdW1uLCBzaGlwTGVuZ3RoKSA9PlxuICAgICAgICBjb2x1bW4gPj0gMCAmJiBjb2x1bW4gKyBzaGlwTGVuZ3RoIC0gMSA8IGdhbWVCb2FyZC5sZW5ndGhcblxuICAgIGNvbnN0IGNoZWNrSWZSb3dDb29yZGluYXRlSXNWYWxpZCA9IChyb3csIHNoaXBMZW5ndGgpID0+XG4gICAgICAgIHJvdyA+PSAwICYmIHJvdyArIHNoaXBMZW5ndGggLSAxIDwgZ2FtZUJvYXJkLmxlbmd0aFxuXG4gICAgY29uc3QgY2hlY2tJZkxvY2F0aW9uSXNBU2hpcE9yT2ZmTGltaXRzID0gKGxvY2F0aW9uKSA9PiB7XG4gICAgICAgIGlmIChsb2NhdGlvbi5pc1NoaXAgPT09IHRydWUgfHwgbG9jYXRpb24ub2ZmTGltaXRzID09PSB0cnVlKSByZXR1cm4gdHJ1ZVxuXG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIGNvbnN0IGlzUGxhY2VtZW50UG9zc2libGUgPSAoc2hpcCwgcm93LCBjb2x1bW4sIGRpcmVjdGlvbikgPT4ge1xuICAgICAgICBpZihyb3cgPCAwIHx8IHJvdyA+IDEwIC0gMSB8fCBjb2x1bW4gPCAwIHx8IGNvbHVtbiA+IDEwIC0gMSkgcmV0dXJuIGZhbHNlXG5cbiAgICAgICAgY29uc3Qgc2hpcExlbmd0aCA9IHNoaXAuZ2V0TGVuZ3RoKDApXG4gICAgICAgIGlmKGRpcmVjdGlvbiA9PT0gJ3ZlcnRpY2FsJyl7XG4gICAgICAgICAgICBpZihyb3cgKyBzaGlwTGVuZ3RoID4gMTApIHJldHVybiBmYWxzZVxuICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbG9uZWx5LWlmXG4gICAgICAgICAgICBpZihjb2x1bW4gKyBzaGlwTGVuZ3RoID4gMTApIHJldHVybiBmYWxzZVxuICAgICAgICB9XG5cbiAgICAgICAgaWYoZGlyZWN0aW9uID09PSAndmVydGljYWwnKXtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgICAgICBpZihnYW1lQm9hcmRbcm93ICsgaV1bY29sdW1uXSkgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcC5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgaWYoZ2FtZUJvYXJkW3Jvd11bY29sdW1uICsgaV0pIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYoZGlyZWN0aW9uID09PSAndmVydGljYWwnKXtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBzaGlwLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgICAgICBmb3IobGV0IHggPSAtMTsgeCA8PSAxOyB4Kyspe1xuICAgICAgICAgICAgICAgICAgICBmb3IobGV0IHkgPSAtMTsgeSA8PSAxOyB5Kyspe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYocm93ICsgeCArIGkgPCAwIHx8IHJvdyArIHggKyBpID49IDEwIHx8IGNvbHVtbiArIHkgPCAwIHx8IGNvbHVtbiArIHkgPj0gMTApIGNvbnRpbnVlXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGdhbWVCb2FyZFtyb3cgKyB4ICsgaV1bY29sdW1uICsgeV0pIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgc2hpcC5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgZm9yKGxldCB4ID0gLTE7IHggPD0gMTsgeCsrKXtcbiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCB5ID0gLTE7IHkgPD0gMTsgeSsrKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJvdyArIHggPCAwIHx8IHJvdyArIHggPj0gMTAgfHwgY29sdW1uICsgeSArIGkgPCAwIHx8IGNvbHVtbiArIHkgKyBpID49IDEwKSBjb250aW51ZVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihnYW1lQm9hcmRbcm93ICsgeF1bY29sdW1uICsgeSArIGldKSByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlXG5cbiAgICB9XG5cbiAgICBjb25zdCBwbGFjZVNoaXAgPSAoY29sdW1uLCByb3csIGRpcmVjdGlvbiwgc2hpcCkgPT4ge1xuXG4gICAgICAgIGlmKGlzUGxhY2VtZW50UG9zc2libGUoc2hpcCwgcm93LCBjb2x1bW4sIGRpcmVjdGlvbikpIHJldHVybiBmYWxzZVxuXG4gICAgICAgIGNvbnN0IHNoaXBMZW5ndGggPSBzaGlwLmdldExlbmd0aCgpXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09ICd2ZXJ0aWNhbCcpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uLCByb3cgKyBpLCBzaGlwKVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZGlyZWN0aW9uID09PSAnaG9yaXpvbnRhbCcpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBMZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0TG9jYXRpb24oY29sdW1uICsgaSwgcm93LCBzaGlwKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuXG4gICAgY29uc3QgbWFrZVJhbmRvbUNvb3JkaW5hdGVzID0gKHNoaXBMZW5ndGgpID0+IHtcbiAgICAgICAgY29uc3QgcmFuZG9tRGlyZWN0aW9uID1cbiAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpID09PSAwID8gJ3ZlcnRpY2FsJyA6ICdob3Jpem9udGFsJ1xuICAgICAgICBjb25zdCByYW5kb21Db2x1bW4gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMClcbiAgICAgICAgY29uc3QgcmFuZG9tUm93ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApXG4gICAgICAgIC8vaWYgKCFjaGVja0lmQ29sdW1uQ29vcmRpbmF0ZUlzVmFsaWQocmFuZG9tQ29sdW1uLCBzaGlwTGVuZ3RoKSlcbiAgICAgICAgICAgIC8vcmV0dXJuIG1ha2VSYW5kb21Db29yZGluYXRlcyhzaGlwTGVuZ3RoKVxuICAgICAgICAvL2lmICghY2hlY2tJZlJvd0Nvb3JkaW5hdGVJc1ZhbGlkKHJhbmRvbVJvdywgc2hpcExlbmd0aCkpXG4gICAgICAgICAgICAvL3JldHVybiBtYWtlUmFuZG9tQ29vcmRpbmF0ZXMoc2hpcExlbmd0aClcbiAgICAgICAgcmV0dXJuIHsgcmFuZG9tQ29sdW1uLCByYW5kb21Sb3csIHJhbmRvbURpcmVjdGlvbiB9XG4gICAgfVxuXG4gICAgY29uc3QgcmFuZG9tbHlQbGFjZVNoaXBzID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBzaGlwRGV0YWlscyA9IFtdXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2hpcHMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIGNvbnN0IHNoaXAgPSBzaGlwc1tpXVxuICAgICAgICAgICAgY29uc3QgeyByYW5kb21Db2x1bW4sIHJhbmRvbVJvdywgcmFuZG9tRGlyZWN0aW9uIH0gPVxuICAgICAgICAgICAgICAgIG1ha2VSYW5kb21Db29yZGluYXRlcyhzaGlwLmdldExlbmd0aCgpKVxuICAgICAgICAgICAgc2hpcERldGFpbHMucHVzaCh7IHJhbmRvbUNvbHVtbiwgcmFuZG9tUm93LCByYW5kb21EaXJlY3Rpb24gfSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2hpcERldGFpbHNcbiAgICB9XG5cbiAgICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvbHVtbiwgcm93KSA9PiB7XG4gICAgICAgIGdhbWVCb2FyZFtjb2x1bW5dW3Jvd10uaGFzQmVlbkhpdCA9IHRydWVcbiAgICB9XG5cbiAgICBjb25zdCBjaGVja0lmT2ZmTGltaXRab25lV2FzQ29ycmVjdGx5SW1wbGVtZW50ZWQgPSAoc2hpcExlbmd0aCkgPT5cbiAgICAgICAgZ2FtZUJvYXJkLmZsYXQoKS5maWx0ZXIoKGVsZW1lbnQpID0+IGVsZW1lbnQub2ZmTGltaXRzID09PSB0cnVlKVxuICAgICAgICAgICAgLmxlbmd0aCA9PT1cbiAgICAgICAgc2hpcExlbmd0aCArIDJcbiAgICAvLyBhZGRpbmcgc2hpcExlbmd0aCBwbHVzIHR3byBiZWNhdXNlIGZvciBldmVyeSBpbmNyZWFzZSBpbiB0aGUgc2l6ZSBvZiBzaGlwLCB0aGUgem9uZXMgY292ZXJlZCBpbmNyZWFzZSBieSAyIHVuaXRzXG5cbiAgICByZXR1cm4ge1xuICAgICAgICBjaGVja0lmT2ZmTGltaXRab25lV2FzQ29ycmVjdGx5SW1wbGVtZW50ZWQsXG4gICAgICAgIGdldExvY2F0aW9uLFxuICAgICAgICByZWNlaXZlQXR0YWNrLFxuICAgICAgICBjaGVja0lmQWxsU2hpcHNIYXZlU3VuayxcbiAgICAgICAgcGxhY2VTaGlwLFxuICAgICAgICByYW5kb21seVBsYWNlU2hpcHMsXG4gICAgICAgIG1ha2VSYW5kb21Db29yZGluYXRlcyxcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gY3JlYXRlR2FtZUJvYXJkXG4iLCJjb25zdCBjcmVhdGVQbGF5ZXIgPSAobmFtZSA9ICdwbGF5ZXInKSA9PiB7XG4gICAgY29uc3QgZ2V0TmFtZSA9ICgpID0+IG5hbWVcblxuICAgIGNvbnN0IGF0dGFjayA9IChjb2x1bW4sIHJvdywgeyBnZXRMb2NhdGlvbiwgcmVjZWl2ZUF0dGFjayB9KSA9PiB7XG4gICAgICAgIGNvbnN0IGxvY2F0aW9uID0gZ2V0TG9jYXRpb24oY29sdW1uLCByb3cpXG4gICAgICAgIGlmIChsb2NhdGlvbi5oYXNCZWVuSGl0ID09PSBmYWxzZSB8fCAobG9jYXRpb24uaXNTaGlwICYmIGxvY2F0aW9uLmdldFN0YXR1cygpLmluY2x1ZGVzKCd1bmhpdCcpKSkge1xuICAgICAgICAgICAgcmVjZWl2ZUF0dGFjayhjb2x1bW4sIHJvdylcbiAgICAgICAgICAgIHJldHVybiBcIkl0J3MgYSBoaXQhXCJcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAnWW91IGhhdmUgYWxyZWFkeSBoaXQgdGhpcyBzcG90ISdcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBnZXROYW1lLFxuICAgICAgICBhdHRhY2ssXG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGNyZWF0ZVBsYXllclxuIiwiY29uc3QgY3JlYXRlU2hpcCA9IChsZW5ndGgsIG5hbWUgPSAnc2hpcCcpID0+IHtcblxuICAgIGNvbnN0IHN0YXR1cyA9IEFycmF5KGxlbmd0aCkuZmlsbCgndW5oaXQnKVxuXG4gICAgY29uc3QgZ2V0TGVuZ3RoID0gKCkgPT4gc3RhdHVzLmxlbmd0aFxuXG4gICAgY29uc3QgZ2V0U3RhdHVzID0gKCkgPT4gc3RhdHVzXG5cbiAgICBjb25zdCBoaXQgPSAocG9zaXRpb24pID0+IHtcbiAgICAgICAgaWYgKHBvc2l0aW9uIDwgbGVuZ3RoKSB7XG4gICAgICAgICAgICBzdGF0dXNbcG9zaXRpb25dID0gJ2hpdCdcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGlzU3VuayA9ICgpID0+IHN0YXR1cy5ldmVyeSgocG9zaXRpb24pID0+IHBvc2l0aW9uID09PSAnaGl0JylcblxuICAgIHJldHVybiB7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGdldExlbmd0aCxcbiAgICAgICAgaXNTdW5rLFxuICAgICAgICBoaXQsXG4gICAgICAgIGdldFN0YXR1cyxcbiAgICAgICAgaGFzQmVlbkhpdDogZmFsc2UsXG4gICAgICAgIGlzU2hpcDogdHJ1ZSxcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gY3JlYXRlU2hpcFxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSAobW9kdWxlKSA9PiB7XG5cdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuXHRcdCgpID0+IChtb2R1bGVbJ2RlZmF1bHQnXSkgOlxuXHRcdCgpID0+IChtb2R1bGUpO1xuXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCB7IGE6IGdldHRlciB9KTtcblx0cmV0dXJuIGdldHRlcjtcbn07IiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsImNvbnN0IHJlbmRlckF0dGFja3MgPSAocGxheWVyLCBjb2x1bW4sIHJvdykgPT4ge1xuICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBgLiR7cGxheWVyfS1ib2FyZCA+IC5jZWxsW2NvbHVtbj0nJHtjb2x1bW59J11bcm93PScke3Jvd30nXWBcbiAgICApXG4gICAgaWYgKGNlbGwuY2xhc3NMaXN0LmNvbnRhaW5zKCdzaGlwJykpIHtcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdoaXQnKVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnbWlzcycpXG4gICAgfVxufVxuXG5jb25zdCBoYW5kbGVBdHRhY2sgPSAoY29sdW1uLCByb3csIGVuZW15Qm9hcmQsIHBsYXllcikgPT5cbiAgICBwbGF5ZXIuYXR0YWNrKGNvbHVtbiwgcm93LCBlbmVteUJvYXJkKVxuXG5jb25zdCBhdHRhY2tFbmVteUNlbGwgPSAoY29sdW1uLCByb3csIGVuZW15Qm9hcmQsIHBsYXllcikgPT4ge1xuICAgIGhhbmRsZUF0dGFjayhjb2x1bW4sIHJvdywgZW5lbXlCb2FyZCwgcGxheWVyKVxuICAgIHJlbmRlckF0dGFja3MoJ2VuZW15JywgY29sdW1uLCByb3cpXG59XG5cbmNvbnN0IGF0dGFja1BsYXllckNlbGwgPSAocGxheWVyQm9hcmQsIGVuZW15KSA9PiB7XG4gICAgY29uc3QgeyByYW5kb21Db2x1bW4sIHJhbmRvbVJvdyB9ID0gcGxheWVyQm9hcmQubWFrZVJhbmRvbUNvb3JkaW5hdGVzKClcbiAgICBoYW5kbGVBdHRhY2socmFuZG9tQ29sdW1uLCByYW5kb21Db2x1bW4sIHBsYXllckJvYXJkLCBlbmVteSlcbiAgICByZW5kZXJBdHRhY2tzKCdwbGF5ZXInLCByYW5kb21Db2x1bW4sIHJhbmRvbVJvdylcbn1cbi8vIGh0dHBzOi8vanNtYW5pZmVzdC5jb20vdGhlLXB1Ymxpc2gtc3Vic2NyaWJlLXBhdHRlcm4taW4tamF2YXNjcmlwdC9cblxuZXhwb3J0IGNvbnN0IHB1YlN1YiA9ICgpID0+IHtcbiAgICBjb25zdCBzdWJzY3JpYmVycyA9IHt9XG5cbiAgICBmdW5jdGlvbiBwdWJsaXNoKGV2ZW50TmFtZSwgZGF0YSkge1xuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc3Vic2NyaWJlcnNbZXZlbnROYW1lXSkpIHtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICAgIHN1YnNjcmliZXJzW2V2ZW50TmFtZV0uZm9yRWFjaCgoY2FsbGJhY2spID0+IHtcbiAgICAgICAgICAgIGNhbGxiYWNrKGRhdGEpXG4gICAgICAgIH0pXG4gICAgfVxuICAgIGZ1bmN0aW9uIHN1YnNjcmliZShldmVudE5hbWUsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzdWJzY3JpYmVbZXZlbnROYW1lXSkpIHtcbiAgICAgICAgICAgIHN1YnNjcmliZXJzW2V2ZW50TmFtZV0gPSBbXVxuICAgICAgICB9XG4gICAgICAgIHN1YnNjcmliZXJzW2V2ZW50TmFtZV0ucHVzaChjYWxsYmFjaylcbiAgICAgICAgY29uc3QgaW5kZXggPSBzdWJzY3JpYmVyc1tldmVudE5hbWVdLmxlbmd0aCAtIDFcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdW5zdWJzY3JpYmUoKSB7XG4gICAgICAgICAgICAgICAgc3Vic2NyaWJlcnNbZXZlbnROYW1lXS5zcGxpY2UoaW5kZXgsIDEpXG4gICAgICAgICAgICB9LFxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcHVibGlzaCxcbiAgICAgICAgc3Vic2NyaWJlLFxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IHJlbmRlclBsYXllclNoaXBzID0gKHsgZ2V0TG9jYXRpb24gfSkgPT4ge1xuICAgIGNvbnN0IHBsYXllckJvYXJkQXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Rpdi5wbGF5ZXItYm9hcmQnKVxuXG4gICAgZm9yIChsZXQgY29sdW1uID0gMDsgY29sdW1uIDwgMTA7IGNvbHVtbiArPSAxKSB7XG4gICAgICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IDEwOyByb3cgKz0gMSkge1xuICAgICAgICAgICAgY29uc3QgY2VsbCA9IHBsYXllckJvYXJkQXJlYS5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgICAgIGAuY2VsbDpudGgtY2hpbGQoJHtyb3cgKiAxMCArIGNvbHVtbiArIDF9KWBcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdjb2x1bW4nLCBjb2x1bW4pXG4gICAgICAgICAgICBjZWxsLnNldEF0dHJpYnV0ZSgncm93Jywgcm93KVxuICAgICAgICAgICAgaWYgKGdldExvY2F0aW9uKHJvdywgY29sdW1uKS5pc1NoaXApIHtcbiAgICAgICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ3NoaXAnKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgYWRkTGlzdGVuZXJzVG9FbmVteUJvYXJkID0gKFxuICAgIHBsYXllckJvYXJkLFxuICAgIGVuZW15Qm9hcmQsXG4gICAgcGxheWVyLFxuICAgIGVuZW15LFxuICAgIHBzXG4pID0+IHtcbiAgICBjb25zdCBlbmVteUJvYXJkQXJlYSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2Rpdi5lbmVteS1ib2FyZCcpXG5cbiAgICBmb3IgKGxldCBjb2x1bW4gPSAwOyBjb2x1bW4gPCAxMDsgY29sdW1uICs9IDEpIHtcbiAgICAgICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgMTA7IHJvdyArPSAxKSB7XG4gICAgICAgICAgICAvLyBDcmVkaXRpbmcgZm9ybXVsYSB0byBjYWxjdWxhdGUgbnRoLWNoaWxkIHVzaW5nIG5lc3RlZCBsb29wOiBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy84ODcyNjYyL21hdGgtdG8tZGV0ZXJtaW5lLWl0ZW0taW5kZXgtYmFzZWQtb24tY29sLXJvdy1zZWxlY3Rpb24taW4tZ3JpZFxuICAgICAgICAgICAgY29uc3QgY2VsbCA9IGVuZW15Qm9hcmRBcmVhLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICAgICAgYC5jZWxsOm50aC1jaGlsZCgke3JvdyAqIDEwICsgY29sdW1uICsgMX0pYFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgY2VsbC5zZXRBdHRyaWJ1dGUoJ2NvbHVtbicsIGNvbHVtbilcbiAgICAgICAgICAgIGNlbGwuc2V0QXR0cmlidXRlKCdyb3cnLCByb3cpXG5cbiAgICAgICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgICAgICAgICAnY2xpY2snLFxuICAgICAgICAgICAgICAgICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcHMucHVibGlzaCgnY2xpY2snLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uLFxuICAgICAgICAgICAgICAgICAgICAgICAgcm93LFxuICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyQm9hcmQsXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmVteUJvYXJkLFxuICAgICAgICAgICAgICAgICAgICAgICAgcGxheWVyLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW5lbXksXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7IG9uY2U6IHRydWUgfVxuICAgICAgICAgICAgKVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgYXR0YWNrID0gKHtcbiAgICBjZWxsLFxuICAgIGNvbHVtbixcbiAgICByb3csXG4gICAgcGxheWVyQm9hcmQsXG4gICAgZW5lbXlCb2FyZCxcbiAgICBwbGF5ZXIsXG4gICAgZW5lbXksXG59KSA9PiB7XG4gICAgLy8gaHVtYW4gcGxheWVyIGF0dGFja2luZyBjb21wdXRlclxuICAgIGF0dGFja0VuZW15Q2VsbChjb2x1bW4sIHJvdywgZW5lbXlCb2FyZCwgcGxheWVyKVxuICAgIC8vIGNvbXB1dGVyIGF0dGFja2luZyBodW1hblxuICAgIGF0dGFja1BsYXllckNlbGwocGxheWVyQm9hcmQsIGVuZW15KVxufVxuIiwiaW1wb3J0IHsgYWRkTGlzdGVuZXJzVG9FbmVteUJvYXJkLCByZW5kZXJQbGF5ZXJTaGlwcyxwdWJTdWIsIGF0dGFja30gZnJvbSAnLi9kb20nXG5cbmltcG9ydCBjcmVhdGVHYW1lQm9hcmQgZnJvbSAnLi9nYW1lYm9hcmQvZ2FtZWJvYXJkJ1xuaW1wb3J0IGNyZWF0ZVNoaXAgZnJvbSAnLi9zaGlwL3NoaXAnXG5pbXBvcnQgY3JlYXRlUGxheWVyIGZyb20gJy4vcGxheWVyL3BsYXllcidcblxuY29uc3QgcGxheWVyQm9hcmQgPSBjcmVhdGVHYW1lQm9hcmQoKVxuY29uc3QgZW5lbXlCb2FyZCA9IGNyZWF0ZUdhbWVCb2FyZCgpXG5cbmNvbnN0IHBsYXllciA9IGNyZWF0ZVBsYXllcigpXG5cbmNvbnN0IGNvbXB1dGVyID0gY3JlYXRlUGxheWVyKClcblxucGxheWVyQm9hcmQucGxhY2VTaGlwKDAsIDAsICdob3Jpem9udGFsJywgY3JlYXRlU2hpcCg1KSlcbnBsYXllckJvYXJkLnBsYWNlU2hpcCgzLCA0LCAnaG9yaXpvbnRhbCcsIGNyZWF0ZVNoaXAoMykpXG5wbGF5ZXJCb2FyZC5wbGFjZVNoaXAoNiwgNywgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDIpKVxucGxheWVyQm9hcmQucGxhY2VTaGlwKDksIDEsICd2ZXJ0aWNhbCcsIGNyZWF0ZVNoaXAoMykpXG5wbGF5ZXJCb2FyZC5wbGFjZVNoaXAoNSwgOSwgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDQpKVxuXG5lbmVteUJvYXJkLnBsYWNlU2hpcCgwLCAwLCAnaG9yaXpvbnRhbCcsIGNyZWF0ZVNoaXAoNSkpXG5lbmVteUJvYXJkLnBsYWNlU2hpcCgzLCA0LCAnaG9yaXpvbnRhbCcsIGNyZWF0ZVNoaXAoMykpXG5lbmVteUJvYXJkLnBsYWNlU2hpcCg2LCA3LCAnaG9yaXpvbnRhbCcsIGNyZWF0ZVNoaXAoMikpXG5lbmVteUJvYXJkLnBsYWNlU2hpcCg5LCAxLCAndmVydGljYWwnLCBjcmVhdGVTaGlwKDMpKVxuZW5lbXlCb2FyZC5wbGFjZVNoaXAoNSwgOSwgJ2hvcml6b250YWwnLCBjcmVhdGVTaGlwKDQpKVxuXG5jb25zdCBwcyA9IHB1YlN1YigpXG5cbmFkZExpc3RlbmVyc1RvRW5lbXlCb2FyZChwbGF5ZXJCb2FyZCwgZW5lbXlCb2FyZCwgcGxheWVyLCBjb21wdXRlciwgcHMpXG5cbnBzLnN1YnNjcmliZSgnY2xpY2snLCBhdHRhY2spXG5cblxucmVuZGVyUGxheWVyU2hpcHMocGxheWVyQm9hcmQpIl0sIm5hbWVzIjpbImNyZWF0ZVNoaXAiLCJtb2R1bGUiLCJleHBvcnRzIiwiZW1wdHlDZWxsIiwiaGFzQmVlbkhpdCIsImlzU2hpcCIsIm9mZkxpbWl0cyIsImdhbWVCb2FyZCIsIkFycmF5IiwiZmlsbCIsInN0cnVjdHVyZWRDbG9uZSIsIm1hcCIsInNoaXBzIiwic2V0TG9jYXRpb24iLCJjb2x1bW4iLCJyb3ciLCJzaGlwIiwiT2JqZWN0IiwiYXNzaWduIiwiY3JlYXRlT2ZmTGltaXRMb2NhdGlvbiIsInVuZGVmaW5lZCIsIm1ha2VSYW5kb21Db29yZGluYXRlcyIsInNoaXBMZW5ndGgiLCJyYW5kb21EaXJlY3Rpb24iLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJyYW5kb21Db2x1bW4iLCJyYW5kb21Sb3ciLCJjaGVja0lmT2ZmTGltaXRab25lV2FzQ29ycmVjdGx5SW1wbGVtZW50ZWQiLCJmbGF0IiwiZmlsdGVyIiwiZWxlbWVudCIsImxlbmd0aCIsImdldExvY2F0aW9uIiwicmVjZWl2ZUF0dGFjayIsImNoZWNrSWZBbGxTaGlwc0hhdmVTdW5rIiwiZXZlcnkiLCJjZWxsIiwiZ2V0U3RhdHVzIiwidW5pdCIsInBsYWNlU2hpcCIsImRpcmVjdGlvbiIsImdldExlbmd0aCIsImkiLCJ4IiwieSIsImlzUGxhY2VtZW50UG9zc2libGUiLCJyYW5kb21seVBsYWNlU2hpcHMiLCJzaGlwRGV0YWlscyIsInB1c2giLCJuYW1lIiwiZ2V0TmFtZSIsImF0dGFjayIsImxvY2F0aW9uIiwiaW5jbHVkZXMiLCJzdGF0dXMiLCJpc1N1bmsiLCJwb3NpdGlvbiIsImhpdCIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJuIiwiZ2V0dGVyIiwiX19lc01vZHVsZSIsImQiLCJhIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwicmVuZGVyQXR0YWNrcyIsInBsYXllciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiYWRkIiwiaGFuZGxlQXR0YWNrIiwiZW5lbXlCb2FyZCIsInBsYXllckJvYXJkIiwiY29tcHV0ZXIiLCJwcyIsInN1YnNjcmliZXJzIiwicHVibGlzaCIsImV2ZW50TmFtZSIsImRhdGEiLCJpc0FycmF5IiwiZm9yRWFjaCIsImNhbGxiYWNrIiwic3Vic2NyaWJlIiwiaW5kZXgiLCJ1bnN1YnNjcmliZSIsInNwbGljZSIsInB1YlN1YiIsImVuZW15IiwiZW5lbXlCb2FyZEFyZWEiLCJzZXRBdHRyaWJ1dGUiLCJhZGRFdmVudExpc3RlbmVyIiwib25jZSIsImFkZExpc3RlbmVyc1RvRW5lbXlCb2FyZCIsImF0dGFja0VuZW15Q2VsbCIsImF0dGFja1BsYXllckNlbGwiLCJwbGF5ZXJCb2FyZEFyZWEiLCJyZW5kZXJQbGF5ZXJTaGlwcyJdLCJzb3VyY2VSb290IjoiIn0=